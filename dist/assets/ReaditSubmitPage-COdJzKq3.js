import{r as a,d as w,f as S,u as h,j as e,H as A,I as T,h as U,V as r,U as R}from"./index-MvaMJuCp.js";var q=a.createContext(void 0),Q=n=>{const i=a.useContext(q);if(!i)throw new Error("No QueryClient set, use QueryClientProvider to set one");return i};const E="http://localhost:4000/api/v1/readit",L=()=>{const n=Q(),{userAuth:i}=a.useContext(h);return useMutation({mutationFn:({communityName:l,postData:o})=>U.post(`${E}/c/${l}/posts`,o,{headers:{Authorization:`Bearer ${i.access_token}`}}),onSuccess:(l,o)=>{n.invalidateQueries({queryKey:["communityPosts",o.communityName]}),r.success("Post created!")},onError:l=>{var o,t;r.error(((t=(o=l.response)==null?void 0:o.data)==null?void 0:t.error)||"Failed to create post.")}})},D=()=>{const{communityName:n}=w(),i=S(),{userAuth:l}=a.useContext(h),o=a.useRef();a.useRef(0);const[t,y]=a.useState("text"),[c,b]=a.useState(""),[x,v]=a.useState(""),[m,C]=a.useState(""),[d,f]=a.useState(""),{mutate:j,isLoading:p}=L(),N=(s,u)=>{y(s.innerText.toLowerCase())},P=async s=>{const u=s.target.files[0];if(!u)return;let I=r.loading("Uploading image...");try{const g=await R(u);f(g),r.success("Image uploaded!")}catch{r.error("Image upload failed.")}finally{r.dismiss(I)}},k=()=>{if(!c.trim())return r.error("A title is required.");if(t==="link"&&!m)return r.error("A URL is required.");if(t==="image"&&!d)return r.error("An image is required.");j({communityName:n,postData:{title:c,postType:t,content:t==="text"?x:void 0,url:t==="link"?m:void 0,image:t==="image"?d:void 0}},{onSuccess:u=>{i(`/readit/post/${u.data._id}`)}})};return e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx(A,{children:e.jsxs("title",{children:["Submit to c/",n]})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create a Post"}),e.jsxs("p",{className:"text-dark-grey mb-4",children:["Posting to ",e.jsxs("span",{className:"font-semibold",children:["c/",n]})]}),e.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark",children:[e.jsx(T,{ref:o,routes:["Text","Image","Link"],defaultIndex:0,onChange:N}),e.jsxs("div",{className:"p-4",children:[e.jsx("input",{type:"text",placeholder:"Title",value:c,onChange:s=>b(s.target.value),className:"input-box mb-4 text-2xl font-semibold"}),t==="text"&&e.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:x,onChange:s=>v(s.target.value),className:"input-box h-40"}),t==="image"&&e.jsxs("div",{className:"border border-dashed border-grey p-4 rounded-md text-center",children:[e.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:P,className:"hidden"}),e.jsx("label",{htmlFor:"upload-image-input",className:"cursor-pointer text-blue hover:underline",children:d?"Change Image":"Upload Image"}),d&&e.jsx("img",{src:d,alt:"Post preview",className:"w-full rounded-md mt-4"})]}),t==="link"&&e.jsx("input",{type:"url",placeholder:"https://your-link.com",value:m,onChange:s=>C(s.target.value),className:"input-box"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:k,disabled:p,className:"btn-dark px-8",children:p?"Posting...":"Post"})})]})]})]})};export{D as default};
