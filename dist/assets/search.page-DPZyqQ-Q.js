import{P as e,j as a,L as t,m as s,u as l,g as r,i as o,r as n,a as i,H as c,A as d,c as u,e as m,N as g,k as h}from"./index-BK9O-y3K.js";import{S as x}from"./StoryCard-D0JbuGI_.js";const p=({user:e,fallbackImage:l})=>{var r,o,n;const i=(null==(r=null==e?void 0:e.personal_info)?void 0:r.profile_img)||l,c=(null==(o=null==e?void 0:e.personal_info)?void 0:o.username)||"Unknown",d=(null==(n=null==e?void 0:e.personal_info)?void 0:n.fullname)||"Unknown User";return a.jsx(t,{to:`/user/${c}`,children:a.jsxs(s.div,{className:"bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center max-w-sm mx-auto transform transition duration-300 hover:scale-105 hover:shadow-2xl",children:[a.jsx("img",{src:i,alt:c,className:"w-24 h-24 rounded-full object-cover border-2 border-indigo-300"}),a.jsxs("div",{className:"mt-4 text-center",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:d}),a.jsxs("p",{className:"text-sm text-gray-500",children:["@",c]})]})]})})};p.propTypes={user:e.shape({id:e.oneOfType([e.string,e.number]),personal_info:e.shape({username:e.string,fullname:e.string,profile_img:e.string})}),fallbackImage:e.string},p.defaultProps={user:{id:"",personal_info:{username:"Unknown",fullname:"Unknown User",profile_img:""}},fallbackImage:"/imgs/default-avatar.png"};const b=[{key:"all",label:"All"},{key:"posts",label:"Posts"},{key:"stories",label:"Stories"},{key:"users",label:"Users"}],f=()=>a.jsx("div",{className:"animate-pulse rounded-2xl bg-gradient-to-br from-blue-100/60 to-white/80 shadow-lg h-56 w-full mb-4"}),y=u.memo(({item:e,activeTab:t,searchQuery:l,searchedTag:r})=>{let o=null;const n="all"===t?e.type:t;return"posts"===n||"post"===n?o=a.jsx(h,{content:e,searchedTag:r}):"stories"===n||"story"===n?o=a.jsx(x,{story:e}):"users"!==n&&"user"!==n||(o=a.jsx(p,{user:e,fallbackImage:"/imgs/default-avatar.png"})),a.jsx(s.div,{className:"transition-transform",whileHover:{scale:1.04,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)"},children:o})}),j=()=>{const{search_query:e}=l(),t=r(),u=o();let h=null;u.pathname.startsWith("/search/tag/")?h=decodeURIComponent(e):u.state&&u.state.searchedTag&&(h=u.state.searchedTag);const[x,p]=n.useState({results:[],page:1,totalDocs:null,totalPages:null}),[j,v]=n.useState("all"),[w,k]=n.useState(!1),[N,P]=n.useState(null),[S,T]=n.useState(0),_=((e,a)=>{const[t,s]=n.useState(e);return n.useEffect(()=>{const t=setTimeout(()=>s(e),a);return()=>clearTimeout(t)},[e,a]),t})(e,300),$=n.useRef(!0);n.useEffect(()=>{const e=new URLSearchParams(u.search).get("tab");e&&b.some(a=>a.key===e)&&v(e)},[u.search]),n.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[j,_]);const U=n.useCallback(async()=>{if(_){k(!0),P(null);try{const{data:e}=await i.get(`/search/${j}`,{params:{q:_,page:1}});if(!$.current)return;p({results:e.results,page:1,totalDocs:e.totalDocs??e.results.length,totalPages:e.totalPages??1})}catch(e){if(!$.current)return;P("There was an error fetching results. Please try again.")}finally{$.current&&k(!1)}}else p({results:[],page:1,totalDocs:0,totalPages:1})},[_,j,S]);n.useEffect(()=>($.current=!0,U(),()=>{$.current=!1}),[j,_,U]);return a.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 px-2 md:px-6 py-8 transition-all duration-300",children:[a.jsxs(c,{children:[a.jsx("title",{children:`Search results for "${e}" | Spread`}),a.jsx("meta",{name:"description",content:`Search results for "${e}" on Spread.`}),a.jsx("link",{rel:"canonical",href:window.location.href})]}),a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsx(s.h1,{className:"text-3xl md:text-4xl font-extrabold mb-8 text-center text-blue-700 drop-shadow-lg",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:a.jsxs("span",{className:"bg-gradient-to-r from-blue-500 via-blue-400 to-blue-600 bg-clip-text text-transparent",children:["Results for: ",a.jsx("span",{className:"font-black",children:e})]})}),a.jsx("nav",{className:"flex justify-center mb-10","aria-label":"Search result categories",children:a.jsx(s.div,{role:"tablist","aria-orientation":"horizontal",id:"search-tabs",className:"flex bg-white/70 rounded-2xl shadow-lg px-2 py-1",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:b.map(l=>{return a.jsx(s.button,{className:(r=j===l.key,"px-6 py-2 mx-1 rounded-xl font-semibold transition-all duration-300\n   shadow-md backdrop-blur-md border border-blue-200\n   "+(r?"bg-gradient-to-tr from-blue-500/80 to-blue-400/80 text-white scale-105 shadow-lg":"bg-white/60 text-blue-700 hover:bg-blue-100/80 hover:text-blue-900")),role:"tab","aria-selected":j===l.key,"aria-controls":`tabpanel-${l.key}`,id:`tab-${l.key}`,tabIndex:j===l.key?0:-1,whileTap:{scale:.96},onClick:()=>{j!==l.key&&(v(l.key),t(`/search/${e}?tab=${l.key}`))},transition:{type:"spring",stiffness:300,damping:20},children:l.label},l.key);var r})})}),a.jsx(d,{children:N&&a.jsxs(s.div,{className:"text-center text-red-600 font-semibold mb-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:[N,a.jsx("button",{className:"ml-4 px-4 py-1.5 bg-gradient-to-r from-blue-500 to-blue-700 text-white rounded-lg shadow hover:from-blue-600 hover:to-blue-800 transition",onClick:()=>T(e=>e+1),children:"Retry"})]})}),w&&0===x.results.length?a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:Array.from({length:6}).map((e,t)=>a.jsx(f,{},t))}):x.results.length>0?a.jsxs(a.Fragment,{children:[a.jsx(s.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},role:"tabpanel",id:`tabpanel-${j}`,"aria-labelledby":`tab-${j}`,children:a.jsx(d,{children:x.results.map((t,l)=>a.jsx(s.div,{initial:{y:30,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,scale:.95},transition:{delay:.04*l,type:"spring",stiffness:120},children:a.jsx(y,{item:t,activeTab:j,searchQuery:e,searchedTag:h})},t.blog_id||t.story_id||t._id))})}),x.totalPages&&x.page<x.totalPages&&a.jsx("div",{className:"flex justify-center mt-10",children:a.jsx(s.button,{onClick:async()=>{const e=x.page+1;if(!(x.totalPages&&e>x.totalPages)){k(!0);try{const{data:a}=await i.get(`/search/${j}`,{params:{q:_,page:e}});if(!$.current)return;p(t=>({...t,results:[...t.results,...a.results],page:e,totalDocs:a.totalDocs??t.totalDocs,totalPages:a.totalPages??t.totalPages}))}catch(a){if(!$.current)return;P("There was an error loading more results.")}finally{$.current&&k(!1)}}},className:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-700 text-white rounded-xl shadow-lg hover:from-blue-600 hover:to-blue-800 transition-all font-bold text-lg",disabled:w,whileTap:{scale:.97},children:w?a.jsx(m,{}):"Load More"})})]}):a.jsxs(s.div,{className:"flex flex-col items-center justify-center py-24 text-lg font-semibold text-blue-400",initial:{opacity:0},animate:{opacity:1},children:[a.jsx(g,{isSearchPage:!0}),a.jsxs("div",{className:"mt-6 text-blue-500/80",children:["No results found for ",a.jsx("span",{className:"font-bold",children:e})]})]})]})]})};export{j as default};
