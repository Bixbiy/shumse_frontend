import{j as e,L as s,r as a,n as t}from"./vendor-react-CvqM9zc9.js";import{U as r,a as i,I as d,L as l}from"./index-kVKNAyzJ.js";import{R as o}from"./ReaditPostCard-CQRuCF5c.js";import{a5 as n}from"./vendor-misc-BFmcx_8c.js";import{A as c,m}from"./vendor-animation-BFb6eZlp.js";import"./vendor-socket-DIFBDcho.js";import"./vendor-utils-DnwaQ9mb.js";import"./VoteButtons-JEdKh0GC.js";const x=({popularCommunities:a,isLoggedIn:t})=>e.jsxs("div",{className:"space-y-6",children:[!t&&e.jsxs("div",{className:"card-padded bg-gradient-to-br from-orange-50 to-red-50 dark:from-gray-800 dark:to-gray-800 border-orange-100 dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fi fi-rr-alien text-orange-500"})," New to Readit?"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Sign up to subscribe to communities and customize your feed."}),e.jsx(s,{to:"/signup",className:"btn-primary w-full block text-center",children:"Join Now"})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"card-header bg-gray-50 dark:bg-gray-800/50 p-3 border-b border-gray-100 dark:border-gray-700",children:e.jsx("h3",{className:"font-bold text-xs uppercase tracking-wider text-gray-500",children:"Popular Communities"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:a.slice(0,5).map((a,t)=>e.jsxs(s,{to:`/readit/c/${a.name}`,className:"flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"font-bold text-gray-400 w-4 text-center text-sm",children:t+1}),e.jsx("img",{src:a.icon||"/default-community.png",alt:a.name,className:"w-8 h-8 rounded-full bg-gray-200 object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-sm truncate text-gray-900 dark:text-white",children:["c/",a.name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.memberCount," members"]})]})]},a._id))})]}),e.jsxs("div",{className:"text-xs text-gray-400 px-2 flex flex-wrap gap-x-4 gap-y-2",children:[e.jsx(s,{to:"#",className:"hover:underline",children:"Privacy Policy"}),e.jsx(s,{to:"#",className:"hover:underline",children:"User Agreement"}),e.jsx("span",{children:"Â© 2025 Readit"})]})]}),g=()=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 mb-4 shadow-sm border border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-20 w-full bg-gray-200 dark:bg-gray-700 rounded"})]}),u=()=>{var u;const{userAuth:h}=a.useContext(r),[p,b]=a.useState("Popular Posts"),[y,f]=a.useState("hot"),[j,v]=a.useState(!1),[N,k]=a.useState(!1),[w,C]=a.useState([]),[P,S]=a.useState([]),[z,I]=a.useState(!0),[R,F]=a.useState(!1),Y=a.useRef(1),$=a.useRef(!0),L=a.useRef(null),A=a.useMemo(()=>!!(null==h?void 0:h.access_token),[h]),E=a.useCallback(async(e=!1)=>{e?(Y.current=1,$.current=!0,C([]),I(!0)):F(!0);let s="/readit/posts/public";"Your Feed"===p&&A&&(s="/readit/posts/feed");try{const{data:a}=await i.get(`${s}?sort=${y}&page=${Y.current}&limit=10`);C(e?a.posts||[]:e=>[...e,...a.posts||[]]),$.current=a.hasMore,Y.current+=1}catch(a){t.error("Could not load posts")}finally{I(!1),F(!1)}},[p,y,A]),M=n({count:w.length,estimateSize:()=>200,overscan:5,scrollMargin:(null==(u=L.current)?void 0:u.offsetTop)??0});a.useEffect(()=>{const[e]=[...M.getVirtualItems()].reverse();e&&e.index>=w.length-1&&$.current&&!R&&!z&&E(!1)},[$,E,w.length,R,z,M.getVirtualItems()]),a.useEffect(()=>{(async()=>{try{const{data:e}=await i.get("/readit/communities/popular");S(e||[])}catch(e){}})()},[]),a.useEffect(()=>{A||"Your Feed"!==p?E(!0):b("Popular Posts")},[E,p,y,A]);return e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-8 justify-center p-4",children:[e.jsxs("div",{className:"w-full md:max-w-2xl",ref:L,children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx("button",{className:"md:hidden btn-icon",onClick:()=>k(!0),children:e.jsx("i",{className:"fi fi-rr-menu-burger text-xl"})}),e.jsx(d,{routes:["Popular Posts","Your Feed"],defaultHidden:A?[]:["Your Feed"],defaultActiveIndex:"Your Feed"===p?1:0,onRouteChange:e=>b(e)})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto justify-end",children:[e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:["hot","new","top"].map(s=>e.jsx("button",{onClick:()=>f(s),className:"px-3 py-1 text-sm rounded-md capitalize transition-all "+(y===s?"bg-white dark:bg-gray-700 text-orange-500 shadow-sm font-bold":"text-gray-500 hover:text-gray-900 dark:hover:text-white"),children:s},s))}),A&&e.jsxs("div",{className:"relative z-20",children:[e.jsx("button",{onClick:()=>v(e=>!e),className:"btn-icon bg-orange-500 hover:bg-orange-600 text-white shadow-lg",children:e.jsx("i",{className:"fi fi-rr-plus text-xl block"})}),e.jsx(c,{children:j&&e.jsxs(m.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute right-0 mt-2 w-48 card-elevated overflow-hidden z-50",children:[e.jsxs(s,{to:"/readit/create-post",className:"block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm transition-colors",children:[e.jsx("i",{className:"fi fi-rr-edit mr-2 text-blue-500"})," Create Post"]}),e.jsxs(s,{to:"/readit/create-community",className:"block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm border-t border-gray-100 dark:border-gray-700 transition-colors",children:[e.jsx("i",{className:"fi fi-rr-users mr-2 text-green-500"})," Create Community"]})]})})]})]})]}),e.jsxs("div",{className:"min-h-[50vh]",children:[z&&0===w.length?e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsx(g,{})]}):w.length>0?e.jsx("div",{style:{height:`${M.getTotalSize()}px`,width:"100%",position:"relative"},children:M.getVirtualItems().map(s=>{const a=w[s.index];return e.jsx("div",{"data-index":s.index,ref:M.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${s.start}px)`},children:e.jsx(o,{post:a})},s.key)})}):e.jsxs("div",{className:"text-center py-10 bg-gray-50 dark:bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx("i",{className:"fi fi-rr-confetti text-4xl text-gray-400 mb-3 block"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"No posts yet"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Be the first to share something!"})]}),R&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(l,{})})]})]}),e.jsx("div",{className:"hidden md:block w-80 shrink-0",children:e.jsx("div",{className:"sticky top-24",children:e.jsx(x,{popularCommunities:P,isLoggedIn:A})})}),e.jsx(c,{children:N&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>k(!1),className:"fixed inset-0 bg-black/50 z-50 md:hidden backdrop-blur-sm"}),e.jsxs(m.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed top-0 left-0 h-full w-[80%] max-w-sm bg-white dark:bg-gray-900 z-50 md:hidden shadow-2xl overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Menu"}),e.jsx("button",{onClick:()=>k(!1),className:"btn-icon",children:e.jsx("i",{className:"fi fi-rr-cross text-xl"})})]}),e.jsx(x,{popularCommunities:P,isLoggedIn:A})]})]})})]})};export{u as default};
