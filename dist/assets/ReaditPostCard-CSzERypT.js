import{r as e,U as t,b as a,a as s,n as r,g as o,j as i,m as n,V as l,R as d,T as c,z as m}from"./index-CuIw7dka.js";import{V as u}from"./VoteButtons-DGeJ6ruv.js";import{P as p}from"./PostFlair-CDd9ODzC.js";const x=(o="hot",i=null)=>{const{userAuth:n}=e.useContext(t),{socket:l}=a(),[d,c]=e.useState([]),[m,u]=e.useState(!0),[p,x]=e.useState(!1),[g,f]=e.useState(o),[h,b]=e.useState("Popular Posts"),v=e.useRef(1),j=e.useRef(!0),y=!!(null==n?void 0:n.access_token),N=e.useCallback(async(e=!1)=>{if(e)v.current=1,j.current=!0,c([]),u(!0);else{if(p||!j.current)return;x(!0)}let t="/readit/posts/public";i?t=`/readit/c/${i}/posts`:"Your Feed"===h&&y&&(t="/readit/posts/feed");try{const{data:a}=await s.get(`${t}?sort=${g}&page=${v.current}&limit=10`),r=(a.posts||[]).map(e=>({...e,userVote:e.userVote||"none"}));c(e?r:e=>{const t=new Set(e.map(e=>e._id)),a=r.filter(e=>!t.has(e._id));return[...e,...a]}),j.current=a.hasMore??!1,v.current+=1}catch(a){e&&r.error("Could not load posts")}finally{u(!1),x(!1)}},[h,g,y,i,p]);e.useEffect(()=>{y||"Your Feed"!==h?N(!0):b("Popular Posts")},[h,g,y,i]),e.useEffect(()=>{if(!l)return;const e=e=>{var t;i&&(null==(t=e.community)?void 0:t.name)!==i||("Your Feed"!==h||e.inUserFeed)&&c(t=>t.find(t=>t._id===e._id)?t:[{...e,isNew:!0,userVote:"none"},...t])},t=e=>{c(t=>t.map(t=>t._id===e._id?{...t,...e}:t))},a=e=>{c(t=>t.filter(t=>t._id!==e))},s=e=>{c(t=>t.map(t=>t._id===e.itemId?{...t,score:e.score}:t))};return l.on("newReaditPost",e),l.on("postUpdated",t),l.on("postDeleted",a),l.on("postVoteUpdate",s),()=>{l.off("newReaditPost",e),l.off("postUpdated",t),l.off("postDeleted",a),l.off("postVoteUpdate",s)}},[l,i,h]);const w=e.useCallback(async()=>{await N(!0)},[N]),k=e.useCallback(()=>{!p&&j.current&&N(!1)},[N,p]);return{posts:d,isLoading:m,isFetchingMore:p,hasMore:j.current,sort:g,setSort:f,activeTab:h,setActiveTab:b,loadMore:k,refresh:w,isLoggedIn:y}},g=e.memo(({post:t})=>{var s,r;const x=o();if(!t||!t._id)return null;const{socket:g}=a(),[f,h]=e.useState(t),[b,v]=e.useState(!1);e.useEffect(()=>{h(t)},[t]),e.useEffect(()=>{if(!g||!t._id)return;const e=e=>{e._id===t._id&&h(t=>({...t,...e}))},a=e=>{e.itemId===t._id&&h(t=>({...t,score:e.score}))};return g.on("postUpdated",e),g.on("postVoteUpdate",a),()=>{g.off("postUpdated",e),g.off("postVoteUpdate",a)}},[g,t._id]);const{author:j,title:y,content:N,community:w,createdAt:k,_id:_,postType:C,image:P,url:S,commentCount:U,flair:V,isNew:$}=f,T=e=>{e.stopPropagation()};return i.jsxs(n.div,{initial:$?{opacity:0,y:-20,scale:.95}:{opacity:0,y:20},animate:{opacity:1,y:0,scale:1},whileHover:{y:-2},onHoverStart:()=>v(!0),onHoverEnd:()=>v(!1),onClick:e=>{e.target.closest("button")||e.target.closest("[data-no-navigate]")||x(`/readit/post/${_}`)},className:`relative bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border border-gray-200/50 dark:border-gray-800/50 rounded-2xl overflow-hidden transition-all duration-300 cursor-pointer ${b?"shadow-xl border-orange-200 dark:border-orange-800/50":"shadow-sm"} ${$?"ring-2 ring-orange-500 ring-opacity-50":""}`,children:[$&&i.jsx("div",{className:"absolute top-3 right-3 px-2 py-1 bg-gradient-to-r from-orange-500 to-orange-500 text-white text-xs font-bold rounded-full shadow-lg",children:"NEW"}),i.jsx("div",{className:"p-4 md:p-5",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"hidden md:block","data-no-navigate":!0,children:i.jsx(u,{item:f,orientation:"vertical"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mb-2 flex-wrap",children:[w&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),(null==w?void 0:w.name)&&x(`/readit/c/${w.name}`)},className:"flex items-center gap-1.5 font-bold text-gray-900 dark:text-white hover:text-orange-500 transition-colors","data-no-navigate":!0,children:[i.jsx("div",{className:"w-5 h-5 rounded-md bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs shadow-sm",children:(null==w?void 0:w.icon)?i.jsx("img",{src:w.icon,alt:"",className:"w-full h-full rounded-md object-cover"}):w.name[0].toUpperCase()}),"c/",w.name]}),i.jsx("span",{className:"text-gray-300 dark:text-gray-700",children:"•"})]}),i.jsxs("span",{className:"flex items-center gap-1",children:["u/",null==(s=null==j?void 0:j.personal_info)?void 0:s.username,(null==(r=null==j?void 0:j.personal_info)?void 0:r.isVerified)&&i.jsx(l,{size:12})]}),i.jsx("span",{className:"text-gray-300 dark:text-gray-700",children:"•"}),i.jsx("span",{children:d(k)})]}),i.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[i.jsx("h2",{className:"text-lg md:text-xl font-bold text-gray-900 dark:text-white leading-tight flex-1 group-hover:text-orange-500 transition-colors",children:y}),V&&i.jsx(p,{flair:V,size:"sm"})]}),"image"===C&&P?i.jsx("div",{className:"mt-4 rounded-xl overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 max-h-[400px] flex justify-center",children:i.jsx(c,{src:P,alt:y,className:"max-h-[400px] w-auto object-contain"})}):"link"===C&&S?i.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",onClick:T,"data-no-navigate":!0,className:"mt-4 block p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200/50 dark:border-blue-800/50 rounded-xl hover:shadow-md transition-all group",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg text-white shadow-lg",children:i.jsx("i",{className:"fi fi-rr-link"})}),i.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium truncate flex-1 text-sm",children:S}),i.jsx("i",{className:"fi fi-rr-arrow-up-right-from-square text-sm text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})}):"text"===C&&N?i.jsx("p",{className:"mt-3 text-gray-600 dark:text-gray-400 line-clamp-3 text-sm leading-relaxed",children:N}):null,i.jsxs("div",{className:"flex items-center gap-3 mt-4 text-sm text-gray-500",children:[i.jsx("div",{className:"md:hidden","data-no-navigate":!0,children:i.jsx(u,{item:f,orientation:"horizontal",size:"sm"})}),i.jsxs(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[i.jsx("i",{className:"fi fi-rr-comment-alt text-orange-500"}),i.jsx("span",{className:"font-medium",children:U||0}),i.jsx("span",{className:"hidden sm:inline",children:"Comments"})]}),i.jsxs(n.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e=>{e.preventDefault(),e.stopPropagation();const t=`${window.location.origin}/readit/post/${_}`;navigator.share?navigator.share({title:y,url:t}).catch(()=>{navigator.clipboard.writeText(t),m.success("Link copied!")}):(navigator.clipboard.writeText(t),m.success("Link copied!"))},"data-no-navigate":!0,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[i.jsx("i",{className:"fi fi-rr-share"}),i.jsx("span",{className:"hidden sm:inline font-medium",children:"Share"})]})]})]})]})})]})});g.displayName="ReaditPostCard";export{g as R,x as u};
