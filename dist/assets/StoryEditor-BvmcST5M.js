import{r as e,j as s,u as l,M as t,F as a,P as r,Q as i,S as n,z as o,T as d}from"./vendor-react-B97CwnuL.js";import{U as c,a as m}from"./index-RWwxXIM8.js";import{R as u,T as x,U as p,W as g,X as h,Y as f,Z as b,$ as y,a0 as j,a1 as v,a2 as N,a3 as w}from"./vendor-misc-DLsXWmW-.js";import{U as S}from"./aws-DXbxUAlr.js";const k=["Gaming","News","Tech","Lifestyle","Sports","Entertainment","Films"],$=({tags:l=[],setTags:t})=>{const[a,r]=e.useState("");return s.jsxs("div",{className:"tags-input p-4 bg-white shadow-lg rounded-lg",children:[s.jsxs("div",{className:"flex flex-wrap items-center mb-4",children:[l.map((e,a)=>s.jsxs("div",{className:"tag bg-gray-200 rounded-full px-3 py-1 m-1 flex items-center shadow-sm",children:[s.jsxs("span",{className:"mr-2 text-gray-700",children:["#",e]}),s.jsx("button",{type:"button",className:"text-red-500 ml-2 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-full w-5 h-5 flex items-center justify-center transition-colors",onClick:()=>(e=>{t(l.filter((s,l)=>l!==e))})(a),"aria-label":`Remove tag ${e}`,children:s.jsx("i",{className:"fi fi-br-cross text-[10px]"})})]},a)),l.length<5&&s.jsx("input",{type:"text",value:a,onChange:e=>r(e.target.value),onKeyDown:e=>{("Enter"===e.key||","===e.key||" "===e.key)&&l.length<5&&(e.preventDefault(),""!==a.trim()&&(t([...l,a.trim()]),r("")))},placeholder:"Add Topics",className:"input-box border border-dark-grey rounded-full pl-4 py-2 m-1 flex-grow shadow-sm","aria-label":"Add a topic"})]}),s.jsxs("div",{className:"flex flex-wrap items-center",children:[s.jsx("p",{className:"text-gray-600 mb-2 w-full",children:"Suggested Topics"}),k.map((e,a)=>s.jsxs("button",{type:"button",className:"bg-dark-grey bg-opacity-30 hover:bg-opacity-40 text-gray-700 rounded-full px-3 py-1 m-1 shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400",onClick:()=>(e=>{l.length<5&&!l.includes(e)&&t([...l,e])})(e),"aria-label":`Add tag ${e}`,children:["#",e]},a))]})]})},C=5242880;function T({slide:e,index:l,removeSlide:t,handleSlideUpload:a,setStory:n}){const{attributes:o,listeners:c,setNodeRef:m,transform:u,transition:x}=N({id:`slide-${l}`}),p={transform:w.Transform.toString(u),transition:x};return s.jsxs("div",{ref:m,style:p,className:"border rounded-2xl p-4 bg-white shadow-sm hover:shadow-lg transition",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("div",{...o,...c,className:"flex items-center gap-2 cursor-move text-gray-600 outline-none",children:s.jsxs("span",{className:"font-medium",children:["Slide ",l+1]})}),s.jsx("button",{type:"button",onClick:()=>t(l),className:"text-red-500 hover:text-red-600",children:s.jsx(d,{size:20})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"border-2 border-dashed rounded-2xl p-4 relative",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>a(e.target.files[0],l),className:"hidden",id:`slide-upload-${l}`}),s.jsx("label",{htmlFor:`slide-upload-${l}`,className:"cursor-pointer block text-center h-full",children:e.url?s.jsx("img",{src:e.url,alt:`Slide ${l+1}`,className:"max-h-60 mx-auto rounded-2xl object-cover w-full h-full"}):s.jsx("div",{className:"text-gray-500 py-8",children:e.loading?s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(r,{className:"animate-spin text-4xl mb-2"}),s.jsx("p",{children:"Uploading..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{className:"text-4xl mx-auto mb-2"}),s.jsx("p",{children:e.error||"Click to upload image"})]})})})]}),s.jsx("div",{className:"h-full",children:s.jsx("textarea",{value:e.description,onChange:e=>{n(s=>{const t=[...s.slides];return t[l]={...t[l],description:e.target.value},{...s,slides:t}})},placeholder:"Slide description...",className:"w-full h-full p-2 border rounded-2xl"})})]})]})}function z(){const[d,N]=e.useState({title:"",banner:null,slides:[],tags:[]}),[w,k]=e.useState({publishing:!1}),z=l(),{userAuth:{access_token:M}}=e.useContext(c),P=u(x(v),x(j,{coordinateGetter:y})),{getRootProps:U,getInputProps:I}=t({accept:{"image/jpeg":[],"image/png":[],"image/webp":[],"image/jpg":[]},multiple:!1,maxSize:C,onDrop:async e=>{const s=e[0];if(s)if(s.type.startsWith("image/"))if(s.size>C)o.error("File too large. Maximum file size is 5MB.");else try{const{url:e}=await S(s);N(s=>({...s,banner:e})),o.success("Banner uploaded successfully!")}catch(l){o.error("Banner upload failed")}else o.error("Invalid file type. Please upload an image.")}}),B=async(e,s)=>{if(!e.type.startsWith("image/"))return void o.error("Invalid file type. Please upload an image.");if(e.size>C)return void o.error("File too large. Maximum file size is 5MB.");const l=[...d.slides];l[s]={...l[s],loading:!0,error:null},N(e=>({...e,slides:l}));try{const{url:l}=await S(e);N(e=>{const t=[...e.slides];return t[s]={...t[s],url:l,loading:!1,file:null},{...e,slides:t}}),o.success(`Slide ${s+1} uploaded!`)}catch(t){N(e=>{const l=[...e.slides];return l[s]={...l[s],loading:!1,error:"Upload failed. Click to retry."},{...e,slides:l}}),o.error(`Slide ${s+1} upload failed`)}},F=e=>{N(s=>({...s,slides:s.slides.filter((s,l)=>l!==e)}))};return s.jsxs("div",{className:"max-w-4xl mx-auto p-8 bg-gray-50 rounded-2xl shadow-xl",children:[s.jsx(a,{position:"top-right"}),s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-800",children:d.title?d.title:"New Story"}),s.jsx("button",{type:"button",onClick:async()=>{var e,s;k({publishing:!0});try{if(!d.title||!d.banner||0===d.slides.length)throw new Error("Please fill all required fields before publishing");const e={title:d.title,banner:d.banner,tags:d.tags,draft:!1,images:d.slides.map(e=>({url:e.url,description:e.description}))};await m.post("/create-story",e),o.success("Story published successfully!"),z("/")}catch(l){o.error((null==(s=null==(e=l.response)?void 0:e.data)?void 0:s.error)||l.message||"Failed to publish story")}finally{k({publishing:!1})}},disabled:w.publishing,className:"flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-2xl hover:bg-green-700 disabled:opacity-50 transition",children:w.publishing?s.jsx(r,{className:"animate-spin"}):"Publish"})]}),s.jsxs("form",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Title *"}),s.jsx("input",{type:"text",value:d.title,onChange:e=>N(s=>({...s,title:e.target.value})),className:"w-full p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition",placeholder:"Enter story title",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Banner *"}),s.jsxs("div",{...U(),className:"border-2 border-dashed rounded-2xl p-8 text-center cursor-pointer hover:border-blue-500 transition-colors min-h-[300px] flex items-center justify-center bg-white",children:[s.jsx("input",{...I()}),d.banner?s.jsx("img",{src:d.banner,alt:"Banner preview",className:"max-h-80 mx-auto rounded-2xl object-cover"}):s.jsxs("div",{className:"text-gray-500",children:[s.jsx(i,{className:"text-5xl mx-auto mb-4"}),s.jsx("p",{children:"Drag & drop banner image or click to select"}),s.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"High resolution images work best"})]})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Slides ",d.slides.length>0&&`(${d.slides.length})`]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("label",{className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl cursor-pointer hover:bg-blue-700 transition",children:[s.jsx(n,{})," Upload Multiple Slides",s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const s=e.target.files;if(!s||0===s.length)return;const l=Array.from(s).filter(e=>e.type.startsWith("image/")?!(e.size>C)||(o.error(`${e.name} is too large. Maximum file size is 5MB.`),!1):(o.error(`${e.name} is not a valid image file.`),!1));0!==l.length&&(N(e=>({...e,slides:[...e.slides,...l.map(e=>({url:"",description:"",file:e,loading:!0,error:null}))]})),await Promise.all(l.map(async e=>{try{const{url:s}=await S(e);N(l=>{const t=[...l.slides],a=t.findIndex(s=>s.file===e);return-1!==a&&(t[a]={...t[a],url:s,loading:!1,file:null}),{...l,slides:t}}),o.success("Image uploaded!")}catch(s){N(s=>{const l=[...s.slides],t=l.findIndex(s=>s.file===e);return-1!==t&&(l[t]={...l[t],loading:!1,error:"Upload failed. Click to retry."}),{...s,slides:l}}),o.error("An image upload failed")}})),e.target.value=null)},className:"hidden"})]})})]}),s.jsx(p,{sensors:P,collisionDetection:g,onDragEnd:e=>{const{active:s,over:l}=e;s.id!==l.id&&N(e=>{const t=parseInt(s.id.split("-")[1]),a=parseInt(l.id.split("-")[1]);return{...e,slides:b(e.slides,t,a)}})},children:s.jsx(h,{items:d.slides.map((e,s)=>`slide-${s}`),strategy:f,children:s.jsx("div",{className:"space-y-4",children:d.slides.map((e,l)=>s.jsx(T,{index:l,slide:e,removeSlide:F,handleSlideUpload:B,setStory:N},`slide-${l}`))})})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (max 5)"}),s.jsx($,{tags:d.tags,setTags:e=>N(s=>({...s,tags:e}))})]})]})]})}const M=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{z as S,$ as T,M as a};
