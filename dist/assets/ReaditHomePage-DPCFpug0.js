import{r as s,u as L,a as f,c as I,j as e,I as Y,A as $,m as A,L as t,b as E}from"./index-MvaMJuCp.js";import{R as z}from"./ReaditPostCard-C2qOfC0i.js";import"./VoteButtons-fyW-aTpy.js";const j=()=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 mb-4 shadow-sm border border-gray-200 dark:border-gray-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsx("div",{className:"h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-20 w-full bg-gray-200 dark:bg-gray-700 rounded"})]}),B=()=>{const{userAuth:i}=s.useContext(L),[o,u]=s.useState("Popular Posts"),[l,v]=s.useState("hot"),[N,k]=s.useState(!1),[h,c]=s.useState([]),[w,C]=s.useState([]),[P,b]=s.useState(!0),[y,p]=s.useState(!1),g=s.useRef(1),x=s.useRef(!0),a=s.useMemo(()=>!!(i!=null&&i.access_token),[i]),F=async()=>{try{const{data:r}=await f.get("/readit/communities/popular");C(r||[])}catch(r){console.error("Failed to fetch communities:",r)}},m=s.useCallback(async(r=!1)=>{r?(g.current=1,x.current=!0,c([]),b(!0)):p(!0);let n="/readit/posts/public";o==="Your Feed"&&a&&(n="/readit/posts/feed");try{const{data:d}=await f.get(`${n}?sort=${l}&page=${g.current}&limit=10`);c(r?d.posts||[]:R=>[...R,...d.posts||[]]),x.current=d.hasMore,g.current+=1}catch(d){console.error("Failed to fetch posts:",d),I.error("Could not load posts")}finally{b(!1),p(!1)}},[o,l,a]);s.useEffect(()=>{F()},[]),s.useEffect(()=>{if(!a&&o==="Your Feed"){u("Popular Posts");return}m(!0)},[m,o,l,a]);const S=r=>u(r),M=()=>k(r=>!r);return e.jsxs("div",{className:"max-w-6xl mx-auto flex gap-8 justify-center p-4",children:[e.jsxs("div",{className:"w-full md:max-w-2xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx(Y,{routes:["Popular Posts","Your Feed"],defaultHidden:a?[]:["Your Feed"],defaultActiveIndex:o==="Your Feed"?1:0,onRouteChange:S}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:["hot","new","top"].map(r=>e.jsx("button",{onClick:()=>v(r),className:`px-3 py-1 text-sm rounded-md capitalize transition-all ${l===r?"bg-white dark:bg-gray-700 text-orange-500 shadow-sm font-bold":"text-gray-500 hover:text-gray-900 dark:hover:text-white"}`,children:r},r))}),a&&e.jsxs("div",{className:"relative z-20",children:[e.jsx("button",{onClick:M,className:"bg-orange-500 hover:bg-orange-600 text-white p-2 rounded-full shadow-lg transition-transform active:scale-95",children:e.jsx("i",{className:"fi fi-rr-plus text-xl block"})}),e.jsx($,{children:N&&e.jsxs(A.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs(t,{to:"/readit/create-post",className:"block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm",children:[e.jsx("i",{className:"fi fi-rr-edit mr-2 text-blue-500"})," Create Post"]}),e.jsxs(t,{to:"/readit/create-community",className:"block px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm border-t border-gray-100 dark:border-gray-700",children:[e.jsx("i",{className:"fi fi-rr-users mr-2 text-green-500"})," Create Community"]})]})})]})]})]}),e.jsx("div",{className:"min-h-[50vh]",children:P?e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsx(j,{})]}):h.length>0?e.jsxs(e.Fragment,{children:[h.map(r=>e.jsx(z,{post:r},r._id)),x.current&&e.jsx("button",{onClick:()=>m(!1),disabled:y,className:"w-full py-3 mt-4 text-blue-500 font-medium hover:bg-blue-50 dark:hover:bg-gray-800 rounded-xl transition-colors",children:y?e.jsx(E,{}):"Load More Posts"})]}):e.jsxs("div",{className:"text-center py-10 bg-gray-50 dark:bg-gray-800/50 rounded-xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx("i",{className:"fi fi-rr-confetti text-4xl text-gray-400 mb-3 block"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"No posts yet"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Be the first to share something!"})]})})]}),e.jsx("div",{className:"hidden md:block w-80 shrink-0",children:e.jsxs("div",{className:"sticky top-24 space-y-6",children:[!a&&e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 dark:from-gray-800 dark:to-gray-800 border border-orange-100 dark:border-gray-700 p-5 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fi fi-rr-alien text-orange-500"})," New to Readit?"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Sign up to subscribe to communities and customize your feed."}),e.jsx(t,{to:"/signup",className:"btn-dark w-full block text-center py-2 rounded-lg",children:"Join Now"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsx("h3",{className:"font-bold text-sm uppercase tracking-wider text-gray-500",children:"Popular Communities"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:w.slice(0,5).map((r,n)=>e.jsxs(t,{to:`/readit/c/${r.name}`,className:"flex items-center gap-3 p-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("span",{className:"font-bold text-gray-400 w-4 text-center",children:n+1}),e.jsx("img",{src:r.icon||"/default-community.png",alt:r.name,className:"w-8 h-8 rounded-full bg-gray-200 object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-sm truncate text-gray-900 dark:text-white",children:["c/",r.name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.memberCount," members"]})]})]},r._id))})]}),e.jsxs("div",{className:"text-xs text-gray-400 px-2 flex flex-wrap gap-x-4 gap-y-2",children:[e.jsx(t,{to:"#",className:"hover:underline",children:"Privacy Policy"}),e.jsx(t,{to:"#",className:"hover:underline",children:"User Agreement"}),e.jsx("span",{children:"Â© 2025 Readit"})]})]})})]})};export{B as default};
