import{k as e,u as t,r as a,Z as s,b as r,j as l,_ as o,Y as i,$ as n,a0 as c,a1 as d,a2 as m}from"./vendor-react-FSHz6IhY.js";import{a as u,L as g}from"./index-DdTfkRPQ.js";import"./vendor-misc-DyOKPbcj.js";import"./vendor-socket-BtemFTwA.js";import"./vendor-utils-CuK_ifhU.js";import"./vendor-animation-CVt0Hee3.js";const x=(()=>{const e=document.getElementById("modal-root");if(e)return e;const t=document.createElement("div");return t.id="modal-root",document.body.appendChild(t),t})();function b(){const{story_id:b}=e(),f=t(),[h,p]=a.useState(null),[v,j]=a.useState(0),[y,w]=a.useState(!0),[N,k]=a.useState(0),[C,E]=a.useState(!1),[z,S]=a.useState(!1),L=a.useRef(null),M=e=>{m.error("Failed to load story content"),f(-1)};a.useEffect(()=>{w(!0),u.get(`/story/${b}`).then(({data:e})=>{p(e)}).catch(M).finally(()=>w(!1))},[b]),a.useEffect(()=>{var e;if(!(null==(e=null==h?void 0:h.images)?void 0:e.length)||C)return;let t=null,a=null;const s=e=>{t||(t=e);const r=e-t,l=Math.min(r/3e3*100,100);k(l),l<100?a=requestAnimationFrame(s):F()};return a=requestAnimationFrame(s),()=>{a&&cancelAnimationFrame(a)}},[v,h,C]);const F=()=>{j(e=>{const t=e+1;return t>=h.images.length?(f(-1),e):t}),k(0)},A=()=>{j(e=>Math.max(e-1,0)),k(0)},I=s({onSwipedLeft:()=>{h&&v<h.images.length-1&&F()},onSwipedRight:()=>{v>0&&A()},onSwipedUp:()=>f(-1),trackMouse:!0,preventDefaultTouchmoveEvent:!0,delta:30}),T=()=>{E(!0),S(!0)},_=()=>{E(!1),S(!1)};return y?r.createPortal(l.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-gradient-to-br from-blue-900 to-indigo-900 z-50",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx(g,{}),l.jsx("p",{className:"mt-4 text-white font-medium text-lg",children:"Loading story..."})]})}),x):h?r.createPortal(l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-95 backdrop-blur-md",onClick:e=>{L.current&&!L.current.contains(e.target)&&f(-1)},children:l.jsxs("div",{ref:L,className:"relative w-full h-full max-w-2xl max-h-[90vh] flex flex-col z-60 overflow-hidden rounded-xl shadow-2xl border border-gray-700",...I,onMouseEnter:T,onMouseLeave:_,onTouchStart:T,onTouchEnd:_,children:[l.jsx(o,{position:"top-center",autoClose:2e3,toastClassName:"bg-gray-800 text-white",progressClassName:"bg-gradient-to-r from-blue-500 to-indigo-500"}),l.jsxs("header",{className:"absolute top-0 left-0 right-0 z-10 p-4",children:[l.jsx("div",{className:"flex space-x-1 mb-3",children:h.images.map((e,t)=>l.jsx("div",{className:"h-1.5 flex-1 bg-gray-700 rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full "+(v===t?"bg-gradient-to-r from-blue-400 to-indigo-500":v>t?"bg-gray-400":"bg-gray-600"),style:{width:v===t?`${N}%`:v>t?"100%":"0%",transition:v===t?"width 0.05s linear":"none"}})},t))}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-800 bg-opacity-70 flex items-center justify-center backdrop-blur-sm border border-gray-600",children:l.jsxs("span",{className:"text-white text-sm font-bold",children:[v+1,"/",h.images.length]})}),l.jsx("h4",{className:"ml-3 text-white font-bold line-clamp-2 bg-gradient-to-br from-blue-900 to-indigo-900 p-2 drop-shadow-lg",children:h.title})]}),l.jsx("button",{onClick:()=>f(-1),"aria-label":"Close story",className:"text-white p-2 hover:bg-gray-800 hover:bg-opacity-50 rounded-full backdrop-blur-sm transition-all transform hover:rotate-90 duration-300",children:l.jsx(i,{size:28})})]})]}),l.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-black",children:[z&&l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:A,className:"absolute left-4 z-30 p-3 bg-gray-900 bg-opacity-60 rounded-full hover:bg-opacity-80 transition-all backdrop-blur-sm border border-gray-600 transform hover:-translate-x-1","aria-label":"Previous slide",children:l.jsx(n,{size:32,className:"text-white"})}),l.jsx("button",{onClick:F,className:"absolute right-4 z-30 p-3 bg-gray-900 bg-opacity-60 rounded-full hover:bg-opacity-80 transition-all backdrop-blur-sm border border-gray-600 transform hover:translate-x-1","aria-label":"Next slide",children:l.jsx(c,{size:32,className:"text-white"})})]}),l.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1/3 z-20 cursor-pointer",onClick:A}),l.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:l.jsx(d.LazyLoadImage,{src:h.images[v].url,alt:h.images[v].description||h.title,effect:"blur",className:"max-h-full max-w-full object-contain transition-opacity duration-300",wrapperClassName:"w-full h-full flex items-center justify-center",placeholderSrc:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'%3E%3C/svg%3E",onError:e=>{e.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 9" fill="%23cccccc"%3E%3Crect width="16" height="9"/%3E%3Ctext x="8" y="5" font-family="Arial" font-size="4" text-anchor="middle" fill="white"%3EImage not available%3C/text%3E%3C/svg%3E'}})}),l.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1/3 z-20 cursor-pointer",onClick:F})]}),l.jsx("footer",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/90 to-transparent p-4 z-10",children:l.jsx("div",{className:"text-white max-w-full",children:l.jsx("p",{className:"text-base md:text-lg line-clamp-3 font-medium drop-shadow-lg px-4 py-2 bg-black bg-opacity-40 rounded-lg backdrop-blur-sm",dangerouslySetInnerHTML:{__html:h.images[v].description}})})})]})}),x):null}export{b as default};
