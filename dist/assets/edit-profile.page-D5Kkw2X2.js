import{r as e,U as r,o as a,s as t,n as i,a as s,j as l,e as n,d as o,F as d}from"./index-CuIw7dka.js";import{I as c}from"./Input-vc2HwDKg.js";import{U as u}from"./aws-CUzQWC5M.js";const m=()=>{const{userAuth:m,userAuth:{access_token:g,id:p},setUserAuth:b}=e.useContext(r),[f,x]=e.useState(!0),[h,y]=e.useState(!1),[v,w]=e.useState({fullname:"",email:"",username:"",bio:"",profile_img:""}),[j,k]=e.useState({twitter:"",instagram:"",facebook:"",github:"",linkedin:"",website:""}),[N,_]=e.useState(150),[z,S]=e.useState({fullname:!1,username:!1,bio:!0}),[I,P]=e.useState(!1),[U,C]=e.useState(null),A=e.useRef(),R=e.useRef();e.useEffect(()=>{if(g)return R.current=a("https://spread-server-528420849904.us-central1.run.app",{auth:{token:`Bearer ${g}`}}),R.current.emit("joinProfileRoom",{userId:p}),R.current.on("profileUpdated",e=>{var r;if(e._id===p){const{personal_info:a,social_links:s}=e;w({fullname:a.fullname,email:a.email,username:a.username,bio:a.bio,profile_img:a.profile_img}),k({twitter:s.twitter||"",instagram:s.instagram||"",facebook:s.facebook||"",github:s.github||"",linkedin:s.linkedin||"",website:s.website||""}),_(150-((null==(r=a.bio)?void 0:r.length)||0));const l={...m,username:a.username,profile_img:a.profile_img};t("user",JSON.stringify(l)),b(l),i.success("Profile updated from another session!")}}),()=>{R.current&&R.current.disconnect()}},[g,p,m,b]),e.useEffect(()=>{g?s.post("/get-profile",{username:m.username}).then(({data:e})=>{var r;const{personal_info:a,social_links:t={}}=e;w({fullname:a.fullname,email:a.email,username:a.username,bio:a.bio,profile_img:a.profile_img}),k({twitter:t.twitter||"",instagram:t.instagram||"",facebook:t.facebook||"",github:t.github||"",linkedin:t.linkedin||"",website:t.website||""}),_(150-((null==(r=a.bio)?void 0:r.length)||0)),x(!1)}).catch(e=>{i.error("Failed to load profile. Please try again."),x(!1)}):window.location.href="/signin"},[g,m.username]),e.useEffect(()=>{var e,r;const a=(null==(e=v.fullname)?void 0:e.trim().length)>=3,t=/^[a-zA-Z0-9_]{3,20}$/.test(v.username),i=(null==(r=v.bio)?void 0:r.length)<=150;S({fullname:a,username:t,bio:i}),P(a&&t&&i)},[v]);const E=(e,r)=>{w(a=>({...a,[e]:r}))};return f?l.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-80px)]",children:l.jsx(n,{})}):l.jsxs(o,{children:[l.jsx(d,{position:"top-center"}),l.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"relative mb-10 text-center",children:[l.jsx("div",{className:"absolute inset-0 flex items-center justify-center -z-10",children:l.jsx("div",{className:"w-64 h-64 bg-cyan-500/20 rounded-full blur-[100px] opacity-50 dark:opacity-20 animate-pulse"})}),l.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 via-blue-500 to-purple-600 dark:from-cyan-400 dark:via-blue-400 dark:to-purple-400 mb-2",children:"Customize Your Identity"}),l.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-lg",children:["Shape how the world sees you on ",l.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Shumse"}),"."]})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[l.jsx("div",{className:"lg:col-span-4 space-y-6",children:l.jsxs("div",{className:"bg-white/60 dark:bg-zinc-900/60 backdrop-blur-xl border border-gray-200 dark:border-zinc-800 rounded-3xl p-6 shadow-xl flex flex-col items-center relative overflow-hidden group",children:[l.jsx("div",{className:"absolute top-0 w-full h-1 bg-gradient-to-r from-cyan-500 to-purple-500"}),l.jsxs("div",{className:"relative w-40 h-40 mb-6 mt-4",children:[l.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-cyan-500 to-purple-600 blur-lg opacity-40 group-hover:opacity-60 transition-opacity duration-500"}),l.jsx("img",{ref:A,src:v.profile_img||"/default-profile.png",alt:"Profile",className:"w-full h-full object-cover rounded-full border-4 border-white dark:border-zinc-800 shadow-2xl relative z-10"}),l.jsxs("div",{className:"absolute bottom-0 right-2 z-20",children:[l.jsx("label",{htmlFor:"profileImg",className:"cursor-pointer bg-white dark:bg-zinc-800 text-gray-700 dark:text-gray-200 p-3 rounded-full shadow-lg border border-gray-100 dark:border-zinc-700 hover:scale-110 active:scale-95 transition-transform flex items-center justify-center",children:l.jsx("i",{className:"fi fi-rr-camera text-lg leading-none"})}),l.jsx("input",{type:"file",name:"profileImg",id:"profileImg",accept:".jpeg,.jpg,.png,.webp,.svg",className:"hidden",onChange:e=>{const r=e.target.files[0];r&&(A.current.src=URL.createObjectURL(r),C(r))}})]})]}),l.jsx("div",{className:"w-full",children:l.jsxs("button",{onClick:async e=>{var r;if(e.preventDefault(),!U)return void i.error("Please choose an image first.");const a=i.loading("Uploading image...");try{const e=await u(U);if(!e||!e.url)throw new Error("Upload failed: no URL returned");v.profile_img;w(r=>({...r,profile_img:e.url}));const l={url:e.url,profile_img:e.url};e.public_id&&(l.public_id=e.public_id,l.publicId=e.public_id,l.cloudinary_id=e.public_id);const n=await s.post("/changeImg",l),o=(null==(r=null==n?void 0:n.data)?void 0:r.profile_img)||e.url,d={...m,profile_img:o};t("user",JSON.stringify(d)),b(d),i.dismiss(a),C(null),i.success("Profile image updated!"),R.current.emit("forceProfileRefresh",{userId:p})}catch(l){w(e=>({...e,profile_img:e.profile_img})),i.dismiss(a),i.error("Failed to update image.")}},disabled:!U,className:"w-full py-3 rounded-xl font-bold transition-all duration-300 flex items-center justify-center gap-2 "+(U?"bg-gradient-to-r from-cyan-600 to-blue-600 text-white shadow-lg shadow-cyan-500/30 hover:shadow-cyan-500/50 hover:-translate-y-1":"bg-gray-100 dark:bg-zinc-800/50 text-gray-400 cursor-not-allowed"),children:[l.jsx("i",{className:"fi fi-rr-cloud-upload"}),U?"Upload New Photo":"Upload to Save"]})}),l.jsxs("div",{className:"mt-6 text-center",children:[l.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 uppercase tracking-widest font-semibold mb-1",children:"Current User"}),l.jsxs("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:["@",m.username]})]})]})}),l.jsxs("form",{onSubmit:async e=>{var r,a,l;if(e.preventDefault(),f)return i.error("Loading data, please wait.");if(!I)return i.error("Please fix validation errors before saving.");y(!0);const n={username:v.username.trim(),fullname:v.fullname.trim(),bio:v.bio.trim(),social_links:{twitter:j.twitter.trim(),instagram:j.instagram.trim(),facebook:j.facebook.trim(),github:j.github.trim(),linkedin:j.linkedin.trim(),website:j.website.trim()}};try{const{data:e}=await s.post("/update-profile",n),r={...m,username:e.username||n.username};t("user",JSON.stringify(r)),b(r),i.success("Profile updated successfully!"),R.current.emit("forceProfileRefresh",{userId:p})}catch(o){if(422===(null==(r=o.response)?void 0:r.status)&&Array.isArray(o.response.data.errors))o.response.data.errors.forEach(e=>{i.error(e)});else{const e=(null==(l=null==(a=o.response)?void 0:a.data)?void 0:l.error)||"An unexpected error occurred while saving.";i.error(e)}}finally{y(!1)}},className:"lg:col-span-8 space-y-6",children:[l.jsxs("div",{className:"bg-white/80 dark:bg-zinc-900/60 backdrop-blur-xl border border-gray-200 dark:border-zinc-800 rounded-3xl p-8 shadow-sm",children:[l.jsxs("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-6 flex items-center gap-2",children:[l.jsx("i",{className:"fi fi-rr-id-card-clip text-cyan-500"})," Personal Information"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[l.jsx(c,{name:"fullname",type:"text",label:"Full Name",value:v.fullname,onChange:e=>E("fullname",e.target.value),className:"capitalize",icon:"fi-rr-user",validation:z.fullname,helper:!z.fullname&&"Minimum 3 characters required."}),l.jsx(c,{name:"username",type:"text",label:"Username",value:v.username,onChange:e=>E("username",e.target.value),icon:"fi-rr-at",validation:z.username,helper:!z.username&&"3-20 characters alphanumeric."})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(c,{name:"email",type:"email",label:"Email Address",value:v.email,icon:"fi-rr-envelope",validation:!0,readOnly:!0,className:"opacity-70"}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1 ml-1",children:[l.jsx("i",{className:"fi fi-rr-lock"})," Email cannot be changed."]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("label",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Bio"}),l.jsxs("span",{className:"text-xs font-bold "+(N<0?"text-red-500":"text-cyan-600"),children:[N," / 150"]})]}),l.jsx("textarea",{name:"bio",value:v.bio,onChange:e=>{E("bio",e.target.value),_(150-e.target.value.length)},maxLength:150,placeholder:"Tell the world who you are...",className:"w-full h-32 p-4 text-base border border-gray-200 dark:border-zinc-700 bg-gray-50 dark:bg-black/40 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent outline-none transition-all resize-none dark:text-white"})]})]}),l.jsxs("div",{className:"bg-white/80 dark:bg-zinc-900/60 backdrop-blur-xl border border-gray-200 dark:border-zinc-800 rounded-3xl p-8 shadow-sm",children:[l.jsxs("h3",{className:"text-xl font-bold text-gray-800 dark:text-white mb-6 flex items-center gap-2",children:[l.jsx("i",{className:"fi fi-rr-share text-purple-500"})," Social Presence"]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:Object.entries({website:{icon:"fi-rr-globe",label:"Website",placeholder:"https://"},twitter:{icon:"fi-brands-twitter",label:"Twitter",placeholder:"https://"},instagram:{icon:"fi-brands-instagram",label:"Instagram",placeholder:"https://"},facebook:{icon:"fi-brands-facebook",label:"Facebook",placeholder:"https://"},github:{icon:"fi-brands-github",label:"GitHub",placeholder:"https://"},linkedin:{icon:"fi-brands-linkedin",label:"LinkedIn",placeholder:"https://"}}).map(([e,r])=>l.jsxs("div",{className:"relative group",children:[l.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:l.jsx("i",{className:`fi ${r.icon} text-gray-400 group-focus-within:text-cyan-500 transition-colors text-lg`})}),l.jsx("input",{name:e,type:"url",value:j[e]||"",onChange:r=>((e,r)=>{k(a=>({...a,[e]:r}))})(e,r.target.value),placeholder:r.label,className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-black/40 border border-gray-200 dark:border-zinc-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all dark:text-white placeholder-gray-400 text-sm"})]},e))})]}),l.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[l.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-2.5 rounded-xl font-semibold text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors",children:"Cancel"}),l.jsx("button",{type:"submit",disabled:!I||h,className:"px-10 py-3 rounded-xl font-bold text-white shadow-lg transition-all duration-300 flex items-center gap-2 "+(I&&!h?"bg-gradient-to-r from-cyan-600 via-blue-600 to-purple-600 hover:scale-105 hover:shadow-blue-500/40":"bg-gray-400 dark:bg-zinc-700 cursor-not-allowed opacity-70"),children:h?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})]})]})};export{m as default};
