import{r as e,V as t,j as r}from"./vendor-react-FSHz6IhY.js";import{a,U as o}from"./index-DdTfkRPQ.js";const s=t=>{const[r,o]=e.useState(null),[s,n]=e.useState(!0),[i,u]=e.useState(null);return e.useEffect(()=>{if(!t)return;(async()=>{n(!0);try{const{data:e}=await a.get(`/readit/posts/${t}`);o(e)}catch(e){u(e)}finally{n(!1)}})()},[t]),{post:r,loading:s,error:i,setPost:o}},n=async(e,t)=>await a.put(`/readit/posts/${e}/vote`,{voteType:t}),i=async(e,t)=>await a.put(`/readit/comments/${e}/vote`,{voteType:t}),u=(e,r="Something went wrong")=>{var a,o;const s=(null==(o=null==(a=e.response)?void 0:a.data)?void 0:o.error)||r;return t.error(s),s},l=({item:a,isComment:s=!1})=>{const{userAuth:l}=e.useContext(o);if(!a)return null;const[c,d]=e.useState(a.score||0),[p,x]=e.useState(a.userVote||"none"),[f,m]=e.useState(!1);e.useEffect(()=>{d(a.score||0),x(a.userVote||"none")},[a.score,a.userVote]);const g=async e=>{if(!(null==l?void 0:l.access_token))return t.error("Please login to vote");if(f)return;const r=p,o=c;let g=e;r===e&&(g="none");let w=c;"up"===r&&w--,"down"===r&&w++,"up"===g&&w++,"down"===g&&w--,x(g),d(w),m(!0);try{const e=s?i:n;await e(a._id,g)}catch(v){u(v,"Vote failed"),x(r),d(o)}finally{m(!1)}};return r.jsxs("div",{className:"flex flex-col items-center "+(s?"gap-0":"gap-1"),children:[r.jsx("button",{onClick:()=>g("up"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("up"===p?"text-orange-500":"text-gray-400 hover:text-orange-500"),"aria-label":"Upvote",children:r.jsx("i",{className:`fi ${"up"===p?"fi-sr-arrow-square-up":"fi-rr-arrow-square-up"} text-2xl`,"aria-hidden":"true"})}),r.jsx("span",{className:"text-sm font-bold "+("up"===p?"text-orange-500":"down"===p?"text-blue-500":"text-black dark:text-white"),children:Intl.NumberFormat("en-US",{notation:"compact"}).format(c)}),r.jsx("button",{onClick:()=>g("down"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("down"===p?"text-blue-500":"text-gray-400 hover:text-blue-500"),"aria-label":"Downvote",children:r.jsx("i",{className:`fi ${"down"===p?"fi-sr-arrow-square-down":"fi-rr-arrow-square-down"} text-2xl`,"aria-hidden":"true"})})]})};export{l as V,u as h,s as u};
