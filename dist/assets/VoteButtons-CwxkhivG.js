import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{r as t}from"./vendor-react-B32pNUrn.js";import{a as r,U as o}from"./index-DPOBqJFm.js";import{V as a}from"./vendor-ui-BqXYh4xT.js";const s=e=>{const[o,a]=t.useState(null),[s,n]=t.useState(!0),[i,u]=t.useState(null);return t.useEffect(()=>{if(!e)return;(async()=>{n(!0);try{const{data:t}=await r.get(`/readit/posts/${e}`);a(t)}catch(t){u(t)}finally{n(!1)}})()},[e]),{post:o,loading:s,error:i,setPost:a}},n=async(e,t)=>await r.put(`/readit/posts/${e}/vote`,{voteType:t}),i=async(e,t)=>await r.put(`/readit/comments/${e}/vote`,{voteType:t}),u=(e,t="Something went wrong")=>{var r,o;const s=(null==(o=null==(r=e.response)?void 0:r.data)?void 0:o.error)||t;return a.error(s),s},l=({item:r,isComment:s=!1})=>{const{userAuth:l}=t.useContext(o);if(!r)return null;const[c,d]=t.useState(r.score||0),[p,m]=t.useState(r.userVote||"none"),[x,f]=t.useState(!1);t.useEffect(()=>{d(r.score||0),m(r.userVote||"none")},[r.score,r.userVote]);const v=async e=>{if(!(null==l?void 0:l.access_token))return a.error("Please login to vote");if(x)return;const t=p,o=c;let v=e;t===e&&(v="none");let w=c;"up"===t&&w--,"down"===t&&w++,"up"===v&&w++,"down"===v&&w--,m(v),d(w),f(!0);try{const e=s?i:n;await e(r._id,v)}catch(g){u(g,"Vote failed"),m(t),d(o)}finally{f(!1)}};return e.jsxs("div",{className:"flex flex-col items-center "+(s?"gap-0":"gap-1"),children:[e.jsx("button",{onClick:()=>v("up"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("up"===p?"text-orange-500":"text-gray-400 hover:text-orange-500"),"aria-label":"Upvote",children:e.jsx("i",{className:`fi ${"up"===p?"fi-sr-arrow-square-up":"fi-rr-arrow-square-up"} text-2xl`,"aria-hidden":"true"})}),e.jsx("span",{className:"text-sm font-bold "+("up"===p?"text-orange-500":"down"===p?"text-blue-500":"text-black dark:text-white"),children:Intl.NumberFormat("en-US",{notation:"compact"}).format(c)}),e.jsx("button",{onClick:()=>v("down"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("down"===p?"text-blue-500":"text-gray-400 hover:text-blue-500"),"aria-label":"Downvote",children:e.jsx("i",{className:`fi ${"down"===p?"fi-sr-arrow-square-down":"fi-rr-arrow-square-down"} text-2xl`,"aria-hidden":"true"})})]})};export{l as V,u as h,s as u};
