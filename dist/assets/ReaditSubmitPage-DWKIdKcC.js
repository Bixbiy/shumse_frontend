import{g as e,u as t,r as s,j as a,H as r,z as o}from"./vendor-react-B97CwnuL.js";import{I as i,U as n}from"./index-RWwxXIM8.js";import{a5 as d}from"./vendor-misc-DLsXWmW-.js";import{U as l}from"./aws-DXbxUAlr.js";import{a as u}from"./vendor-utils-8sZVtwSW.js";import"./vendor-socket-CKUjeMYl.js";import"./vendor-animation-Bq1BCxLt.js";const m=()=>{const{communityName:m}=e(),c=t(),{userAuth:p}=s.useContext(userContext),x=s.useRef();s.useRef(0);const[g,h]=s.useState("text"),[j,v]=s.useState(""),[f,b]=s.useState(""),[y,N]=s.useState(""),[k,C]=s.useState(""),{mutate:w,isLoading:S}=(()=>{const e=d(),{userAuth:t}=s.useContext(n);return useMutation({mutationFn:({communityName:e,postData:s})=>u.post(`https://spread-server.onrender.com/api/v1/readit/c/${e}/posts`,s,{headers:{Authorization:`Bearer ${t.access_token}`}}),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["communityPosts",s.communityName]}),o.success("Post created!")},onError:e=>{var t,s;o.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||"Failed to create post.")}})})();return a.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[a.jsx(r,{children:a.jsxs("title",{children:["Submit to c/",m]})}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create a Post"}),a.jsxs("p",{className:"text-dark-grey mb-4",children:["Posting to ",a.jsxs("span",{className:"font-semibold",children:["c/",m]})]}),a.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark",children:[a.jsx(i,{ref:x,routes:["Text","Image","Link"],defaultIndex:0,onChange:(e,t)=>{h(e.innerText.toLowerCase())}}),a.jsxs("div",{className:"p-4",children:[a.jsx("input",{type:"text",placeholder:"Title",value:j,onChange:e=>v(e.target.value),className:"input-box mb-4 text-2xl font-semibold"}),"text"===g&&a.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:f,onChange:e=>b(e.target.value),className:"input-box h-40"}),"image"===g&&a.jsxs("div",{className:"border border-dashed border-grey p-4 rounded-md text-center",children:[a.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;let s=o.loading("Uploading image...");try{const e=await l(t);C(e),o.success("Image uploaded!")}catch(a){o.error("Image upload failed.")}finally{o.dismiss(s)}},className:"hidden"}),a.jsx("label",{htmlFor:"upload-image-input",className:"cursor-pointer text-blue hover:underline",children:k?"Change Image":"Upload Image"}),k&&a.jsx("img",{src:k,alt:"Post preview",className:"w-full rounded-md mt-4"})]}),"link"===g&&a.jsx("input",{type:"url",placeholder:"https://your-link.com",value:y,onChange:e=>N(e.target.value),className:"input-box"}),a.jsx("div",{className:"flex justify-end mt-4",children:a.jsx("button",{onClick:()=>{if(!j.trim())return o.error("A title is required.");if("link"===g&&!y)return o.error("A URL is required.");if("image"===g&&!k)return o.error("An image is required.");w({communityName:m,postData:{title:j,postType:g,content:"text"===g?f:void 0,url:"link"===g?y:void 0,image:"image"===g?k:void 0}},{onSuccess:e=>{c(`/readit/post/${e.data._id}`)}})},disabled:S,className:"btn-dark px-8",children:S?"Posting...":"Post"})})]})]})]})};export{m as default};
