import{r as e,a as t,z as r,U as a,j as o}from"./index-BK9O-y3K.js";const s=r=>{const[a,o]=e.useState(null),[s,n]=e.useState(!0),[i,u]=e.useState(null);return e.useEffect(()=>{if(!r)return;(async()=>{n(!0);try{const{data:e}=await t.get(`/readit/posts/${r}`);o(e)}catch(e){u(e)}finally{n(!1)}})()},[r]),{post:a,loading:s,error:i,setPost:o}},n=async(e,r)=>await t.put(`/readit/posts/${e}/vote`,{voteType:r}),i=async(e,r)=>await t.put(`/readit/comments/${e}/vote`,{voteType:r}),u=(e,t="Something went wrong")=>{var a,o;const s=(null==(o=null==(a=e.response)?void 0:a.data)?void 0:o.error)||t;return r.error(s),s},l=({item:t,isComment:s=!1})=>{const{userAuth:l}=e.useContext(a);if(!t)return null;const[c,d]=e.useState(t.score||0),[x,p]=e.useState(t.userVote||"none"),[f,g]=e.useState(!1);e.useEffect(()=>{d(t.score||0),p(t.userVote||"none")},[t.score,t.userVote]);const m=async e=>{if(!(null==l?void 0:l.access_token))return r.error("Please login to vote");if(f)return;const a=x,o=c;let m=e;a===e&&(m="none");let w=c;"up"===a&&w--,"down"===a&&w++,"up"===m&&w++,"down"===m&&w--,p(m),d(w),g(!0);try{const e=s?i:n;await e(t._id,m)}catch(h){u(h,"Vote failed"),p(a),d(o)}finally{g(!1)}};return o.jsxs("div",{className:"flex flex-col items-center "+(s?"gap-0":"gap-1"),children:[o.jsx("button",{onClick:()=>m("up"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("up"===x?"text-orange-500":"text-gray-400 hover:text-orange-500"),"aria-label":"Upvote",children:o.jsx("i",{className:`fi ${"up"===x?"fi-sr-arrow-square-up":"fi-rr-arrow-square-up"} text-2xl`,"aria-hidden":"true"})}),o.jsx("span",{className:"text-sm font-bold "+("up"===x?"text-orange-500":"down"===x?"text-blue-500":"text-black dark:text-white"),children:Intl.NumberFormat("en-US",{notation:"compact"}).format(c)}),o.jsx("button",{onClick:()=>m("down"),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors "+("down"===x?"text-blue-500":"text-gray-400 hover:text-blue-500"),"aria-label":"Downvote",children:o.jsx("i",{className:`fi ${"down"===x?"fi-sr-arrow-square-down":"fi-rr-arrow-square-down"} text-2xl`,"aria-hidden":"true"})})]})};export{l as V,u as h,s as u};
