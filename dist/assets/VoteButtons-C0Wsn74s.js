import{r as e,U as t,b as a,z as o,a as i,j as r,m as n,A as s}from"./index-vd7Ycuse.js";const d="up",l="down",c="none",g=4,u=({value:e})=>r.jsx("div",{className:"relative h-6 overflow-hidden min-w-[2ch] flex justify-center",children:r.jsx(s,{mode:"popLayout",initial:!1,children:r.jsx(n.span,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"absolute inset-0 flex items-center justify-center font-bold",children:Intl.NumberFormat("en-US",{notation:"compact"}).format(e)},e)})}),p=({item:s,isComment:g=!1,orientation:p="vertical",size:m="md"})=>{const{userAuth:x}=e.useContext(t),{socket:f}=a();if(!s)return null;const[v,b]=e.useState(s.score||0),[h,y]=e.useState(s.userVote||c),[w,j]=e.useState(!1),$=!!(null==x?void 0:x.access_token);e.useEffect(()=>{b(s.score||0),y(s.userVote||c)},[s.score,s.userVote]),e.useEffect(()=>{if(!f||!s._id)return;const e=g?"commentVoteUpdate":"postVoteUpdate",t=e=>{e.itemId===s._id&&b(e.score)};return f.on(e,t),()=>f.off(e,t)},[f,s._id,g]);const k=e.useCallback(async e=>{var t,a;if(!$)return o.error("Please login to vote");if(w)return;const r=h,n=v;let u=e;r===e&&(u=c);let p=v;r===d&&p--,r===l&&p++,u===d&&p++,u===l&&p--,y(u),b(p),j(!0);try{const e=g?`/readit/comments/${s._id}/vote`:`/readit/posts/${s._id}/vote`,{data:t}=await i.put(e,{voteType:u});void 0!==t.score&&b(t.score),void 0!==t.userVote&&y(t.userVote)}catch(m){const e=(null==(a=null==(t=m.response)?void 0:t.data)?void 0:a.error)||"Vote failed";o.error(e),y(r),b(n)}finally{j(!1)}},[$,w,h,v,g,s._id]),N="horizontal"===p,V={sm:{icon:"text-lg",padding:"p-1",container:"gap-0.5"},md:{icon:"text-2xl",padding:"p-1.5",container:"gap-1"},lg:{icon:"text-3xl",padding:"p-2",container:"gap-1.5"}},_=V[m]||V.md;return r.jsxs("div",{className:`flex ${N?"flex-row":"flex-col"} items-center ${_.container} bg-gray-50/50 dark:bg-gray-800/50 rounded-xl p-0.5`,children:[r.jsx(n.button,{onClick:e=>{e.stopPropagation(),k(d)},whileTap:{scale:.85},whileHover:{scale:1.1},disabled:w,className:`${_.padding} rounded-lg transition-all duration-200 ${h===d?"text-orange-500 bg-orange-100 dark:bg-orange-500/20":"text-gray-400 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10"} disabled:opacity-50`,"aria-label":"Upvote",children:r.jsx("i",{className:`fi ${h===d?"fi-sr-arrow-square-up":"fi-rr-arrow-square-up"} ${_.icon} leading-none`})}),r.jsx("span",{className:`text-sm font-bold ${N?"min-w-[2.5rem]":"min-w-[2rem]"} text-center transition-colors ${h===d?"text-orange-500":h===l?"text-indigo-500":"text-gray-900 dark:text-gray-300"}`,children:r.jsx(u,{value:v})}),r.jsx(n.button,{onClick:e=>{e.stopPropagation(),k(l)},whileTap:{scale:.85},whileHover:{scale:1.1},disabled:w,className:`${_.padding} rounded-lg transition-all duration-200 ${h===l?"text-indigo-500 bg-indigo-100 dark:bg-indigo-500/20":"text-gray-400 hover:text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-500/10"} disabled:opacity-50`,"aria-label":"Downvote",children:r.jsx("i",{className:`fi ${h===l?"fi-sr-arrow-square-down":"fi-rr-arrow-square-down"} ${_.icon} leading-none`})})]})};export{g as M,p as V};
