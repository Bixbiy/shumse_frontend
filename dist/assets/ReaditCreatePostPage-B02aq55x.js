import{r as e,j as t,A as a,m as s,e as r,a as l,g as i,U as n,H as o,z as d}from"./index-BK9O-y3K.js";import{U as c}from"./aws-B787dLGz.js";const m=({mode:i,postContext:n,onClose:o,onGenerate:d})=>{const[c,m]=e.useState(""),[x,u]=e.useState(!1),[g,p]=e.useState(""),h="post"===i?"AI Post Generator":"AI Comment Generator",y="post"===i?"Enter a topic for the post:":"AI will generate a reply to this post:",b="post"===i?"Generate Post":"Generate Comment";return t.jsx(a,{children:t.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4",onClick:o,role:"dialog","aria-modal":"true",children:t.jsxs(s.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:25},className:"bg-white dark:bg-dark-grey-2 rounded-lg shadow-xl w-full max-w-lg p-6 m-4",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("h3",{className:"text-xl font-semibold text-dark-grey dark:text-white flex items-center",children:[t.jsx("i",{className:"fi fi-rr-sparkles text-blue-500 mr-2"}),h]}),t.jsx("button",{onClick:o,className:"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-grey",children:t.jsx("i",{className:"fi fi-rr-cross text-sm"})})]}),g&&t.jsx("p",{className:"text-red-500 text-sm mb-3",children:g}),t.jsxs("form",{onSubmit:async e=>{var t,a;if(e.preventDefault(),"post"!==i||c.trim()){u(!0),p("");try{const{data:e}=await l.post("/ai/generate",{prompt:"post"===i?c:null,context:"comment"===i?n:null,mode:i});"post"===i?d(e.title,e.content):d(e.content)}catch(s){p((null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.error)||"Failed to generate content. Please try again.")}finally{u(!1)}}},children:[t.jsx("label",{className:"block text-sm font-medium text-dark-grey dark:text-gray-300 mb-2",children:y}),"post"===i?t.jsx("input",{type:"text",className:"w-full bg-gray-100 dark:bg-grey border border-gray-200 dark:border-grey rounded-md p-2.5 text-sm dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",value:c,onChange:e=>m(e.target.value),placeholder:"e.g., 'The future of space travel'",required:!0}):t.jsxs("div",{className:"border border-gray-200 dark:border-grey rounded-md p-3 mb-4 bg-gray-50 dark:bg-grey max-h-32 overflow-y-auto",children:[t.jsx("p",{className:"text-sm font-semibold text-dark-grey dark:text-white line-clamp-1",children:n.title}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2",children:n.content})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{type:"submit",disabled:x||"post"===i&&!c.trim(),className:"btn-dark text-sm flex items-center justify-center disabled:opacity-50",children:[x?t.jsx(r,{}):t.jsx("i",{className:"fi fi-rr-sparkles mr-2"}),t.jsx("span",{children:x?"Generating...":b})]})})]})]})})})},x=()=>{var x;const u=i(),{userAuth:g}=e.useContext(n),[p,h]=e.useState({communityName:"",title:"",content:"",postType:"text",url:"",image:""}),[y,b]=e.useState([]),[f,j]=e.useState(!0),[N,v]=e.useState(!1),[k,w]=e.useState(!1),[C,S]=e.useState(!1);e.useEffect(()=>{if(!(null==g?void 0:g.access_token))return;(async()=>{j(!0);try{const{data:e}=await l.get("/readit/user/communities");b(e||[])}catch(e){d.error("Could not load your communities.")}finally{j(!1)}})()},[null==g?void 0:g.access_token]);return(null==g?void 0:g.access_token)?t.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-8",children:[t.jsxs(o,{children:[t.jsx("title",{children:"Create Post | Readit"}),t.jsx("meta",{name:"description",content:"Create a new post - share text, images, or links with the community"})]}),t.jsx(a,{children:C&&t.jsx(m,{mode:"post",onClose:()=>S(!1),onGenerate:(e,t)=>{h(a=>({...a,title:e||a.title,content:t||a.content})),d.success("AI content generated!")}})}),t.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[t.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:t.jsx("i",{className:"fi fi-rr-edit text-2xl"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold leading-tight",children:"Create a Post"}),t.jsx("p",{className:"text-orange-100 text-sm",children:"Share with the community or post personally"})]})]})}),t.jsxs("form",{onSubmit:async e=>{var t,a;if(e.preventDefault(),!p.title.trim())return d.error("Title is required");if(p.title.length>300)return d.error("Title too long");w(!0);const s=p.communityName?`/readit/c/${p.communityName}/posts`:"/readit/posts/personal",r={title:p.title,content:p.content,postType:p.postType,url:p.url,image:p.image};try{const{data:e}=await l.post(s,r);d.success("Post created successfully!"),u(`/readit/post/${e._id}`)}catch(i){d.error((null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.error)||"Failed to create post.")}finally{w(!1)}},className:"p-6 md:p-8 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"communityName",className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:"Post to Community (Optional)"}),t.jsxs("div",{className:"relative",children:[t.jsx("i",{className:"fi fi-rr-users absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),t.jsxs("select",{id:"communityName",name:"communityName",value:p.communityName,onChange:e=>h(t=>({...t,communityName:e.target.value})),className:"input-box pl-10 appearance-none cursor-pointer",disabled:f,children:[t.jsxs("option",{value:"",children:["Post personally (u/",null==(x=g.personal_info)?void 0:x.username,")"]}),y.map(e=>t.jsxs("option",{value:e.name,children:["c/",e.name]},e._id))]}),t.jsx("i",{className:"fi fi-rr-angle-small-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{htmlFor:"title",className:"block text-sm font-bold text-gray-700 dark:text-gray-200",children:["Title ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("button",{type:"button",onClick:()=>S(!0),className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition-colors",children:[t.jsx("i",{className:"fi fi-rr-sparkles text-xs"}),"AI Assist"]})]}),t.jsx("input",{type:"text",id:"title",name:"title",value:p.title,onChange:e=>h(t=>({...t,title:e.target.value})),placeholder:"An interesting title that grabs attention...",className:"input-box text-lg font-semibold placeholder:font-normal focus:ring-2 focus:ring-orange-500",maxLength:300,required:!0}),t.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[t.jsxs("span",{children:["Post type: ",t.jsx("span",{className:"font-bold capitalize",children:p.postType})]}),t.jsxs("span",{children:[p.title.length,"/300"]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:"Content"}),t.jsx("textarea",{name:"content",value:p.content,onChange:e=>h(t=>({...t,content:e.target.value})),placeholder:"Share your thoughts, paste a URL, or upload an image...",className:"input-box min-h-[200px] resize-y text-sm leading-relaxed transition-all duration-200"})]}),t.jsx(a,{children:p.image&&t.jsx(s.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:t.jsxs("div",{className:"border-2 border-dashed border-green-200 dark:border-green-800 rounded-xl p-4 bg-green-50 dark:bg-green-900/20",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:[t.jsx("i",{className:"fi fi-rr-picture mr-2"}),"Image Uploaded"]}),t.jsx("button",{type:"button",onClick:()=>{h(e=>({...e,image:""}))},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Remove"})]}),t.jsx("img",{src:p.image,alt:"Post preview",className:"max-h-64 rounded-lg mx-auto shadow-md"})]})})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-100 dark:border-gray-700",children:[t.jsxs("label",{className:"flex items-center justify-center gap-2 py-3 rounded-xl font-bold cursor-pointer flex-1 transition-all "+(N?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"btn-light hover:bg-gray-100 dark:hover:bg-gray-700"),children:[N?t.jsx(r,{}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fi fi-rr-camera"}),"Upload Image"]}),t.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:async e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return d.error("Image size should be less than 5MB");v(!0);try{const e=await c(t),a="string"==typeof e?e:e.url;h(e=>({...e,image:a})),d.success("Image uploaded successfully!")}catch(a){d.error("Failed to upload image")}finally{v(!1)}}},disabled:N})]}),t.jsx("button",{type:"button",onClick:()=>u(-1),className:"flex-1 btn-light py-3 rounded-xl font-bold text-gray-500",disabled:k,children:"Cancel"}),t.jsx("button",{type:"submit",disabled:k||N||!p.title.trim(),className:"flex-[2] bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-orange-500/25",children:k?t.jsx(r,{}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fi fi-rr-paper-plane"}),"Create Post"]})})]})]})]})]}):t.jsxs("div",{className:"max-w-2xl mx-auto p-8 flex flex-col items-center justify-center min-h-[60vh]",children:[t.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-full p-6 mb-6",children:t.jsx("i",{className:"fi fi-rr-lock text-4xl text-yellow-600 dark:text-yellow-400"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Please sign in to share your thoughts."}),t.jsx("button",{onClick:()=>u("/signin"),className:"btn-dark px-8",children:"Sign In"})]})};export{x as default};
