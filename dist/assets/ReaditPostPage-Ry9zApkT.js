import{r as e,j as t,L as s,V as a,k as r,a3 as n}from"./vendor-react-FSHz6IhY.js";import{V as l,h as i,u as o}from"./VoteButtons-C563OZyL.js";import{U as c,g as d,a as m,L as x,S as u}from"./index-DdTfkRPQ.js";import"./vendor-misc-DyOKPbcj.js";import"./vendor-socket-BtemFTwA.js";import"./vendor-utils-CuK_ifhU.js";import"./vendor-animation-CVt0Hee3.js";const h=({comment:a,postId:r})=>{var n,o,x;const{userAuth:u}=e.useContext(c),{author:g,content:p,createdAt:b,_id:f,children:j=0}=a,[y,v]=e.useState(!1),[N,k]=e.useState(""),[w,C]=e.useState([]),[_,S]=e.useState(!1),[$,I]=e.useState(!1),P=async()=>{if(!_){I(!0);try{const{data:e}=await m.get(`/readit/comments/${f}/replies?limit=50`);C(e.replies),S(!0)}catch(e){i(e,"Failed to load replies")}finally{I(!1)}}};return t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:t.jsx("img",{src:null==(n=null==g?void 0:g.personal_info)?void 0:n.profile_img,alt:"",className:"w-full h-full object-cover"})}),t.jsx("div",{className:"w-0.5 flex-grow bg-gray-200 dark:bg-gray-700 my-2 group-hover:bg-gray-300"})]}),t.jsxs("div",{className:"flex-1 pb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[t.jsx(s,{to:`/user/${null==(o=null==g?void 0:g.personal_info)?void 0:o.username}`,className:"font-bold text-black dark:text-white hover:underline",children:null==(x=null==g?void 0:g.personal_info)?void 0:x.username}),t.jsx("span",{children:"•"}),t.jsx("span",{children:d(b)})]}),t.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-200 mb-2 whitespace-pre-wrap",children:p}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(l,{item:a,isComment:!0}),(null==u?void 0:u.access_token)&&t.jsxs("button",{onClick:()=>v(!y),className:"text-xs font-bold text-gray-500 hover:text-gray-900 dark:hover:text-white flex items-center gap-1",children:[t.jsx("i",{className:"fi fi-rr-comment"})," Reply"]})]}),y&&t.jsxs("div",{className:"mt-3 ml-2",children:[t.jsx("textarea",{className:"input-box text-sm p-2 h-20",placeholder:"What are your thoughts?",value:N,onChange:e=>k(e.target.value)}),t.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[t.jsx("button",{onClick:()=>v(!1),className:"btn-light py-1 px-3 text-xs",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(N.trim())try{await m.post(`/readit/posts/${r}/comments`,{content:N,parent:f}),k(""),v(!1),S(!1),P()}catch(e){i(e,"Failed to reply")}},className:"btn-dark py-1 px-3 text-xs",children:"Reply"})]})]}),(j>0||w.length>0)&&t.jsx("div",{className:"mt-2",children:!_&&j>0?t.jsxs("button",{onClick:P,className:"text-xs font-bold text-blue-500 hover:underline flex items-center gap-1",children:[$?t.jsx("i",{className:"fi fi-rr-spinner animate-spin"}):t.jsx("i",{className:"fi fi-rr-plus-small"}),j," more replies"]}):t.jsx("div",{className:"flex flex-col gap-2",children:w.map(e=>t.jsx(h,{comment:e,postId:r},e._id))})})]})]})},g=({postId:s,onCommentPosted:r})=>{const[n,l]=e.useState(""),[o,c]=e.useState(!1);return t.jsxs("div",{className:"mb-6",children:[t.jsx("textarea",{value:n,onChange:e=>l(e.target.value),placeholder:"What are your thoughts?",className:"input-box h-28 resize-none p-4"}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:async()=>{if(!n.trim())return a.error("Comment can't be empty");c(!0);try{await m.post(`/readit/posts/${s}/comments`,{content:n}),l(""),r&&r()}catch(e){i(e,"Failed to post comment")}finally{c(!1)}},disabled:o,className:"btn-dark px-6 py-2",children:o?"Posting...":"Comment"})})]})},p=({post:s,onCommentPosted:a})=>{const{userAuth:r}=e.useContext(c),[n,l]=e.useState("top"),[o,d]=e.useState([]),[u,p]=e.useState(!0),[b,f]=e.useState(!1),j=e.useRef(1),y=e.useRef(!0),v=e.useCallback(async(e=!1)=>{e&&(j.current=1,y.current=!0,d([])),p(!0);try{const{data:t}=await m.get(`/readit/posts/${s._id}/comments?sort=${n}&page=${j.current}&limit=10`);d(e?t.comments||[]:e=>[...e,...t.comments||[]]),j.current+=1,y.current=t.hasMore}catch(t){i(t,"Failed to load comments")}finally{p(!1)}},[s._id,n]);e.useEffect(()=>{v(!0)},[v]);return t.jsxs("div",{id:"comments",className:"mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-black dark:text-white",children:[s.commentCount," Comments"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>l("top"),className:"text-xs px-3 py-1 rounded-full "+("top"===n?"bg-black text-white dark:bg-white dark:text-black":"bg-gray-100 dark:bg-gray-700 text-gray-500"),children:"Top"}),t.jsx("button",{onClick:()=>l("new"),className:"text-xs px-3 py-1 rounded-full "+("new"===n?"bg-black text-white dark:bg-white dark:text-black":"bg-gray-100 dark:bg-gray-700 text-gray-500"),children:"New"})]})]}),r.access_token?t.jsx(g,{postId:s._id,onCommentPosted:()=>{v(!0),a&&a()}}):t.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center mb-6",children:t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Log in to join the discussion"})}),t.jsxs("div",{className:"space-y-4",children:[u&&1===j.current?t.jsx(x,{}):o.length>0?o.map(e=>t.jsx(h,{comment:e,postId:s._id},e._id)):t.jsx("p",{className:"text-center text-gray-500 py-8",children:"No comments yet. Be the first!"}),y.current&&!u&&t.jsx("button",{onClick:async()=>{if(!b&&y.current){f(!0);try{const{data:e}=await m.get(`/readit/posts/${s._id}/comments?sort=${n}&page=${j.current}&limit=10`);d(t=>[...t,...e.comments||[]]),j.current+=1,y.current=e.hasMore}catch(e){i(e,"Failed to fetch more comments")}finally{f(!1)}}},disabled:b,className:"w-full py-2 text-sm font-medium text-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:b?"Loading...":"Load More Comments"})]})]})},b=()=>t.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-center",children:[t.jsx("i",{className:"fi fi-rr-exclamation text-4xl text-red-500 mb-4"}),t.jsx("h2",{className:"text-2xl font-bold",children:"Post not found"}),t.jsx(s,{to:"/readit",className:"text-blue-500 hover:underline mt-2",children:"Go Home"})]}),f=()=>{var a,i;const{postId:c}=r(),{post:m,isLoading:h,error:g}=o(c);if(h)return t.jsx(x,{});if(g||!m)return t.jsx(b,{});const{author:f,title:j,content:y,community:v,createdAt:N,postType:k,url:w,image:C,votes:_,commentCount:S}=m;return t.jsxs("div",{className:"max-w-4xl mx-auto p-2 md:p-6",children:[t.jsx(u,{title:`${j} | Readit`,description:(null==y?void 0:y.substring(0,150))||j,image:C||(null==v?void 0:v.icon),type:"article",schema:{"@context":"https://schema.org","@type":"DiscussionForumPosting",headline:j,text:y,image:C,datePublished:N,author:{"@type":"Person",name:null==(a=null==f?void 0:f.personal_info)?void 0:a.username},interactionStatistic:[{"@type":"InteractionCounter",interactionType:"https://schema.org/LikeAction",userInteractionCount:_},{"@type":"InteractionCounter",interactionType:"https://schema.org/CommentAction",userInteractionCount:S}]}}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-12 bg-gray-50 dark:bg-gray-800/50 border-r border-gray-100 dark:border-gray-700 pt-4",children:t.jsx(l,{item:m})}),t.jsxs("div",{className:"p-4 md:p-6 w-full min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mb-4 flex-wrap",children:[t.jsxs(s,{to:`/readit/c/${null==v?void 0:v.name}`,className:"flex items-center gap-1 font-bold text-black dark:text-white hover:underline",children:[(null==v?void 0:v.icon)&&t.jsx("img",{src:v.icon,alt:"",className:"w-5 h-5 rounded-full object-cover"}),"c/",null==v?void 0:v.name]}),t.jsx("span",{className:"text-gray-300",children:"•"}),t.jsxs("span",{children:["Posted by u/",null==(i=null==f?void 0:f.personal_info)?void 0:i.username]}),t.jsx("span",{children:d(N)})]}),t.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-4 leading-tight",children:j}),t.jsx("div",{className:"mb-6",children:(()=>{switch(k){case"text":return t.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-800 dark:text-gray-200 leading-relaxed",children:t.jsx(n,{children:y})});case"link":return t.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"block p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors group",children:t.jsxs("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium",children:[t.jsx("i",{className:"fi fi-rr-link"}),t.jsx("span",{className:"truncate",children:w}),t.jsx("i",{className:"fi fi-rr-arrow-up-right-from-square text-xs opacity-0 group-hover:opacity-100 transition-opacity"})]})});case"image":return t.jsx("div",{className:"bg-black rounded-lg overflow-hidden flex justify-center",children:t.jsx("img",{src:C,alt:j,className:"max-h-[80vh] max-w-full object-contain"})});default:return null}})()}),t.jsxs("div",{className:"flex items-center text-gray-500 text-sm font-bold gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 px-3 py-1.5 rounded-lg",children:[t.jsx("i",{className:"fi fi-rr-comment-alt"}),S," Comments"]}),t.jsxs("button",{className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-1.5 rounded-lg transition-colors",children:[t.jsx("i",{className:"fi fi-rr-share"})," Share"]}),t.jsxs("button",{className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-1.5 rounded-lg transition-colors",children:[t.jsx("i",{className:"fi fi-rr-bookmark"})," Save"]})]})]})]})}),t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"py-10 text-center",children:t.jsx(x,{})}),children:t.jsx(p,{post:m})})]})};export{f as default};
