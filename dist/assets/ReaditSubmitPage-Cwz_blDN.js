import{u as e,g as a,r as t,U as s,j as r,H as i,I as l,e as n,z as o,a as d}from"./index-vd7Ycuse.js";import{U as c}from"./aws-OCO_JW2t.js";const u=()=>{const{communityName:u}=e(),m=a(),{userAuth:x}=t.useContext(s),[p,g]=t.useState("text"),[h,j]=t.useState(""),[b,f]=t.useState(""),[v,y]=t.useState(""),[N,k]=t.useState(""),[w,C]=t.useState(!1);return r.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[r.jsx(i,{children:r.jsxs("title",{children:["Submit to c/",u]})}),r.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create a Post"}),r.jsxs("p",{className:"text-dark-grey mb-4",children:["Posting to ",r.jsxs("span",{className:"font-semibold",children:["c/",u]})]}),r.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark",children:[r.jsx(l,{routes:["Text","Image","Link"],defaultIndex:0,onChange:(e,a)=>{g(e.innerText.toLowerCase())}}),r.jsxs("div",{className:"p-4",children:[r.jsx("input",{type:"text",placeholder:"Title",value:h,onChange:e=>j(e.target.value),className:"input-box mb-4 text-2xl font-semibold"}),"text"===p&&r.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:b,onChange:e=>f(e.target.value),className:"input-box h-40"}),"image"===p&&r.jsxs("div",{className:"border border-dashed border-grey p-4 rounded-md text-center",children:[r.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:async e=>{const a=e.target.files[0];if(!a)return;let t=o.loading("Uploading image...");try{const e=await c(a);k(e),o.success("Image uploaded!")}catch(s){o.error("Image upload failed.")}finally{o.dismiss(t)}},className:"hidden"}),r.jsx("label",{htmlFor:"upload-image-input",className:"cursor-pointer text-blue hover:underline",children:N?"Change Image":"Upload Image"}),N&&r.jsx("img",{src:N,alt:"Post preview",className:"w-full rounded-md mt-4"})]}),"link"===p&&r.jsx("input",{type:"url",placeholder:"https://your-link.com",value:v,onChange:e=>y(e.target.value),className:"input-box"}),r.jsx("div",{className:"flex justify-end mt-4",children:r.jsx("button",{onClick:async()=>{var e,a;if(!h.trim())return o.error("A title is required.");if("link"===p&&!v)return o.error("A URL is required.");if("image"===p&&!N)return o.error("An image is required.");const t={title:h,postType:p,content:"text"===p?b:void 0,url:"link"===p?v:void 0,image:"image"===p?N:void 0};C(!0);try{const{data:e}=await d.post(`/readit/c/${u}/posts`,t);o.success("Post created!"),m(`/readit/post/${e._id}`)}catch(s){o.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||"Failed to create post.")}finally{C(!1)}},disabled:w,className:"btn-dark px-8 flex items-center gap-2",children:w?r.jsxs(r.Fragment,{children:[r.jsx(n,{}),r.jsx("span",{children:"Posting..."})]}):"Post"})})]})]})]})};export{u as default};
