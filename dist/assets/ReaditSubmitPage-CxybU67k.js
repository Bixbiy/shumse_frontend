import{r as e,u as t,g as s,j as a,H as r,I as o,U as i,C as n,z as d}from"./index-BK9O-y3K.js";import{U as l}from"./aws-B787dLGz.js";var u=e.createContext(void 0);const c=()=>{const t=(()=>{const t=e.useContext(u);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t})(),{userAuth:s}=e.useContext(i);return useMutation({mutationFn:({communityName:e,postData:t})=>n.post(`https://spread-server-528420849904.europe-west1.run.app/api/v1/readit/c/${e}/posts`,t,{headers:{Authorization:`Bearer ${s.access_token}`}}),onSuccess:(e,s)=>{t.invalidateQueries({queryKey:["communityPosts",s.communityName]}),d.success("Post created!")},onError:e=>{var t,s;d.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||"Failed to create post.")}})},m=()=>{const{communityName:i}=t(),n=s(),{userAuth:u}=e.useContext(userContext),m=e.useRef();e.useRef(0);const[p,x]=e.useState("text"),[g,h]=e.useState(""),[v,y]=e.useState(""),[b,f]=e.useState(""),[j,N]=e.useState(""),{mutate:C,isLoading:k}=c();return a.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[a.jsx(r,{children:a.jsxs("title",{children:["Submit to c/",i]})}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create a Post"}),a.jsxs("p",{className:"text-dark-grey mb-4",children:["Posting to ",a.jsxs("span",{className:"font-semibold",children:["c/",i]})]}),a.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark",children:[a.jsx(o,{ref:m,routes:["Text","Image","Link"],defaultIndex:0,onChange:(e,t)=>{x(e.innerText.toLowerCase())}}),a.jsxs("div",{className:"p-4",children:[a.jsx("input",{type:"text",placeholder:"Title",value:g,onChange:e=>h(e.target.value),className:"input-box mb-4 text-2xl font-semibold"}),"text"===p&&a.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:v,onChange:e=>y(e.target.value),className:"input-box h-40"}),"image"===p&&a.jsxs("div",{className:"border border-dashed border-grey p-4 rounded-md text-center",children:[a.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;let s=d.loading("Uploading image...");try{const e=await l(t);N(e),d.success("Image uploaded!")}catch(a){d.error("Image upload failed.")}finally{d.dismiss(s)}},className:"hidden"}),a.jsx("label",{htmlFor:"upload-image-input",className:"cursor-pointer text-blue hover:underline",children:j?"Change Image":"Upload Image"}),j&&a.jsx("img",{src:j,alt:"Post preview",className:"w-full rounded-md mt-4"})]}),"link"===p&&a.jsx("input",{type:"url",placeholder:"https://your-link.com",value:b,onChange:e=>f(e.target.value),className:"input-box"}),a.jsx("div",{className:"flex justify-end mt-4",children:a.jsx("button",{onClick:()=>{if(!g.trim())return d.error("A title is required.");if("link"===p&&!b)return d.error("A URL is required.");if("image"===p&&!j)return d.error("An image is required.");C({communityName:i,postData:{title:g,postType:p,content:"text"===p?v:void 0,url:"link"===p?b:void 0,image:"image"===p?j:void 0}},{onSuccess:e=>{n(`/readit/post/${e.data._id}`)}})},disabled:k,className:"btn-dark px-8",children:k?"Posting...":"Post"})})]})]})]})};export{m as default};
