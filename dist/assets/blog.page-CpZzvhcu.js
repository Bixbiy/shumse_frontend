import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{a as t,g as s,r as a,L as r,c as l,h as o,u as n}from"./vendor-react-B32pNUrn.js";import{r as i,U as c,a as d,p as m,P as u,u as x,f as h,A as p,L as f,N as g,b as y,E as v,S as b}from"./index-D1ni5E-J.js";import{O as j,c as w,V as N,A as k,m as _}from"./vendor-ui-BqXYh4xT.js";import{u as C}from"./index-In3Rit_0.js";import"./vendor-socket-CUkmNz_4.js";var L,E={},S={};var M,T={};var P,R={};var $,A,B={};const z=s(function(){if(A)return E;A=1,Object.defineProperty(E,"__esModule",{value:!0}),E.forceVisible=E.forceCheck=E.lazyload=void 0;var e=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),s=t(),a=d(s),r=d(i()),l=(L||(L=1,Object.defineProperty(S,"__esModule",{value:!0}),S.on=function(e,t,s,a){a=a||!1,e.addEventListener?e.addEventListener(t,s,a):e.attachEvent&&e.attachEvent("on"+t,function(t){s.call(e,t||window.event)})},S.off=function(e,t,s,a){a=a||!1,e.removeEventListener?e.removeEventListener(t,s,a):e.detachEvent&&e.detachEvent("on"+t,s)}),S),o=d((M||(M=1,Object.defineProperty(T,"__esModule",{value:!0}),T.default=function(e){if(!(e instanceof HTMLElement))return document.documentElement;for(var t="absolute"===e.style.position,s=/(scroll|auto)/,a=e;a;){if(!a.parentNode)return e.ownerDocument||document.documentElement;var r=window.getComputedStyle(a),l=r.position,o=r.overflow,n=r["overflow-x"],i=r["overflow-y"];if("static"===l&&t)a=a.parentNode;else{if(s.test(o)&&s.test(n)&&s.test(i))return a;a=a.parentNode}}return e.ownerDocument||e.documentElement||document.documentElement}),T)),n=d((P||(P=1,Object.defineProperty(R,"__esModule",{value:!0}),R.default=function(e,t,s){var a=void 0,r=void 0,l=void 0,o=void 0,n=void 0,i=function i(){var c=+new Date-o;c<t&&c>=0?a=setTimeout(i,t-c):(a=null,s||(n=e.apply(l,r),a||(l=null,r=null)))};return function(){l=this,r=arguments,o=+new Date;var c=s&&!a;return a||(a=setTimeout(i,t)),c&&(n=e.apply(l,r),l=null,r=null),n}}),R)),c=d(($||($=1,Object.defineProperty(B,"__esModule",{value:!0}),B.default=function(e,t,s){var a,r;return t||(t=250),function(){var l=s||this,o=+new Date,n=arguments;a&&o<a+t?(clearTimeout(r),r=setTimeout(function(){a=o,e.apply(l,n)},t)):(a=o,e.apply(l,n))}}),B));function d(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=0,p=0,f=0,g=0,y="data-lazyload-listened",v=[],b=[],j=!1;try{var w=Object.defineProperty({},"passive",{get:function(){j=!0}});window.addEventListener("test",null,w)}catch(I){}var N=!!j&&{capture:!1,passive:!0},k=function(e){var t=e.ref;if(t instanceof HTMLElement){var s=(0,o.default)(t),a=e.props.overflow&&s!==t.ownerDocument&&s!==document&&s!==document.documentElement?function(e,t){var s=e.ref,a=void 0,r=void 0,l=void 0,o=void 0;try{var n=t.getBoundingClientRect();a=n.top,r=n.left,l=n.height,o=n.width}catch(I){a=h,r=p,l=g,o=f}var i=window.innerHeight||document.documentElement.clientHeight,c=window.innerWidth||document.documentElement.clientWidth,d=Math.max(a,0),m=Math.max(r,0),u=Math.min(i,a+l)-d,x=Math.min(c,r+o)-m,y=void 0,v=void 0,b=void 0,j=void 0;try{var w=s.getBoundingClientRect();y=w.top,v=w.left,b=w.height,j=w.width}catch(I){y=h,v=p,b=g,j=f}var N=y-d,k=v-m,_=Array.isArray(e.props.offset)?e.props.offset:[e.props.offset,e.props.offset];return N-_[0]<=u&&N+b+_[1]>=0&&k-_[0]<=x&&k+j+_[1]>=0}(e,s):function(e){var t=e.ref;if(!(t.offsetWidth||t.offsetHeight||t.getClientRects().length))return!1;var s=void 0,a=void 0;try{var r=t.getBoundingClientRect();s=r.top,a=r.height}catch(I){s=h,a=g}var l=window.innerHeight||document.documentElement.clientHeight,o=Array.isArray(e.props.offset)?e.props.offset:[e.props.offset,e.props.offset];return s-o[0]<=l&&s+a+o[1]>=0}(e);a?e.visible||(e.props.once&&b.push(e),e.visible=!0,e.forceUpdate()):e.props.once&&e.visible||(e.visible=!1,e.props.unmountIfInvisible&&e.forceUpdate())}},_=function(){b.forEach(function(e){var t=v.indexOf(e);-1!==t&&v.splice(t,1)}),b=[]},C=function(){for(var e=0;e<v.length;++e){var t=v[e];k(t)}_()},z=void 0,D=null,O=function(t){function s(e){m(this,s);var t=u(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return t.visible=!1,t.setRef=t.setRef.bind(t),t}return x(s,t),e(s,[{key:"componentDidMount",value:function(){var e=window,t=this.props.scrollContainer;t&&"string"==typeof t&&(e=e.document.querySelector(t));var s=void 0!==this.props.debounce&&"throttle"===z||"debounce"===z&&void 0===this.props.debounce;if(s&&((0,l.off)(e,"scroll",D,N),(0,l.off)(window,"resize",D,N),D=null),D||(void 0!==this.props.debounce?(D=(0,n.default)(C,"number"==typeof this.props.debounce?this.props.debounce:300),z="debounce"):void 0!==this.props.throttle?(D=(0,c.default)(C,"number"==typeof this.props.throttle?this.props.throttle:300),z="throttle"):D=C),this.props.overflow){var a=(0,o.default)(this.ref);if(a&&"function"==typeof a.getAttribute){var r=+a.getAttribute(y)+1;1===r&&a.addEventListener("scroll",D,N),a.setAttribute(y,r)}}else if(0===v.length||s){var i=this.props,d=i.scroll,m=i.resize;d&&(0,l.on)(e,"scroll",D,N),m&&(0,l.on)(window,"resize",D,N)}v.push(this),k(this)}},{key:"shouldComponentUpdate",value:function(){return this.visible}},{key:"componentWillUnmount",value:function(){if(this.props.overflow){var e=(0,o.default)(this.ref);if(e&&"function"==typeof e.getAttribute){var t=+e.getAttribute(y)-1;0===t?(e.removeEventListener("scroll",D,N),e.removeAttribute(y)):e.setAttribute(y,t)}}var s=v.indexOf(this);-1!==s&&v.splice(s,1),0===v.length&&"undefined"!=typeof window&&((0,l.off)(window,"resize",D,N),(0,l.off)(window,"scroll",D,N))}},{key:"setRef",value:function(e){e&&(this.ref=e)}},{key:"render",value:function(){var e=this.props,t=e.height,s=e.children,r=e.placeholder,l=e.className,o=e.classNamePrefix,n=e.style;return a.default.createElement("div",{className:o+"-wrapper "+l,ref:this.setRef,style:n},this.visible?s:r||a.default.createElement("div",{style:{height:t},className:o+"-placeholder"}))}}]),s}(s.Component);return O.propTypes={className:r.default.string,classNamePrefix:r.default.string,once:r.default.bool,height:r.default.oneOfType([r.default.number,r.default.string]),offset:r.default.oneOfType([r.default.number,r.default.arrayOf(r.default.number)]),overflow:r.default.bool,resize:r.default.bool,scroll:r.default.bool,children:r.default.node,throttle:r.default.oneOfType([r.default.number,r.default.bool]),debounce:r.default.oneOfType([r.default.number,r.default.bool]),placeholder:r.default.node,scrollContainer:r.default.oneOfType([r.default.string,r.default.object]),unmountIfInvisible:r.default.bool,style:r.default.object},O.defaultProps={className:"",classNamePrefix:"lazyload",once:!1,offset:0,overflow:!1,resize:!1,scroll:!0,unmountIfInvisible:!1},E.lazyload=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(r){return function(s){function l(){m(this,l);var e=u(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return e.displayName="LazyLoad"+function(e){return e.displayName||e.name||"Component"}(r),e}return x(l,s),e(l,[{key:"render",value:function(){return a.default.createElement(O,t,a.default.createElement(r,this.props))}}]),l}(s.Component)}},E.default=O,E.forceCheck=C,E.forceVisible=function(){for(var e=0;e<v.length;++e){var t=v[e];t.visible=!0,t.forceUpdate()}_()},E}()),D=()=>{const{userAuth:{access_token:t,username:s}}=a.useContext(c),{blog:l,setBlog:o,setCommentsWrapper:n}=a.useContext(he),[i,m]=a.useState(!1),[u,x]=a.useState(!1),h=window.location.href;a.useEffect(()=>{(async()=>{if(t&&(null==l?void 0:l._id))try{const{data:e}=await d.get(`/check-like/${l._id}`);a.startTransition(()=>{o(t=>{var s;return{...t,activity:{...t.activity,isLikedByUser:e.is_liked,total_likes:e.total_likes??(null==(s=t.activity)?void 0:s.total_likes)??0}}})})}catch(e){}})()},[t,null==l?void 0:l._id,o]);if(!l||!l.title)return null;const{title:p,blog_id:f,_id:g,activity:y,authorId:v}=l,{total_comments:b=0}=y||{},{username:N}=(null==v?void 0:v.personal_info)||{};return e.jsxs(e.Fragment,{children:[e.jsx(j,{}),e.jsx("hr",{className:"border-dark-grey/50 my-3"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("button",{onClick:async()=>{var e,s;if(!t)return void w.error("Please login to like this post");x(!0);const r=l.activity;a.startTransition(()=>{o(e=>{var t,s,a,r;return{...e,activity:{...e.activity,isLikedByUser:!(null==(t=e.activity)?void 0:t.isLikedByUser),total_likes:(null==(s=e.activity)?void 0:s.isLikedByUser)?((null==(r=e.activity)?void 0:r.total_likes)||0)-1:((null==(a=e.activity)?void 0:a.total_likes)||0)+1}}})});try{const{data:e}=await d.post("/like-post",{_id:l._id});a.startTransition(()=>{o(t=>({...t,activity:{...t.activity,isLikedByUser:e.liked_by_user,total_likes:e.total_likes}}))})}catch(n){a.startTransition(()=>{o(e=>({...e,activity:r}))}),w.error((null==(s=null==(e=n.response)?void 0:e.data)?void 0:s.error)||"Failed to update like status")}finally{x(!1)}},disabled:u,"aria-label":(null==y?void 0:y.isLikedByUser)?"Unlike post":"Like post",className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${(null==y?void 0:y.isLikedByUser)?"bg-red/10 text-red hover:bg-red/20 scale-110":"bg-grey/20 text-dark-grey hover:bg-grey/30"} ${u?"opacity-75 cursor-not-allowed":""}`,children:u?e.jsx("i",{className:"fi fi-rr-loading fi-spin text-xl"}):e.jsx("i",{className:`fi ${(null==y?void 0:y.isLikedByUser)?"fi-sr-heart":"fi-rr-heart"} text-xl transition-transform`})}),e.jsx("p",{className:"text-xl text-dark-grey",children:(null==y?void 0:y.total_likes)||0}),e.jsx("button",{onClick:()=>{n(e=>!e)},className:"w-10 h-10 rounded-full flex items-center justify-center bg-grey/20 hover:bg-grey/30 text-dark-grey transition-colors","aria-label":"View comments",children:e.jsx("i",{className:"fi fi-rr-comment-dots text-xl"})}),e.jsx("p",{className:"text-xl text-dark-grey",children:b})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[s===N&&e.jsxs(r,{to:`/editor/${f}`,className:"bg-black text-white px-4 py-2 rounded-full hover:bg-grey/90 transition-colors flex items-center gap-2","aria-label":"Edit post",children:[e.jsx("span",{children:"Edit"}),e.jsx("i",{className:"fi fi-rr-pencil text-sm"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{onClick:()=>m(!i),className:"w-10 h-10 rounded-full flex items-center justify-center bg-grey/20 hover:bg-grey/30 text-dark-grey transition-colors","aria-label":"Share options",children:e.jsx("i",{className:"fi fi-sr-share text-lg"})}),i&&e.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-44 bg-white dark:bg-gray-800 border border-grey/20 dark:border-gray-700 shadow-lg rounded-xl z-10 animate-fade-in",children:e.jsxs("ul",{className:"p-2 flex justify-around",children:[[{icon:"facebook",color:"#1877F2",url:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(h)}`},{icon:"twitter",color:"#1DA1F2",url:`https://x.com/intent/tweet?text=${encodeURIComponent(`Read "${p}" - ${h}`)}`},{icon:"whatsapp",color:"#25D366",url:`https://api.whatsapp.com/send?text=${encodeURIComponent(`Read "${p}" - ${h}`)}`}].map((t,s)=>e.jsx("li",{children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"block p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",style:{color:t.color},children:e.jsx("i",{className:`fi fi-brands-${t.icon} text-xl`})})},s)),e.jsx("li",{children:e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(h),w.success("Link copied to clipboard!")},className:"block p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300",title:"Copy Link",children:e.jsx("i",{className:"fi fi-rr-copy-alt text-xl"})})})]})})]})]})]})]})},O=({url:t,caption:s})=>e.jsxs("div",{className:"my-8 flex flex-col items-center",children:[e.jsx("img",{src:t,alt:"Post_Image",className:"w-full max-w-4xl max-h-[500px] object-contain rounded-2xl shadow-2xl"}),s&&s.length>0&&e.jsx("p",{className:"mt-4 text-center text-2xl text-gray-600 italic",children:s})]}),I=({code:t})=>{const[s,r]=a.useState(!1);return e.jsxs("div",{className:"relative my-8",children:[e.jsx("pre",{className:"bg-black text-white p-4 rounded-2xl overflow-x-auto font-mono text-base shadow-lg",children:e.jsx("code",{children:t})}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t).then(()=>{r(!0),setTimeout(()=>r(!1),2e3)}).catch(e=>{})},className:"absolute top-3 right-3 bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 py-1 px-3 rounded shadow",children:s?"Copied!":"Copy"})]})},H=({data:t})=>{const[s,r]=a.useState(!1);return e.jsxs("div",{className:"relative my-8 max-w-xl mx-auto border rounded-2xl p-8 bg-gradient-to-br from-blue-50 to-blue-100 shadow-2xl",children:[t.meta&&t.meta.image&&t.meta.image.url&&e.jsx("img",{src:t.meta.image.url,alt:t.meta.title||"Link preview",className:"w-full h-64 object-contain rounded-lg mb-6"}),e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"block text-blue-700 hover:text-blue-800 text-2xl  mb-4",children:t.meta&&t.meta.title?t.meta.title:t.link}),t.meta&&t.meta.description&&e.jsx("p",{className:"mt-4 text-blue-800 text-xl",dangerouslySetInnerHTML:{__html:t.meta.description}}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.link).then(()=>{r(!0),setTimeout(()=>r(!1),2e3)}).catch(e=>{})},className:"absolute top-3 right-3 bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 py-1 px-3 rounded shadow",children:s?"Copied!":"Copy Link"})]})},U=({data:t})=>e.jsx("div",{className:"my-8",children:e.jsx("div",{className:"aspect-video w-full",children:e.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${F(t.url)}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"rounded-xl shadow-lg"})})}),F=e=>{const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&11===t[2].length?t[2]:null},W=({block:t})=>{const{type:s,data:a}=t;switch(s){case"paragraph":return e.jsx("p",{className:"my-6 text-xl leading-relaxed text-gray-800",dangerouslySetInnerHTML:{__html:a.text}});case"header":return 1===a.level?e.jsx("h1",{className:"my-8 text-5xl font-extrabold text-gray-900",dangerouslySetInnerHTML:{__html:a.text}}):2===a.level?e.jsx("h2",{className:"my-7 text-4xl font-bold text-gray-900",dangerouslySetInnerHTML:{__html:a.text}}):3===a.level?e.jsx("h3",{className:"my-6 text-3xl font-semibold text-gray-900",dangerouslySetInnerHTML:{__html:a.text}}):null;case"image":return e.jsx(O,{url:a.file.url,caption:a.caption||""});case"code":return e.jsx(I,{code:a.code});case"table":return e.jsx("div",{className:"my-8 overflow-x-auto",children:e.jsx("table",{className:"min-w-full border-collapse border border-gray-300 shadow-lg",children:e.jsx("tbody",{className:"bg-white",children:a.content.map((t,s)=>e.jsx("tr",{className:"divide-x divide-gray-200",children:t.map((t,s)=>e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-gray-700 text-lg",dangerouslySetInnerHTML:{__html:t}},s))},s))})})});case"quote":return e.jsxs("blockquote",{className:"my-8 border-l-4 border-gray-400 pl-8 italic text-gray-600 text-2xl",children:[e.jsx("p",{dangerouslySetInnerHTML:{__html:a.text}}),a.author&&e.jsxs("footer",{className:"mt-2 text-right text-xl font-medium text-gray-600",children:["â€” ",a.author]})]});case"list":return"ordered"===a.style?e.jsx("ol",{className:"my-8 list-decimal list-inside text-gray-800 text-xl",children:a.items.map((t,s)=>e.jsx("li",{className:"my-3",dangerouslySetInnerHTML:{__html:t}},s))}):e.jsx("ul",{className:"my-8 list-disc list-inside text-gray-800 text-xl",children:a.items.map((t,s)=>e.jsx("li",{className:"my-3",dangerouslySetInnerHTML:{__html:t}},s))});case"delimiter":return e.jsx("hr",{className:"my-8 border-t-2 border-gray-200"});case"checklist":return e.jsx("ul",{className:"my-8",children:a.items.map((t,s)=>e.jsxs("li",{className:"flex items-center space-x-4 my-3",children:[e.jsx("input",{type:"checkbox",checked:t.checked,readOnly:!0,className:"form-checkbox h-6 w-6 text-blue-600"}),e.jsx("span",{className:"text-gray-800 text-xl",dangerouslySetInnerHTML:{__html:t.text}})]},s))});case"warning":return e.jsxs("div",{className:"my-8 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-6 rounded-xl shadow-lg",role:"alert",children:[a.title&&e.jsx("p",{className:"font-bold text-2xl",children:a.title}),a.message&&e.jsx("p",{className:"mt-3 text-xl",dangerouslySetInnerHTML:{__html:a.message}})]});case"linkTool":return e.jsx(H,{data:a});case"youtubeEmbed":return e.jsx(U,{data:a});default:return e.jsxs("div",{className:"my-8 text-red-500",children:["Unsupported block type: ",s]})}},q=250,V=()=>e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})}),K=()=>e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),G=()=>e.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),J=l.memo(({action:t,replyingTo:s=null,onPost:r,initialText:l="",autoFocus:o=!1,onCancel:n})=>{const[i,u]=a.useState(l),[x,h]=a.useState(!1),[p,f]=a.useState(l.length||0),[g,y]=a.useState(!1),{blog:v}=a.useContext(he)||{},{userAuth:b}=a.useContext(c),{username:j,profile_img:w,fullname:k}=b||{},_=a.useRef(null);a.useEffect(()=>{u(l),f(l.length||0)},[l]),a.useEffect(()=>{o&&_.current&&_.current.focus()},[o]);const C=a.useCallback(e=>{const t=e.target.value;t.length<=q&&(u(t),f(t.length))},[]),L=a.useCallback(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},[i]),E=a.useCallback(async()=>{var e,s;if(!j)return void N.error(`Please login to ${t.toLowerCase()}`);const a=m.sanitize(i.trim());if(!a)return void N.error(`Please write something to ${t.toLowerCase()}`);h(!0);const l=N.loading(("Save"===t?"Saving":"Posting")+"...");try{if("Save"===t||"Reply"===t)await r(a),u(""),"Save"===t&&n&&n();else if("Comment"===t){if(!(null==v?void 0:v._id))throw new Error("Blog data is not available.");await d.post("/add-comment",{blog_id:v._id,blog_author:v.authorId._id,comment:a}),u(""),f(0)}N.success(`${t}ed successfully!`,{id:l})}catch(o){const a=(null==(s=null==(e=o.response)?void 0:e.data)?void 0:s.error)||"ECONNABORTED"===o.code?"Request timeout.":`Failed to ${t.toLowerCase()}`;N.error(a,{id:l})}finally{h(!1)}},[t,v,i,r,n,j]),S=s?"Write your reply...":"Save"===t?"Edit your comment...":`Share your thoughts${j?`, ${j.split(" ")[0]}`:""}...`;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:w||"/default-avatar.png",alt:"",className:"w-10 h-10 rounded-lg object-cover border border-gray-200 dark:border-gray-600",loading:"lazy",decoding:"async",onError:e=>{e.target.src="/default-avatar.png",e.target.onerror=null}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"relative rounded-lg transition-colors duration-200 "+(g?"bg-white dark:bg-gray-800 ring-2 ring-blue-500/20 shadow-sm":"bg-gray-50 dark:bg-gray-800/50"),children:[e.jsx("textarea",{ref:_,value:i,onChange:C,onKeyDown:L,onFocus:()=>y(!0),onBlur:()=>y(!1),placeholder:S,disabled:x,autoFocus:o,className:"w-full p-3 pr-20 bg-transparent border-0 rounded-lg resize-none placeholder-gray-500 dark:placeholder-gray-400 text-gray-800 dark:text-gray-200 focus:outline-none text-sm leading-relaxed transition-colors",rows:"3",maxLength:q,"aria-label":s?"Reply comment field":"Comment field"}),p>175&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsxs("div",{className:"text-xs font-medium px-2 py-1 rounded "+(p>225?"text-red-500 bg-red-500/10":"text-gray-500 bg-gray-500/10"),children:[p,"/",q]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{children:n&&e.jsx("button",{onClick:n,className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",disabled:x,children:"Cancel"})}),e.jsx("button",{onClick:E,disabled:x||!i.trim(),className:"px-4 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 "+(x||!i.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white shadow-sm hover:shadow"),children:x?e.jsxs(e.Fragment,{children:[e.jsx(G,{}),"Save"===t?"Saving...":"Posting..."]}):e.jsxs(e.Fragment,{children:["Save"===t?e.jsx(K,{}):e.jsx(V,{}),t]})})]})]})]})})});J.propTypes={action:u.string.isRequired,replyingTo:u.string,onPost:u.func,initialText:u.string,autoFocus:u.bool,onCancel:u.func},J.displayName="CommentField";const Q=({filled:t=!1,className:s="w-4 h-4"})=>e.jsx("svg",{className:s,fill:t?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),X=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),Y=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})}),Z=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),ee=({className:t="w-4 h-4"})=>e.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),te=({className:t="w-3 h-3"})=>e.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})}),se=({className:t="w-3 h-3"})=>e.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})}),ae=({className:t="w-4 h-4"})=>e.jsxs("svg",{className:`animate-spin ${t}`,fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),re=l.memo(({commentData:t,depth:s=0})=>{const[r,l]=a.useState(t),[o,n]=a.useState(t.isLiked),[i,m]=a.useState(t.upvotesCount),[u,p]=a.useState(!1),[f,g]=a.useState(!1),[y,v]=a.useState(!1),[b,j]=a.useState([]),[w,k]=a.useState(!1),[_,C]=a.useState(!1),[L,E]=a.useState(0),[S,M]=a.useState(!1),T=a.useRef(null);var P,R;P=T,R=()=>M(!1),a.useEffect(()=>{const e=e=>{P.current&&!P.current.contains(e.target)&&R()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[P,R]);const{_id:$,blog_id:A,blog_author:B,comment:z,commentedAt:D,commented_by:O,isDeleted:I,repliesCount:H,edited:U}=r,{personal_info:{fullname:F,profile_img:W,username:q}={}}=O||{},{userAuth:V}=a.useContext(c),{access_token:K,_id:G}=V||{},{socket:le}=x(),oe=a.useMemo(()=>G===(null==O?void 0:O._id),[G,null==O?void 0:O._id]),ne=a.useMemo(()=>G===B,[G,B]),ie=a.useMemo(()=>oe||ne,[oe,ne]);a.useEffect(()=>{if(!le||!$)return;const e={commentLiked:e=>{e._id===$&&(m(e.upvotesCount),e.userId===G&&n(e.isLiked))},commentUpdated:e=>{e._id===$&&l(t=>({...t,comment:e.comment,edited:e.edited,editedAt:e.editedAt}))},newReply:e=>{e.parent===$&&y&&j(t=>[e,...t]),e.parent===$&&l(e=>({...e,repliesCount:(e.repliesCount||0)+1}))},commentDeleted:e=>{e._id===$&&l(e=>({...e,isDeleted:!0,comment:"[deleted]",commented_by:null}))}};return Object.entries(e).forEach(([e,t])=>{le.on(e,t)}),()=>{Object.entries(e).forEach(([e,t])=>{le.off(e,t)})}},[le,$,G,y]);const ce=a.useCallback(()=>{K?p(e=>!e):N.error("Please login to reply")},[K]),de=a.useCallback(async e=>{var t,s;if(!K)return void N.error("Please login to reply");const a={_id:`temp-${Date.now()}`,blog_id:A,blog_author:B,comment:e,commented_by:{personal_info:{...V}},commentedAt:(new Date).toISOString(),isReply:!0,parent:$,upvotes:[],upvotesCount:0,isLiked:!1};j(e=>[a,...e]),p(!1);try{const{data:t}=await d.post("/reply-comment",{blog_id:A,blog_author:B,comment:e,parent_comment_id:$});j(e=>e.map(e=>e._id===a._id?t:e)),N.success("Reply posted!")}catch(r){j(e=>e.filter(e=>!e._id.startsWith("temp-"))),N.error((null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.error)||"Failed to post reply")}},[$,K,A,B,V]),me=a.useCallback(async()=>{if(!w){k(!0);try{const{data:e}=await d.get(`/get-comment-replies/${$}`,{params:{skip:5*L,limit:5,user_id:G}});e.length<5&&C(!0),j(t=>[...t,...e]),E(e=>e+1)}catch(e){N.error("Failed to load replies.")}finally{k(!1)}}},[$,L,G,w,5]),ue=a.useCallback(()=>{!y&&0===b.length&&H>0&&me(),v(e=>!e)},[y,b.length,H,me]),xe=a.useCallback(async()=>{if(!K)return void N.error("Please login to like");const e=!o;n(e),m(t=>e?t+1:t-1);try{await d.post("/like-comment",{comment_id:$})}catch(t){n(!e),m(t=>e?t-1:t+1),N.error("Like failed. Please try again.")}},[$,K,o]),he=a.useCallback(async e=>{var t,s;if(K)try{await d.patch(`/edit-comment/${$}`,{comment:e}),g(!1),N.success("Comment updated!")}catch(a){throw N.error((null==(s=null==(t=a.response)?void 0:t.data)?void 0:s.error)||"Failed to edit"),a}else N.error("Please login to edit")},[$,K]),pe=a.useCallback(async()=>{var e,t;if(!K)return void N.error("Please login to delete");if(M(!1),!window.confirm("Are you sure you want to delete this comment?"))return;const s=N.loading("Deleting...");try{await d.delete(`/delete-comment/${$}`),N.success("Comment deleted",{id:s})}catch(a){N.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.error)||"Failed to delete",{id:s})}},[$,K]);return s>5?null:I?e.jsx("div",{className:"mb-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 dark:text-gray-500 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"This comment has been deleted"]})}):e.jsx("div",{className:"mb-3 "+(s>0?"ml-3 pl-3 border-l border-gray-200 dark:border-gray-600":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:W||"/default-avatar.png",alt:"",className:"w-8 h-8 rounded-lg object-cover border border-gray-200 dark:border-gray-600",loading:"lazy",decoding:"async",onError:e=>{e.target.src="/default-avatar.png",e.target.onerror=null}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[f?e.jsx(J,{action:"Save",initialText:z,onPost:he,onCancel:()=>g(!1),autoFocus:!0}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-gray-100 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:F||"Anonymous"}),q&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 text-xs truncate",children:["@",q]}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:h(D)||"Just now"}),U&&e.jsxs("span",{className:"text-blue-500 dark:text-blue-400 text-xs flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"edited"]})]})}),ie&&e.jsxs("div",{className:"relative",ref:T,children:[e.jsx("button",{onClick:()=>M(e=>!e),className:"p-1 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Comment actions",children:e.jsx(Y,{})}),S&&e.jsxs("div",{className:"absolute top-full right-0 z-10 w-36 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-1",children:[oe&&e.jsxs("button",{onClick:()=>{g(!0),M(!1)},className:"w-full text-left flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(Z,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:pe,className:"w-full text-left flex items-center gap-2 px-3 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20",children:[e.jsx(ee,{className:"w-4 h-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"text-gray-800 dark:text-gray-200 text-sm mb-3 leading-relaxed",children:z}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:xe,disabled:!K,className:`flex items-center gap-1 text-sm transition-colors ${o?"text-red-500":"text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400"} ${K?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(Q,{filled:o}),e.jsx("span",{children:i||0})]}),e.jsxs("button",{onClick:ce,disabled:!K,className:"flex items-center gap-1 text-sm transition-colors "+(K?"text-gray-500 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400":"opacity-50 cursor-not-allowed text-gray-400"),children:[e.jsx(X,{}),e.jsx("span",{children:"Reply"})]})]})]}),u&&e.jsx("div",{className:"mt-3",children:e.jsx(J,{action:"Reply",replyingTo:$,onPost:de,autoFocus:!0,onCancel:()=>p(!1)})}),H>0&&e.jsx("div",{className:"mt-3",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 text-blue-500 dark:text-blue-400 hover:text-blue-600 dark:hover:text-blue-300 text-sm font-medium mb-2",children:[e.jsx(se,{}),"Hide replies"]}),e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsx(re,{commentData:t,depth:s+1},t._id))}),!_&&H>b.length&&e.jsx("button",{onClick:me,disabled:w,className:"flex items-center gap-2 mt-2 text-sm "+(w?"text-gray-400":"text-blue-500 dark:text-blue-400 hover:text-blue-600 dark:hover:text-blue-300"),children:w?e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),"Loading..."]}):`Load ${H-b.length} more`})]}):e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 text-blue-500 dark:text-blue-400 hover:text-blue-600 dark:hover:text-blue-300 text-sm font-medium",children:[e.jsx(te,{}),`View ${H} ${H>1?"replies":"reply"}`]})})]})]})})});re.propTypes={commentData:u.object.isRequired,depth:u.number},re.displayName="CommentCard";const le=(e,t,s)=>{const[r,l]=a.useState({comments:[],loading:!1,error:null,page:0,hasMore:!0,totalCount:0}),o=a.useCallback(async(a=0,r=!1)=>{if(e){l(e=>({...e,loading:!0,error:null}));try{const o=await(async(e,t=0,s=5,a=null)=>{var r,l;try{if(!e||"string"!=typeof e)throw new Error("Invalid blogId provided");const l={blog_id:e,skip:t*s,limit:s,user_id:a,timestamp:Date.now()},o=await d.post("/get-post-comments",l,{timeout:1e4,validateStatus:e=>e<500});if(200!==o.status)throw new Error((null==(r=o.data)?void 0:r.error)||`Request failed with status ${o.status}`);return{comments:Array.isArray(o.data.comments)?o.data.comments.map(e=>({...e,isLiked:e.isLiked||!1})):[],total:Number(o.data.total)||0,hasMore:!1!==o.data.hasMore,page:Number(o.data.page)||t}}catch(o){if(401===(null==(l=o.response)?void 0:l.status))throw new Error("Please login to view comments");if("ECONNABORTED"===o.code)throw new Error("Request timeout. Please try again.");throw o}})(e,a,5,s);l(e=>({comments:r?o.comments:[...e.comments,...o.comments],loading:!1,page:a+1,hasMore:o.hasMore,totalCount:o.total,error:null})),r&&t&&t(e=>({...e,total_comments:o.total,total_parent_comments:o.total}))}catch(o){l(e=>({...e,loading:!1,error:o.message||"Failed to load comments"}))}}},[e,t,s,5]),n=a.useCallback(e=>{l(e)},[]);return a.useEffect(()=>{e&&o(0,!0)},[e,o]),{...r,fetchComments:o,setCommentsState:n}},oe=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),ne=()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),ie=()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),ce=l.memo(()=>{const{blog:t,commentsWrapper:s,setCommentsWrapper:r,updateBlogActivity:l}=a.useContext(he),{userAuth:o}=a.useContext(c),{_id:n}=o||{},{socket:i}=x(),d=null==t?void 0:t._id,m=(null==t?void 0:t.title)||"",{comments:u,loading:h,error:y,page:v,hasMore:b,totalCount:j,fetchComments:w,setCommentsState:N}=le(d,l,n);a.useEffect(()=>{i&&d&&(i.emit("joinCommentRoom",{blog_id:d}),i.emit("joinPostRoom",{blog_id:d}))},[i,d]),a.useEffect(()=>{if(!i||!d)return;const e=e=>{e.blog_id!==d||e.isReply||(N(t=>({...t,comments:[e,...t.comments],totalCount:t.totalCount+1})),l(e=>({...e,total_comments:(e.total_comments||0)+1,total_parent_comments:(e.total_parent_comments||0)+1})))},t=e=>{e.blog_id===d&&e.parent&&(N(t=>({...t,comments:t.comments.map(t=>t._id===e.parent?{...t,repliesCount:(t.repliesCount||0)+1}:t),totalCount:t.totalCount+1})),l(e=>({...e,total_comments:(e.total_comments||0)+1})))},s=e=>{e.blog_id===d&&(N(t=>{const s=t.comments.some(t=>t._id===e._id);return{...t,comments:t.comments.map(t=>t._id===e._id?{...t,isDeleted:!0,comment:"[deleted]",commented_by:null}:t._id===e.parent?{...t,repliesCount:Math.max(0,(t.repliesCount||1)-1)}:t),totalCount:Math.max(0,t.totalCount-1),total_parent_comments:s?Math.max(0,t.totalCount-1):t.totalCount}}),l(e=>({...e,total_comments:Math.max(0,(e.total_comments||1)-1),total_parent_comments:Math.max(0,(e.total_parent_comments||1)-1)})))};return i.on("newComment",e),i.on("newReply",t),i.on("commentDeleted",s),()=>{i.off("newComment",e),i.off("newReply",t),i.off("commentDeleted",s)}},[i,d,N,l]);const{ref:L,inView:E}=C({threshold:0,triggerOnce:!1}),S=a.useCallback(()=>{!h&&b&&w(v)},[w,h,b,v]);a.useEffect(()=>{E&&S()},[E,S]);const M=a.useMemo(()=>e.jsx("div",{className:"sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg text-white",children:e.jsx(ne,{})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold text-gray-900 dark:text-white",children:["Comments (",j,")"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-[200px]",children:m})]})]}),e.jsx("button",{onClick:()=>r(!1),className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close comments",children:e.jsx(oe,{})})]})}),[j,m,r]);return e.jsx(k,{children:s&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex justify-end bg-black/50 backdrop-blur-sm",onClick:()=>r(!1),children:e.jsxs(_.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"w-full max-w-md h-full bg-white dark:bg-gray-900 shadow-2xl flex flex-col",onClick:e=>e.stopPropagation(),children:[M,e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(J,{action:"comment"}),y&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center text-red-500",children:[e.jsx(ie,{}),e.jsx("p",{className:"mt-2 text-sm",children:y}),e.jsx("button",{onClick:()=>w(0,!0),className:"mt-3 text-xs font-medium underline hover:text-red-600",children:"Try Again"})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsx(p,{children:e.jsx(re,{index:0,leftVal:0,commentData:t})},t._id))}),h&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(f,{})}),!h&&!b&&u.length>0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"End of comments"}),!h&&0===u.length&&!y&&e.jsx(g,{message:"No comments yet. Be the first to share your thoughts!"}),e.jsx("div",{ref:L,className:"h-4"})]})})]})})})}),de=({className:t})=>e.jsx("div",{className:`bg-gray-200 dark:bg-gray-700 rounded-md animate-pulse ${t}`}),me=()=>e.jsxs("div",{className:"max-w-[900px] center py-10 max-lg:px-[5vw]",children:[e.jsx(de,{className:"aspect-video w-full"}),e.jsx(de,{className:"h-12 w-3/4 mt-12"}),e.jsx(de,{className:"h-12 w-1/2 mt-4"}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center my-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(de,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(de,{className:"h-5 w-32"}),e.jsx(de,{className:"h-4 w-24"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(de,{className:"h-5 w-24"}),e.jsx(de,{className:"h-5 w-20"})]})]}),e.jsx("hr",{className:"border-dark-grey/50 my-3"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(de,{className:"w-10 h-10 rounded-full"}),e.jsx(de,{className:"h-6 w-8"}),e.jsx(de,{className:"w-10 h-10 rounded-full"}),e.jsx(de,{className:"h-6 w-8"})]}),e.jsx("div",{className:"flex gap-4 items-center",children:e.jsx(de,{className:"w-10 h-10 rounded-full"})})]}),e.jsx("hr",{className:"border-dark-grey/50 my-3"}),e.jsxs("div",{className:"my-12 flex flex-col gap-4",children:[e.jsx(de,{className:"h-6 w-full"}),e.jsx(de,{className:"h-6 w-full"}),e.jsx(de,{className:"h-6 w-11/12"}),e.jsx("br",{}),e.jsx(de,{className:"h-6 w-full"}),e.jsx(de,{className:"h-6 w-10/12"}),e.jsx("br",{}),e.jsx(de,{className:"h-48 w-full"})," ",e.jsx("br",{}),e.jsx(de,{className:"h-6 w-full"}),e.jsx(de,{className:"h-6 w-11/12"})]})]});class ue extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ˜ž"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"We're sorry for the inconvenience. Please try refreshing the page or return to the homepage."}),!1,e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors",children:"Refresh Page"}),e.jsx(r,{to:"/",className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-center",children:"Go to Homepage"})]})]})}):this.props.children}}const xe=({src:t,placeholder:s,alt:r,className:l="",style:o={},transitionDuration:n=.3,blurAmount:i="8px"})=>{const[c,d]=a.useState(!1),[m,u]=a.useState(s);return a.useEffect(()=>{const e=new Image;return e.src=t,e.onload=()=>{u(t),d(!0)},e.onerror=()=>{u(s||"/placeholder-image.jpg"),d(!0)},()=>{e.onload=null,e.onerror=null}},[t,s]),e.jsxs("div",{className:`relative overflow-hidden ${l}`,style:o,children:[e.jsx("img",{src:s,alt:r,className:"absolute inset-0 w-full h-full object-cover transition-opacity duration-500 "+(c?"opacity-0":"opacity-100"),style:{filter:`blur(${i})`,transform:"scale(1.1)"}}),e.jsx(_.img,{src:m,alt:r,className:"w-full h-full object-cover",initial:{opacity:0},animate:{opacity:c?1:0},transition:{duration:n},loading:"lazy"}),!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})})]})},he=a.createContext({}),pe=l.memo(()=>{var t,s,l,i;const{blog_id:c}=o(),m=n(),{socket:u}=x(),[h,f]=a.useState({title:"",des:"",content:[],banner:"",authorId:{},tags:[],activity:{},publishedAt:"",readingTime:5}),[g,w]=a.useState([]),[N,k]=a.useState(!0),[_,C]=a.useState(null),[L,E]=a.useState(!1),{title:S,des:M,content:T,banner:P,authorId:{personal_info:{fullname:R,username:$,profile_img:A}={}}={},publishedAt:B,tags:O=[],readingTime:I}=h,H=a.useCallback(async()=>{var e,t,s,a;try{k(!0),C(null);const{data:{blog:t}}=await d.post("/get-post",{blog_id:c}),[s,a]=await Promise.allSettled([y(t._id),(null==(e=t.tags)?void 0:e.length)?d.post("/similar/posts",{tag:t.tags[0],blog_id:c}):Promise.resolve({data:[]})]),r="fulfilled"===s.status?s.value.comments:[],l="fulfilled"===s.status?s.value.total:0;f({...t,comments:r,activity:{...t.activity,total_comments:l,total_parent_comments:l,isLikedByUser:t.activity.isLikedByUser||!1}}),"fulfilled"===a.status&&a.value.data&&w(a.value.data)}catch(r){const e=(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.error)||r.message||"Failed to load blog post";C(e),404===(null==(a=r.response)?void 0:a.status)&&m("/404",{replace:!0})}finally{k(!1)}},[c,m]),U=a.useCallback(e=>{f(t=>({...t,activity:{...t.activity,...e}}))},[]);return a.useEffect(()=>{H()},[H]),a.useEffect(()=>{if(!u||!c)return;u.emit("joinPostRoom",{blog_id:c});const e=e=>{e.blog_id===c&&U({total_likes:e.total_likes})},t=e=>{e.blog_id===c&&(toast.error("This post has been deleted by the author."),m("/"))};return u.on("likeUpdate",e),u.on("postDeleted",t),()=>{u.off("likeUpdate",e),u.off("postDeleted",t)}},[u,c,U,m]),N?e.jsx(me,{}):_?e.jsx("div",{className:"max-w-[900px] center py-10 max-lg:px-[5vw]",children:e.jsx(v,{message:_,onRetry:H})}):e.jsxs(ue,{children:[e.jsx(b,{title:S,description:M||`${S} - A post by ${R}`,image:P,type:"article",schema:{"@context":"https://schema.org","@type":"BlogPosting",headline:S,description:M,image:P,author:{"@type":"Person",name:R},datePublished:B,timeRequired:`PT${I}M`,wordCount:(null==(s=null==(t=T[0])?void 0:t.blocks)?void 0:s.reduce((e,t)=>{var s,a;return e+((null==(a=null==(s=t.data)?void 0:s.text)?void 0:a.split(" ").length)||0)},0))||0}}),e.jsx(p,{children:e.jsxs(he.Provider,{value:{blog:h,setBlog:f,updateBlogActivity:U,commentsWrapper:L,setCommentsWrapper:E},children:[e.jsx(j,{}),L&&e.jsx(ce,{}),e.jsxs("article",{className:"max-w-[900px] center py-10 max-lg:px-[5vw]",children:[e.jsxs("header",{className:"mb-12",children:[e.jsx(z,{height:500,once:!0,offset:100,children:e.jsx(xe,{src:P,placeholder:"/placeholder-blog.jpg",className:"aspect-video rounded-xl shadow-lg w-full object-cover",alt:S})}),e.jsx("div",{className:"mt-12",children:e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gradient bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:S})}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center my-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(z,{once:!0,offset:100,children:e.jsx("img",{className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-md",src:A,alt:R,loading:"lazy"})}),e.jsx("div",{children:e.jsxs("p",{className:"font-medium capitalize",children:[R,e.jsx("br",{}),e.jsxs(r,{className:"text-twitter hover:underline text-sm font-normal",to:`/user/${$}`,children:["@",$]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-dark-gray opacity-75 flex items-center gap-1",children:[e.jsx("i",{className:"fi fi-rr-calendar-clock text-base"}),(q=B,new Date(q).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))]}),e.jsxs("span",{className:"text-dark-gray opacity-75 flex items-center gap-1",children:[e.jsx("i",{className:"fi fi-rr-book-open-cover text-base"}),(F=I||5,`${F} min read`)]})]})]}),e.jsx(D,{})]}),e.jsx("section",{className:"my-12 font-gelasio blog-page-content prose prose-lg max-w-none dark:prose-invert prose-headings:font-bold prose-a:text-accent hover:prose-a:text-accent-dark prose-img:rounded-xl prose-img:shadow-md",children:null==(i=null==(l=T[0])?void 0:l.blocks)?void 0:i.map((t,s)=>e.jsx("div",{className:"my-4 md:my-8",children:e.jsx(W,{block:t})},s))}),e.jsxs("footer",{className:"mt-16",children:[e.jsx(D,{}),O.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:O.map((t,s)=>e.jsxs("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300",children:["#",t]},s))})]}),g.length>0&&e.jsxs("div",{className:"mt-12",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Similar Posts"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:g.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:t.des}),e.jsx(r,{to:`/blog/${t.blog_id}`,className:"text-blue-600 hover:underline text-sm",children:"Read more"})]},t._id))})]})]})]})]})})]});var F,q});export{pe as default,he as postContext};
