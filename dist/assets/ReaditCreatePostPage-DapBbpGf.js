import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{r as t,u as a}from"./vendor-react-B32pNUrn.js";import{L as s,a as r,U as l}from"./index-DPOBqJFm.js";import{A as i,m as n,H as o,V as d}from"./vendor-ui-BqXYh4xT.js";import{U as c}from"./aws-CH4kjFLt.js";import"./vendor-socket-CUkmNz_4.js";const m=({mode:a,postContext:l,onClose:o,onGenerate:d})=>{const[c,m]=t.useState(""),[x,u]=t.useState(!1),[g,p]=t.useState(""),h="post"===a?"AI Post Generator":"AI Comment Generator",y="post"===a?"Enter a topic for the post:":"AI will generate a reply to this post:",b="post"===a?"Generate Post":"Generate Comment";return e.jsx(i,{children:e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center p-4",onClick:o,role:"dialog","aria-modal":"true",children:e.jsxs(n.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:25},className:"bg-white dark:bg-dark-grey-2 rounded-lg shadow-xl w-full max-w-lg p-6 m-4",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-dark-grey dark:text-white flex items-center",children:[e.jsx("i",{className:"fi fi-rr-sparkles text-blue-500 mr-2"}),h]}),e.jsx("button",{onClick:o,className:"p-1 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-grey",children:e.jsx("i",{className:"fi fi-rr-cross text-sm"})})]}),g&&e.jsx("p",{className:"text-red-500 text-sm mb-3",children:g}),e.jsxs("form",{onSubmit:async e=>{var t,s;if(e.preventDefault(),"post"!==a||c.trim()){u(!0),p("");try{const{data:e}=await r.post("/ai/generate",{prompt:"post"===a?c:null,context:"comment"===a?l:null,mode:a});"post"===a?d(e.title,e.content):d(e.content)}catch(i){p((null==(s=null==(t=i.response)?void 0:t.data)?void 0:s.error)||"Failed to generate content. Please try again.")}finally{u(!1)}}},children:[e.jsx("label",{className:"block text-sm font-medium text-dark-grey dark:text-gray-300 mb-2",children:y}),"post"===a?e.jsx("input",{type:"text",className:"w-full bg-gray-100 dark:bg-grey border border-gray-200 dark:border-grey rounded-md p-2.5 text-sm dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",value:c,onChange:e=>m(e.target.value),placeholder:"e.g., 'The future of space travel'",required:!0}):e.jsxs("div",{className:"border border-gray-200 dark:border-grey rounded-md p-3 mb-4 bg-gray-50 dark:bg-grey max-h-32 overflow-y-auto",children:[e.jsx("p",{className:"text-sm font-semibold text-dark-grey dark:text-white line-clamp-1",children:l.title}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2",children:l.content})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:x||"post"===a&&!c.trim(),className:"btn-dark text-sm flex items-center justify-center disabled:opacity-50",children:[x?e.jsx(s,{}):e.jsx("i",{className:"fi fi-rr-sparkles mr-2"}),e.jsx("span",{children:x?"Generating...":b})]})})]})]})})})},x=()=>{var x;const u=a(),{userAuth:g}=t.useContext(l),[p,h]=t.useState({communityName:"",title:"",content:"",postType:"text",url:"",image:""}),[y,b]=t.useState([]),[f,j]=t.useState(!0),[v,N]=t.useState(!1),[k,w]=t.useState(!1),[C,S]=t.useState(!1);t.useEffect(()=>{if(!(null==g?void 0:g.access_token))return;(async()=>{j(!0);try{const{data:e}=await r.get("/readit/user/communities");b(e||[])}catch(e){d.error("Could not load your communities.")}finally{j(!1)}})()},[null==g?void 0:g.access_token]);return(null==g?void 0:g.access_token)?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-8",children:[e.jsxs(o,{children:[e.jsx("title",{children:"Create Post | Readit"}),e.jsx("meta",{name:"description",content:"Create a new post - share text, images, or links with the community"})]}),e.jsx(i,{children:C&&e.jsx(m,{mode:"post",onClose:()=>S(!1),onGenerate:(e,t)=>{h(a=>({...a,title:e||a.title,content:t||a.content})),d.success("AI content generated!")}})}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:e.jsx("i",{className:"fi fi-rr-edit text-2xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold leading-tight",children:"Create a Post"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Share with the community or post personally"})]})]})}),e.jsxs("form",{onSubmit:async e=>{var t,a;if(e.preventDefault(),!p.title.trim())return d.error("Title is required");if(p.title.length>300)return d.error("Title too long");w(!0);const s=p.communityName?`/readit/c/${p.communityName}/posts`:"/readit/posts/personal",l={title:p.title,content:p.content,postType:p.postType,url:p.url,image:p.image};try{const{data:e}=await r.post(s,l);d.success("Post created successfully!"),u(`/readit/post/${e._id}`)}catch(i){d.error((null==(a=null==(t=i.response)?void 0:t.data)?void 0:a.error)||"Failed to create post.")}finally{w(!1)}},className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"communityName",className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:"Post to Community (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fi fi-rr-users absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsxs("select",{id:"communityName",name:"communityName",value:p.communityName,onChange:e=>h(t=>({...t,communityName:e.target.value})),className:"input-box pl-10 appearance-none cursor-pointer",disabled:f,children:[e.jsxs("option",{value:"",children:["Post personally (u/",null==(x=g.personal_info)?void 0:x.username,")"]}),y.map(t=>e.jsxs("option",{value:t.name,children:["c/",t.name]},t._id))]}),e.jsx("i",{className:"fi fi-rr-angle-small-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-bold text-gray-700 dark:text-gray-200",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:()=>S(!0),className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition-colors",children:[e.jsx("i",{className:"fi fi-rr-sparkles text-xs"}),"AI Assist"]})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:p.title,onChange:e=>h(t=>({...t,title:e.target.value})),placeholder:"An interesting title that grabs attention...",className:"input-box text-lg font-semibold placeholder:font-normal focus:ring-2 focus:ring-orange-500",maxLength:300,required:!0}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsxs("span",{children:["Post type: ",e.jsx("span",{className:"font-bold capitalize",children:p.postType})]}),e.jsxs("span",{children:[p.title.length,"/300"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:"Content"}),e.jsx("textarea",{name:"content",value:p.content,onChange:e=>h(t=>({...t,content:e.target.value})),placeholder:"Share your thoughts, paste a URL, or upload an image...",className:"input-box min-h-[200px] resize-y text-sm leading-relaxed transition-all duration-200"})]}),e.jsx(i,{children:p.image&&e.jsx(n.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"relative",children:e.jsxs("div",{className:"border-2 border-dashed border-green-200 dark:border-green-800 rounded-xl p-4 bg-green-50 dark:bg-green-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:[e.jsx("i",{className:"fi fi-rr-picture mr-2"}),"Image Uploaded"]}),e.jsx("button",{type:"button",onClick:()=>{h(e=>({...e,image:""}))},className:"text-red-500 hover:text-red-700 text-sm font-medium",children:"Remove"})]}),e.jsx("img",{src:p.image,alt:"Post preview",className:"max-h-64 rounded-lg mx-auto shadow-md"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 py-3 rounded-xl font-bold cursor-pointer flex-1 transition-all "+(v?"bg-gray-200 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"btn-light hover:bg-gray-100 dark:hover:bg-gray-700"),children:[v?e.jsx(s,{}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fi fi-rr-camera"}),"Upload Image"]}),e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:async e=>{const t=e.target.files[0];if(t){if(t.size>5242880)return d.error("Image size should be less than 5MB");N(!0);try{const e=await c(t),a="string"==typeof e?e:e.url;h(e=>({...e,image:a})),d.success("Image uploaded successfully!")}catch(a){d.error("Failed to upload image")}finally{N(!1)}}},disabled:v})]}),e.jsx("button",{type:"button",onClick:()=>u(-1),className:"flex-1 btn-light py-3 rounded-xl font-bold text-gray-500",disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k||v||!p.title.trim(),className:"flex-[2] bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-orange-500/25",children:k?e.jsx(s,{}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fi fi-rr-paper-plane"}),"Create Post"]})})]})]})]})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-8 flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-full p-6 mb-6",children:e.jsx("i",{className:"fi fi-rr-lock text-4xl text-yellow-600 dark:text-yellow-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Please sign in to share your thoughts."}),e.jsx("button",{onClick:()=>u("/signin"),className:"btn-dark px-8",children:"Sign In"})]})};export{x as default};
