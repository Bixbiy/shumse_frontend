import{j as e,M as t}from"./vendor-markdown-DVKDwQVh.js";import{r as s,L as a,h as r}from"./vendor-react-B32pNUrn.js";import{u as n}from"./useReaditApi-CKGJs4Kf.js";import{U as l,g as i,a as o,L as c,S as d}from"./index-D1ni5E-J.js";import{V as m,h as x}from"./VoteButtons-CcfIBH04.js";import{V as u}from"./vendor-ui-BqXYh4xT.js";import"./vendor-socket-CUkmNz_4.js";const h=({comment:t,postId:r})=>{var n,c,d;const{userAuth:u}=s.useContext(l),{author:g,content:p,createdAt:b,_id:f,children:j=0}=t,[y,v]=s.useState(!1),[N,k]=s.useState(""),[w,C]=s.useState([]),[_,S]=s.useState(!1),[$,I]=s.useState(!1),P=async()=>{if(!_){I(!0);try{const{data:e}=await o.get(`/readit/comments/${f}/replies?limit=50`);C(e.replies),S(!0)}catch(e){x(e,"Failed to load replies")}finally{I(!1)}}};return e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("img",{src:null==(n=null==g?void 0:g.personal_info)?void 0:n.profile_img,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-0.5 flex-grow bg-gray-200 dark:bg-gray-700 my-2 group-hover:bg-gray-300"})]}),e.jsxs("div",{className:"flex-1 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[e.jsx(a,{to:`/user/${null==(c=null==g?void 0:g.personal_info)?void 0:c.username}`,className:"font-bold text-black dark:text-white hover:underline",children:null==(d=null==g?void 0:g.personal_info)?void 0:d.username}),e.jsx("span",{children:"•"}),e.jsx("span",{children:i(b)})]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-200 mb-2 whitespace-pre-wrap",children:p}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{item:t,isComment:!0}),(null==u?void 0:u.access_token)&&e.jsxs("button",{onClick:()=>v(!y),className:"text-xs font-bold text-gray-500 hover:text-gray-900 dark:hover:text-white flex items-center gap-1",children:[e.jsx("i",{className:"fi fi-rr-comment"})," Reply"]})]}),y&&e.jsxs("div",{className:"mt-3 ml-2",children:[e.jsx("textarea",{className:"input-box text-sm p-2 h-20",placeholder:"What are your thoughts?",value:N,onChange:e=>k(e.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"btn-light py-1 px-3 text-xs",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(N.trim())try{await o.post(`/readit/posts/${r}/comments`,{content:N,parent:f}),k(""),v(!1),S(!1),P()}catch(e){x(e,"Failed to reply")}},className:"btn-dark py-1 px-3 text-xs",children:"Reply"})]})]}),(j>0||w.length>0)&&e.jsx("div",{className:"mt-2",children:!_&&j>0?e.jsxs("button",{onClick:P,className:"text-xs font-bold text-blue-500 hover:underline flex items-center gap-1",children:[$?e.jsx("i",{className:"fi fi-rr-spinner animate-spin"}):e.jsx("i",{className:"fi fi-rr-plus-small"}),j," more replies"]}):e.jsx("div",{className:"flex flex-col gap-2",children:w.map(t=>e.jsx(h,{comment:t,postId:r},t._id))})})]})]})},g=({postId:t,onCommentPosted:a})=>{const[r,n]=s.useState(""),[l,i]=s.useState(!1);return e.jsxs("div",{className:"mb-6",children:[e.jsx("textarea",{value:r,onChange:e=>n(e.target.value),placeholder:"What are your thoughts?",className:"input-box h-28 resize-none p-4"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{onClick:async()=>{if(!r.trim())return u.error("Comment can't be empty");i(!0);try{await o.post(`/readit/posts/${t}/comments`,{content:r}),n(""),a&&a()}catch(e){x(e,"Failed to post comment")}finally{i(!1)}},disabled:l,className:"btn-dark px-6 py-2",children:l?"Posting...":"Comment"})})]})},p=({post:t,onCommentPosted:a})=>{const{userAuth:r}=s.useContext(l),[n,i]=s.useState("top"),[d,m]=s.useState([]),[u,p]=s.useState(!0),[b,f]=s.useState(!1),j=s.useRef(1),y=s.useRef(!0),v=s.useCallback(async(e=!1)=>{e&&(j.current=1,y.current=!0,m([])),p(!0);try{const{data:s}=await o.get(`/readit/posts/${t._id}/comments?sort=${n}&page=${j.current}&limit=10`);m(e?s.comments||[]:e=>[...e,...s.comments||[]]),j.current+=1,y.current=s.hasMore}catch(s){x(s,"Failed to load comments")}finally{p(!1)}},[t._id,n]);s.useEffect(()=>{v(!0)},[v]);return e.jsxs("div",{id:"comments",className:"mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-black dark:text-white",children:[t.commentCount," Comments"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i("top"),className:"text-xs px-3 py-1 rounded-full "+("top"===n?"bg-black text-white dark:bg-white dark:text-black":"bg-gray-100 dark:bg-gray-700 text-gray-500"),children:"Top"}),e.jsx("button",{onClick:()=>i("new"),className:"text-xs px-3 py-1 rounded-full "+("new"===n?"bg-black text-white dark:bg-white dark:text-black":"bg-gray-100 dark:bg-gray-700 text-gray-500"),children:"New"})]})]}),r.access_token?e.jsx(g,{postId:t._id,onCommentPosted:()=>{v(!0),a&&a()}}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-center mb-6",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Log in to join the discussion"})}),e.jsxs("div",{className:"space-y-4",children:[u&&1===j.current?e.jsx(c,{}):d.length>0?d.map(s=>e.jsx(h,{comment:s,postId:t._id},s._id)):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No comments yet. Be the first!"}),y.current&&!u&&e.jsx("button",{onClick:async()=>{if(!b&&y.current){f(!0);try{const{data:e}=await o.get(`/readit/posts/${t._id}/comments?sort=${n}&page=${j.current}&limit=10`);m(t=>[...t,...e.comments||[]]),j.current+=1,y.current=e.hasMore}catch(e){x(e,"Failed to fetch more comments")}finally{f(!1)}}},disabled:b,className:"w-full py-2 text-sm font-medium text-blue-500 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:b?"Loading...":"Load More Comments"})]})]})},b=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-center",children:[e.jsx("i",{className:"fi fi-rr-exclamation text-4xl text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Post not found"}),e.jsx(a,{to:"/readit",className:"text-blue-500 hover:underline mt-2",children:"Go Home"})]}),f=()=>{var l,o;const{postId:x}=r(),{post:u,isLoading:h,error:g}=n(x);if(h)return e.jsx(c,{});if(g||!u)return e.jsx(b,{});const{author:f,title:j,content:y,community:v,createdAt:N,postType:k,url:w,image:C,votes:_,commentCount:S}=u;return e.jsxs("div",{className:"max-w-4xl mx-auto p-2 md:p-6",children:[e.jsx(d,{title:`${j} | Readit`,description:(null==y?void 0:y.substring(0,150))||j,image:C||(null==v?void 0:v.icon),type:"article",schema:{"@context":"https://schema.org","@type":"DiscussionForumPosting",headline:j,text:y,image:C,datePublished:N,author:{"@type":"Person",name:null==(l=null==f?void 0:f.personal_info)?void 0:l.username},interactionStatistic:[{"@type":"InteractionCounter",interactionType:"https://schema.org/LikeAction",userInteractionCount:_},{"@type":"InteractionCounter",interactionType:"https://schema.org/CommentAction",userInteractionCount:S}]}}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-12 bg-gray-50 dark:bg-gray-800/50 border-r border-gray-100 dark:border-gray-700 pt-4",children:e.jsx(m,{item:u})}),e.jsxs("div",{className:"p-4 md:p-6 w-full min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mb-4 flex-wrap",children:[e.jsxs(a,{to:`/readit/c/${null==v?void 0:v.name}`,className:"flex items-center gap-1 font-bold text-black dark:text-white hover:underline",children:[(null==v?void 0:v.icon)&&e.jsx("img",{src:v.icon,alt:"",className:"w-5 h-5 rounded-full object-cover"}),"c/",null==v?void 0:v.name]}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsxs("span",{children:["Posted by u/",null==(o=null==f?void 0:f.personal_info)?void 0:o.username]}),e.jsx("span",{children:i(N)})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-4 leading-tight",children:j}),e.jsx("div",{className:"mb-6",children:(()=>{switch(k){case"text":return e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-800 dark:text-gray-200 leading-relaxed",children:e.jsx(t,{children:y})});case"link":return e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"block p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium",children:[e.jsx("i",{className:"fi fi-rr-link"}),e.jsx("span",{className:"truncate",children:w}),e.jsx("i",{className:"fi fi-rr-arrow-up-right-from-square text-xs opacity-0 group-hover:opacity-100 transition-opacity"})]})});case"image":return e.jsx("div",{className:"bg-black rounded-lg overflow-hidden flex justify-center",children:e.jsx("img",{src:C,alt:j,className:"max-h-[80vh] max-w-full object-contain"})});default:return null}})()}),e.jsxs("div",{className:"flex items-center text-gray-500 text-sm font-bold gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 px-3 py-1.5 rounded-lg",children:[e.jsx("i",{className:"fi fi-rr-comment-alt"}),S," Comments"]}),e.jsxs("button",{className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-1.5 rounded-lg transition-colors",children:[e.jsx("i",{className:"fi fi-rr-share"})," Share"]}),e.jsxs("button",{className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 px-3 py-1.5 rounded-lg transition-colors",children:[e.jsx("i",{className:"fi fi-rr-bookmark"})," Save"]})]})]})]})}),e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"py-10 text-center",children:e.jsx(c,{})}),children:e.jsx(p,{post:u})})]})};export{f as default};
