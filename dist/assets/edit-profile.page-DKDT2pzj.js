import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{r}from"./vendor-react-B32pNUrn.js";import{U as i,a as t,A as a,L as s,s as l}from"./index-DPOBqJFm.js";import{I as n}from"./Input-BuC4wpFo.js";import{c as o,O as c}from"./vendor-ui-BqXYh4xT.js";import{U as m}from"./aws-CH4kjFLt.js";import{l as u}from"./vendor-socket-CUkmNz_4.js";const d=()=>{const{userAuth:d,userAuth:{access_token:f,id:g},setUserAuth:p}=r.useContext(i),[b,h]=r.useState(!0),[x,v]=r.useState(!1),[w,j]=r.useState({fullname:"",email:"",username:"",bio:"",profile_img:""}),[y,k]=r.useState({twitter:"",instagram:"",facebook:"",github:"",linkedin:"",website:""}),[N,_]=r.useState(150),[S,I]=r.useState({fullname:!1,username:!1,bio:!0}),[U,C]=r.useState(!1),[P,A]=r.useState(null),R=r.useRef(),E=r.useRef();r.useEffect(()=>{if(f)return E.current=u("http://localhost:4000",{auth:{token:`Bearer ${f}`}}),E.current.emit("joinProfileRoom",{userId:g}),E.current.on("profileUpdated",e=>{var r;if(e._id===g){const{personal_info:i,social_links:t}=e;j({fullname:i.fullname,email:i.email,username:i.username,bio:i.bio,profile_img:i.profile_img}),k({twitter:t.twitter||"",instagram:t.instagram||"",facebook:t.facebook||"",github:t.github||"",linkedin:t.linkedin||"",website:t.website||""}),_(150-((null==(r=i.bio)?void 0:r.length)||0)),o.success("Your profile was updated elsewhere, refreshing view.")}}),()=>{E.current&&E.current.disconnect()}},[f,g]),r.useEffect(()=>{f?t.post("/get-profile",{username:d.username}).then(({data:e})=>{var r;const{personal_info:i,social_links:t={}}=e;j({fullname:i.fullname,email:i.email,username:i.username,bio:i.bio,profile_img:i.profile_img}),k({twitter:t.twitter||"",instagram:t.instagram||"",facebook:t.facebook||"",github:t.github||"",linkedin:t.linkedin||"",website:t.website||""}),_(150-((null==(r=i.bio)?void 0:r.length)||0)),h(!1)}).catch(e=>{o.error("Failed to load profile. Please try again.")}):window.location.href="/signin"},[f,d.username]),r.useEffect(()=>{const e=w.fullname.trim().length>=3,r=/^[a-zA-Z0-9_]{3,20}$/.test(w.username),i=w.bio.length<=150;I({fullname:e,username:r,bio:i}),C(e&&r&&i)},[w]);const L=(e,r)=>{j(i=>({...i,[e]:r}))};return b?e.jsxs(a,{children:[e.jsx(c,{position:"top-center"}),e.jsx(s,{})]}):e.jsxs(a,{children:[e.jsx(c,{position:"top-center"}),e.jsx("form",{onSubmit:async e=>{var r,i,a;if(e.preventDefault(),b)return o.error("Loading data, please wait.");if(!U)return o.error("Please fix validation errors before saving.");v(!0);const s={username:w.username.trim(),fullname:w.fullname.trim(),bio:w.bio.trim(),social_links:{twitter:y.twitter.trim(),instagram:y.instagram.trim(),facebook:y.facebook.trim(),github:y.github.trim(),linkedin:y.linkedin.trim(),website:y.website.trim()}};try{await t.post("/update-profile",s),o.success("Profile updated successfully!"),E.current.emit("forceProfileRefresh",{userId:g})}catch(l){if(422===(null==(r=l.response)?void 0:r.status)&&Array.isArray(l.response.data.errors))l.response.data.errors.forEach(e=>{o.error(e)});else{const e=(null==(a=null==(i=l.response)?void 0:i.data)?void 0:a.error)||"An unexpected error occurred while saving.";o.error(e)}}finally{v(!1)}},className:"max-w-3xl  mx-auto px-4 py-10 sm:px-6",children:e.jsxs("div",{className:"bg-white border-4 dark:bg-black/20 shadow-xl rounded-3xl overflow-hidden backdrop-blur-xl ring-1 ring-cyan-100/30",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-900 to-indigo-900 text-white p-6 sm:p-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Profile"}),e.jsx("p",{className:"text-cyan-100 text-sm mt-1",children:"Craft your online identity"})]}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative group w-32 h-32 sm:w-40 sm:h-40",children:[e.jsx("img",{ref:R,src:w.profile_img||"/default-profile.png",alt:"Profile",className:"w-full h-full object-cover rounded-full border-4 border-white shadow-lg group-hover:scale-105 transition"}),e.jsxs("label",{htmlFor:"profileImg",className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center rounded-full cursor-pointer transition",children:[e.jsx("i",{className:"fi fi-rr-camera text-white text-xl mb-1"}),e.jsx("span",{className:"text-white text-sm",children:"Change"}),e.jsx("input",{type:"file",name:"profileImg",id:"profileImg",accept:".jpeg,.jpg,.png,.webp,.svg",className:"hidden",onChange:e=>{const r=e.target.files[0];r&&(R.current.src=URL.createObjectURL(r),A(r))}})]})]})}),e.jsx("button",{onClick:async e=>{var r;if(e.preventDefault(),!P)return void o.error("Please choose an image first.");const i=o.loading("Uploading image...");try{const e=await m(P);if(!e||!e.url)throw new Error("Upload failed: no URL returned");w.profile_img;j(r=>({...r,profile_img:e.url}));const a={url:e.url,profile_img:e.url};e.public_id&&(a.public_id=e.public_id,a.publicId=e.public_id,a.cloudinary_id=e.public_id);const s=await t.post("/changeImg",a),n=(null==(r=null==s?void 0:s.data)?void 0:r.profile_img)||e.url,c={...d,profile_img:n};l("user",JSON.stringify(c)),p(c),o.dismiss(i),A(null),o.success("Profile image updated!"),E.current.emit("forceProfileRefresh",{userId:g})}catch(a){j(e=>({...e,profile_img:e.profile_img})),o.dismiss(i),o.error("Failed to update image.")}},disabled:!P,className:"btn-dark mt-5 center  lg:w-[50%] px-10 "+(P?"":"opacity-50 cursor-not-allowed"),children:"Upload Image"}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-6",children:[e.jsx(n,{name:"fullname",type:"text",label:"Full Name",value:w.fullname,onChange:e=>L("fullname",e.target.value),className:"capitalize",icon:"fi-rr-user",validation:S.fullname,helper:S.fullname?"":"Full name must be at least 3 letters."}),e.jsx(n,{name:"email",type:"email",label:"Email",value:w.email,icon:"fi-rr-envelope",validation:!0,readOnly:!0}),e.jsx(n,{name:"username",type:"text",label:"Username",value:w.username,onChange:e=>L("username",e.target.value),icon:"fi-rr-at",validation:S.username,helper:S.username?"":"3–20 chars; letters, numbers, or underscore only."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-white mb-1",children:"Bio"}),e.jsx("textarea",{name:"bio",value:w.bio,onChange:e=>{L("bio",e.target.value),_(150-e.target.value.length)},maxLength:150,placeholder:"Describe yourself in 150 characters",className:"w-full h-36 p-3 border rounded-xl shadow-sm bg-white/70 focus:ring-2 focus:ring-cyan-500 resize-none "+(S.bio?"":"border-red-400")}),!S.bio&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Bio must be 150 characters or fewer."}),e.jsxs("p",{className:"text-xs mt-1 text-right text-cyan-600",children:[N,"/150"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-800 dark:text-white mb-3",children:"Social Links"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Object.entries({twitter:"fi fi-brands-twitter",instagram:"fi fi-brands-instagram",facebook:"fi fi-brands-facebook",github:"fi fi-brands-github",linkedin:"fi fi-brands-linkedin",website:"fi fi-rr-globe"}).map(([r,i])=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`${i} text-xl text-cyan-500`}),e.jsx("input",{name:r,type:"url",value:y[r]||"",onChange:e=>((e,r)=>{k(i=>({...i,[e]:r}))})(r,e.target.value),placeholder:`${r}.com/username`,className:"flex-1 p-2 rounded-lg bg-white/80 border focus:ring-cyan-500 focus:ring-2"})]},r))})]}),e.jsx("div",{className:"pt-6 text-right",children:e.jsx("button",{type:"submit",disabled:!U||x,className:"px-8 py-3 rounded-xl text-white font-bold transition-all duration-300 "+(U&&!x?"bg-gradient-to-r from-cyan-500 to-blue-600 hover:scale-105 shadow-md":"bg-gray-400 cursor-not-allowed"),children:x?"Saving…":"Save Changes"})})]})]})})]})};export{d as default};
