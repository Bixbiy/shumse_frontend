import{f as C,r as o,u as T,j as e,H as L,m as U,b as j,a as N,V as r,U as P}from"./index-MvaMJuCp.js";const F=()=>{const c=C(),{userAuth:l}=o.useContext(T),[t,x]=o.useState({communityName:"",title:"",content:"",postType:"text",url:"",image:""}),[p,k]=o.useState([]),[u,h]=o.useState(!0),[g,y]=o.useState(!1),[b,f]=o.useState(!1);o.useEffect(()=>{if(!(l!=null&&l.access_token))return;(async()=>{h(!0);try{const{data:s}=await N.get("/readit/user/communities");k(s||[])}catch(s){console.error("Failed to fetch user communities:",s),r.error("Could not load your communities.")}finally{h(!1)}})()},[l==null?void 0:l.access_token]);const m=a=>{const{name:s,value:i}=a.target;x(d=>({...d,[s]:i}))},v=async a=>{const s=a.target.files[0];if(s){if(s.size>5*1024*1024)return r.error("Image size should be less than 5MB");y(!0);try{const i=await P(s),d=typeof i=="string"?i:i.url;x(n=>({...n,image:d})),r.success("Image uploaded successfully!")}catch(i){console.error("Upload failed:",i),r.error("Failed to upload image")}finally{y(!1)}}},w=async a=>{var i,d;if(a.preventDefault(),!t.communityName)return r.error("Please select a community");if(!t.title.trim())return r.error("Title is required");if(t.postType==="link"){if(!t.url)return r.error("URL is required for link posts");try{new URL(t.url)}catch{return r.error("Please enter a valid URL")}}if(t.postType==="image"&&!t.image)return r.error("Please upload an image");f(!0);const s={title:t.title,content:t.content,postType:t.postType,url:t.url,image:t.image};try{const{data:n}=await N.post(`/readit/c/${t.communityName}/posts`,s);r.success("Post created successfully!"),c(`/readit/post/${n._id}`)}catch(n){console.error("Failed to create post:",n),r.error(((d=(i=n.response)==null?void 0:i.data)==null?void 0:d.error)||"Failed to create post.")}finally{f(!1)}};return l!=null&&l.access_token?e.jsxs("div",{className:"max-w-2xl mx-auto p-4 md:p-8",children:[e.jsx(L,{children:e.jsx("title",{children:"Create Post | Readit"})}),e.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8 pb-6 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"bg-orange-500 text-white p-3 rounded-xl shadow-lg shadow-orange-500/20",children:e.jsx("i",{className:"fi fi-rr-edit text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white leading-tight",children:"Create a Post"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Share with the community"})]})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"communityName",className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:["Choose Community ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fi fi-rr-users absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsxs("select",{id:"communityName",name:"communityName",value:t.communityName,onChange:m,className:"input-box pl-10 appearance-none cursor-pointer",required:!0,disabled:u,children:[e.jsx("option",{value:"",children:u?"Loading...":"Select a community"}),p.map(a=>e.jsxs("option",{value:a.name,children:["c/",a.name]},a._id))]}),e.jsx("i",{className:"fi fi-rr-angle-small-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"})]}),!u&&p.length===0&&e.jsxs("p",{className:"text-xs text-orange-500 mt-2",children:["You need to join a community first. ",e.jsx("span",{className:"underline cursor-pointer",onClick:()=>c("/readit/create-community"),children:"Create one?"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:"Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 p-1 bg-gray-100 dark:bg-gray-700/50 rounded-xl",children:["text","image","link"].map(a=>e.jsxs("button",{type:"button",onClick:()=>x(s=>({...s,postType:a})),className:`flex items-center justify-center gap-2 py-2 rounded-lg text-sm font-medium transition-all ${t.postType===a?"bg-white dark:bg-gray-700 text-orange-600 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:[e.jsx("i",{className:`fi fi-rr-${a==="text"?"document":a==="image"?"picture":"link-alt"}`}),e.jsx("span",{className:"capitalize",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",value:t.title,onChange:m,placeholder:"An interesting title...",className:"input-box text-lg font-semibold placeholder:font-normal",maxLength:300,required:!0}),e.jsxs("div",{className:"text-right text-xs text-gray-400 mt-1",children:[t.title.length,"/300"]})]}),e.jsxs("div",{className:"min-h-[150px]",children:[t.postType==="text"&&e.jsx("div",{className:"animate-in fade-in duration-300",children:e.jsx("textarea",{name:"content",value:t.content,onChange:m,placeholder:"Text (optional). Markdown is supported.",className:"input-box min-h-[200px] resize-y font-mono text-sm leading-relaxed"})}),t.postType==="image"&&e.jsx("div",{className:"animate-in fade-in duration-300",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors relative",children:[e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",onChange:v,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:g}),g?e.jsx(j,{}):t.image?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:t.image,alt:"Preview",className:"max-h-64 rounded-lg shadow-md"}),e.jsx("div",{className:"absolute -top-2 -right-2 bg-black text-white text-xs px-2 py-1 rounded-full",children:"Click to change"})]}):e.jsxs("div",{className:"pointer-events-none",children:[e.jsx("i",{className:"fi fi-rr-cloud-upload text-4xl text-gray-300 dark:text-gray-600 mb-2 block"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Drag and drop or click to upload"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Max 5MB"})]})]})}),t.postType==="link"&&e.jsxs("div",{className:"animate-in fade-in duration-300",children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 dark:text-gray-200 mb-2",children:["Link URL ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fi fi-rr-link absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"url",name:"url",value:t.url,onChange:m,placeholder:"https://...",className:"input-box pl-10 text-blue-500",required:!0})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>c(-1),className:"flex-1 btn-light py-3 rounded-xl font-bold text-gray-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b||g||t.postType==="image"&&!t.image,className:"flex-[2] btn-dark py-3 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsx(j,{}):e.jsxs(e.Fragment,{children:["Post",e.jsx("i",{className:"fi fi-rr-paper-plane"})]})})]})]})]})]}):e.jsxs("div",{className:"max-w-2xl mx-auto p-8 flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-full p-6 mb-6",children:e.jsx("i",{className:"fi fi-rr-lock text-4xl text-yellow-600 dark:text-yellow-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Please sign in to share your thoughts."}),e.jsx("button",{onClick:()=>c("/signin"),className:"btn-dark px-8",children:"Sign In"})]})};export{F as default};
