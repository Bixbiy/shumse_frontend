import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{r as t,h as s,u as r}from"./vendor-react-B32pNUrn.js";import{I as a,U as o,h as i}from"./index-DPOBqJFm.js";import{H as n,V as d}from"./vendor-ui-BqXYh4xT.js";import{U as l}from"./aws-CH4kjFLt.js";import"./vendor-socket-CUkmNz_4.js";var u=t.createContext(void 0);const m=()=>{const e=(()=>{const e=t.useContext(u);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e})(),{userAuth:s}=t.useContext(o);return useMutation({mutationFn:({communityName:e,postData:t})=>i.post(`http://localhost:4000/api/v1/readit/c/${e}/posts`,t,{headers:{Authorization:`Bearer ${s.access_token}`}}),onSuccess:(t,s)=>{e.invalidateQueries({queryKey:["communityPosts",s.communityName]}),d.success("Post created!")},onError:e=>{var t,s;d.error((null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.error)||"Failed to create post.")}})},c=()=>{const{communityName:o}=s(),i=r(),{userAuth:u}=t.useContext(userContext),c=t.useRef();t.useRef(0);const[p,x]=t.useState("text"),[h,g]=t.useState(""),[v,j]=t.useState(""),[f,y]=t.useState(""),[b,N]=t.useState(""),{mutate:k,isLoading:C}=m();return e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx(n,{children:e.jsxs("title",{children:["Submit to c/",o]})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Create a Post"}),e.jsxs("p",{className:"text-dark-grey mb-4",children:["Posting to ",e.jsxs("span",{className:"font-semibold",children:["c/",o]})]}),e.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark",children:[e.jsx(a,{ref:c,routes:["Text","Image","Link"],defaultIndex:0,onChange:(e,t)=>{x(e.innerText.toLowerCase())}}),e.jsxs("div",{className:"p-4",children:[e.jsx("input",{type:"text",placeholder:"Title",value:h,onChange:e=>g(e.target.value),className:"input-box mb-4 text-2xl font-semibold"}),"text"===p&&e.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:v,onChange:e=>j(e.target.value),className:"input-box h-40"}),"image"===p&&e.jsxs("div",{className:"border border-dashed border-grey p-4 rounded-md text-center",children:[e.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;let s=d.loading("Uploading image...");try{const e=await l(t);N(e),d.success("Image uploaded!")}catch(r){d.error("Image upload failed.")}finally{d.dismiss(s)}},className:"hidden"}),e.jsx("label",{htmlFor:"upload-image-input",className:"cursor-pointer text-blue hover:underline",children:b?"Change Image":"Upload Image"}),b&&e.jsx("img",{src:b,alt:"Post preview",className:"w-full rounded-md mt-4"})]}),"link"===p&&e.jsx("input",{type:"url",placeholder:"https://your-link.com",value:f,onChange:e=>y(e.target.value),className:"input-box"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>{if(!h.trim())return d.error("A title is required.");if("link"===p&&!f)return d.error("A URL is required.");if("image"===p&&!b)return d.error("An image is required.");k({communityName:o,postData:{title:h,postType:p,content:"text"===p?v:void 0,url:"link"===p?f:void 0,image:"image"===p?b:void 0}},{onSuccess:e=>{i(`/readit/post/${e.data._id}`)}})},disabled:C,className:"btn-dark px-8",children:C?"Posting...":"Post"})})]})]})]})};export{c as default};
