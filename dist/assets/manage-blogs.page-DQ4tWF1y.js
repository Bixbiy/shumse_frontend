import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{a as s,U as t,f as a,I as l,L as o,A as r}from"./index-DPOBqJFm.js";import{r as d,L as i}from"./vendor-react-B32pNUrn.js";import{O as n,V as c}from"./vendor-ui-BqXYh4xT.js";import{F as g,a as x,b as u,c as p,d as m}from"./index-BK4evImG.js";import"./vendor-socket-CUkmNz_4.js";import"./iconBase-D8qOIRNa.js";const h=async({state:e,arr_data:t,page:a,countRoute:l,data_to_send:o={},user:r})=>{let d;if(null!=e&&a>1){const s=new Set(e.results.map(e=>e._id)),l=t.filter(e=>!s.has(e._id));d={...e,results:[...e.results,...l],page:a}}else try{const{data:{totalDocs:e}}=await s.post(l,o);d={results:t,page:1,totalDocs:e}}catch(i){d={results:t,page:1,totalDocs:t.length}}return d},b=({blog:s,onEdit:l,onDelete:o})=>{const{banner:r,des:c,title:h,activity:{total_likes:b,total_comments:j,total_reads:y},blog_id:N,publishedAt:v}=s,[P,S]=d.useState(!1),{userAuth:{access_token:w}}=d.useContext(t);return e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 mb-6 hover:shadow-lg",children:[e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:r,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-105",loading:"lazy",alt:h})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx(i,{to:`/post/${N}`,className:"",children:e.jsx("h3",{className:"text-xl hover:text-blue font-bold text-gray-900 line-clamp-2-600 transition-colors",children:h})}),e.jsx("span",{className:"text-sm text-gray-500 whitespace-nowrap ml-4",children:a(v)})]}),e.jsx("p",{className:"text-gray-600 mb-6 line-clamp-3",children:c}),e.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(i,{to:`/editor/${N}`,className:"flex items-center px-4 py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors","aria-label":"Edit post",children:[e.jsx(g,{className:"mr-2"}),"Edit"]}),e.jsxs("button",{onClick:e=>f(s,w,e.target),className:"flex items-center px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors","aria-label":"Delete post",children:[e.jsx(x,{className:"mr-2"}),"Delete"]})]}),e.jsxs("button",{onClick:()=>{S(!P)},className:"flex items-center px-4 py-2 bg-gray-50 text-gray-600 rounded-md hover:bg-gray-100 transition-colors","aria-label":P?"Hide statistics":"Show statistics",children:[e.jsx(u,{className:"mr-2"}),P?"Hide Stats":"Show Stats",P?e.jsx(p,{className:"ml-2"}):e.jsx(m,{className:"ml-2"})]})]}),P&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 animate-fadeIn",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Post Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Total Reads"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:y.toLocaleString()})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Likes"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:b.toLocaleString()})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Comments"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:j.toLocaleString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Last updated: ",a(new Date)]})})]})]})]})]})},j=({blog:s})=>{let{des:a,title:l,blog_id:o,index:r}=s;const{userAuth:{access_token:c}}=d.useContext(t);return r++,e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{className:"flex gap-5 lg:gap-10 border-b mb-6 border-black border-opacity-30",children:[e.jsx("h1",{className:"blog-index text-center pl-4 md:pl-6 flex-none",children:r<10?"0"+r:r}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"blog-title mb-3 ",children:l}),e.jsx("p",{className:"line-clamp-2 font-gelasio ",children:a.length?a:"No Description Found"}),e.jsxs("div",{className:"flex gap-6 mt-3",children:[e.jsx(i,{to:`/editor/${o}`,className:"text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:e=>f(s,c,e.target),className:"text-red-600 hover:underline",children:"Delete"})]})]})]})]})},f=(e,t,a)=>{const{index:l,blog_id:o,setStateFuc:r}=e;a.setAttribute("disabled","true"),a.classList.add("opacity-50","cursor-not-allowed"),s.post("/delete-blog",{blog_id:o}).then(({data:e})=>{a.removeAttribute("disabled"),r(e=>{let{deletedDocCount:s,totalDocs:t,results:a}=e;return a.splice(l,1),c.success("Blog deleted successfully!"),!a.length&&t-1>0?null:(s||(s=0),{...e,results:[...a],totalDocs:t-1,deleteDocCount:s+1})})}).catch(e=>{a.removeAttribute("disabled"),a.classList.remove("opacity-50","cursor-not-allowed"),alert("Failed to delete the blog. Please try again.")})},y=["Published Posts","Drafts","Stories"],N=()=>{const{userAuth:{access_token:a}}=d.useContext(t),[i,c]=d.useState(0),[g,x]=d.useState(""),[u,p]=d.useState({results:[],page:1,totalPages:1,totalDocs:0}),[m,f]=d.useState(!1),[N,v]=d.useState(null),[P,S]=d.useState({results:[],page:1,totalPages:1,totalDocs:0}),[w,k]=d.useState(!1),[C,_]=d.useState(null),[D,F]=d.useState({results:[],page:1,totalPages:1,totalDocs:0}),[L,A]=d.useState(!1),[E,q]=d.useState(null),R=d.useCallback(async(e=1)=>{if(a){f(!0),v(null);try{const{data:t}=await s.post("/get-user-blogs",{page:e,draft:!1,query:g,deletedDocCount:0}),l=await h({state:u,arr_data:t.blogs,page:e,user:a,countRoute:"/get-user-blogs-count",data_to_send:{draft:!1,query:g}});p(l)}catch(t){v("Failed to load published posts. Please try again.")}finally{f(!1)}}},[a,g]),T=d.useCallback(async(e=1)=>{if(a){k(!0),_(null);try{const{data:t}=await s.post("/get-user-blogs",{page:e,draft:!0,query:g,deletedDocCount:0}),l=await h({state:P,arr_data:t.blogs,page:e,user:a,countRoute:"/get-user-blogs-count",data_to_send:{draft:!0,query:g}});S(l)}catch(t){_("Failed to load draft posts. Please try again.")}finally{k(!1)}}},[a,g]),I=d.useCallback(async(e=1)=>{if(a){A(!0),q(null);try{const{data:t}=await s.post("/get-user-stories",{page:e,query:g}),a={results:t.stories||[],page:e,totalPages:t.totalPages||1,totalDocs:t.totalDocs||t.stories.length||0};F(a)}catch(t){q("Failed to load stories. Please try again.")}finally{A(!1)}}},[a,g]);d.useEffect(()=>{a&&(p(e=>({...e,page:1})),S(e=>({...e,page:1})),F(e=>({...e,page:1})),R(1),T(1))},[a,g,R,T,I]),d.useEffect(()=>{a&&u.page>1&&u.page<=u.totalPages&&R(u.page)},[a,u.page,u.totalPages,R]),d.useEffect(()=>{a&&P.page>1&&P.page<=P.totalPages&&T(P.page)},[a,P.page,P.totalPages,T]),d.useEffect(()=>{a&&D.page>1&&D.page<=D.totalPages&&I(D.page)},[a,D.page,D.totalPages,I]);const $=e=>{e>=1&&e<=u.totalPages&&p(s=>({...s,page:e}))},B=e=>{e>=1&&e<=P.totalPages&&S(s=>({...s,page:e}))},H=e=>{e>=1&&e<=D.totalPages&&F(s=>({...s,page:e}))};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"hidden md:block text-3xl font-semibold mb-6",children:"Manage Posts"}),e.jsx(n,{}),e.jsxs("div",{className:"relative max-w-md mx-auto mb-8",children:[e.jsx("input",{type:"search",value:g,placeholder:"Search Posts",className:"w-full px-4 py-3 rounded-full border-2 border-black placeholder:text-gray-500 focus:outline-none focus:border-blue-500",onChange:e=>{x(e.target.value.trim())},onKeyDown:e=>{e.key}}),g&&e.jsx("button",{className:"absolute right-4 top-2.5 text-gray-600",onClick:()=>{x("")},"aria-label":"Clear search",children:"âœ•"}),e.jsx("i",{className:"fi fi-rr-search absolute left-4 top-3 text-xl pointer-events-none"})]}),e.jsxs(l,{routes:y,activeIndex:i,onTabChange:c,children:[m?e.jsx(o,{}):N?e.jsx("p",{className:"text-red-600",children:N}):u.results.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:u.results.map((s,t)=>e.jsx(r,{transition:{delay:.04*t},children:e.jsx(b,{blog:{...s,index:t,setStateFuc:p}})},s._id||t))}),e.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(u.page-1),disabled:u.page<=1||m,children:"Previous"}),e.jsxs("span",{children:["Page ",u.page," of ",u.totalPages]}),e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(u.page+1),disabled:u.page>=u.totalPages||m,children:"Next"})]})]}):e.jsx("p",{children:"No published posts found."}),w?e.jsx(o,{}):C?e.jsx("p",{className:"text-red-600",children:C}):P.results.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:P.results.map((s,t)=>e.jsx(r,{transition:{delay:.04*t},children:e.jsx(j,{blog:{...s,index:t,setStateFuc:S}})},s._id||t))}),e.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>B(P.page-1),disabled:P.page<=1||w,children:"Previous"}),e.jsxs("span",{children:["Page ",P.page," of ",P.totalPages]}),e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>B(P.page+1),disabled:P.page>=P.totalPages||w,children:"Next"})]})]}):e.jsx("p",{children:"No Draft posts found."}),L?e.jsx(o,{}):E?e.jsx("p",{className:"text-red-600",children:E}):D.results.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:D.results.map((s,t)=>e.jsx(r,{transition:{delay:.04*t},children:e.jsx(b,{blog:{...s,index:t,setStateFuc:F}})},s._id||t))}),e.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>H(D.page-1),disabled:D.page<=1||L,children:"Previous"}),e.jsxs("span",{children:["Page ",D.page," of ",D.totalPages]}),e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>H(D.page+1),disabled:D.page>=D.totalPages||L,children:"Next"})]})]}):e.jsx("p",{children:"No stories found (coming soon!)."})]})]})};export{N as default};
