import{a as e,r as s,U as t,j as a,F as l,L as o,f as r,z as d,I as i,e as n,d as c}from"./index-BK9O-y3K.js";import{F as g,a as x,b as u,c as p,d as m}from"./index-Vd4AuS0o.js";import"./iconBase-BgOIwoCW.js";const h=async({state:s,arr_data:t,page:a,countRoute:l,data_to_send:o={},user:r})=>{let d;if(null!=s&&a>1){const e=new Set(s.results.map(e=>e._id)),l=t.filter(s=>!e.has(s._id));d={...s,results:[...s.results,...l],page:a}}else try{const{data:{totalDocs:s}}=await e.post(l,o);d={results:t,page:1,totalDocs:s}}catch(i){d={results:t,page:1,totalDocs:t.length}}return d},b=({blog:e,onEdit:d,onDelete:i})=>{const{banner:n,des:c,title:h,activity:{total_likes:b,total_comments:j,total_reads:y},blog_id:N,publishedAt:v}=e,[P,S]=s.useState(!1),{userAuth:{access_token:w}}=s.useContext(t);return a.jsxs(a.Fragment,{children:[a.jsx(l,{}),a.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 mb-6 hover:shadow-lg",children:[a.jsx("div",{className:"h-48 overflow-hidden",children:a.jsx("img",{src:n,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-105",loading:"lazy",alt:h})}),a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsx(o,{to:`/post/${N}`,className:"",children:a.jsx("h3",{className:"text-xl hover:text-blue font-bold text-gray-900 line-clamp-2-600 transition-colors",children:h})}),a.jsx("span",{className:"text-sm text-gray-500 whitespace-nowrap ml-4",children:r(v)})]}),a.jsx("p",{className:"text-gray-600 mb-6 line-clamp-3",children:c}),a.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(o,{to:`/editor/${N}`,className:"flex items-center px-4 py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors","aria-label":"Edit post",children:[a.jsx(g,{className:"mr-2"}),"Edit"]}),a.jsxs("button",{onClick:s=>f(e,w,s.target),className:"flex items-center px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors","aria-label":"Delete post",children:[a.jsx(x,{className:"mr-2"}),"Delete"]})]}),a.jsxs("button",{onClick:()=>{S(!P)},className:"flex items-center px-4 py-2 bg-gray-50 text-gray-600 rounded-md hover:bg-gray-100 transition-colors","aria-label":P?"Hide statistics":"Show statistics",children:[a.jsx(u,{className:"mr-2"}),P?"Hide Stats":"Show Stats",P?a.jsx(p,{className:"ml-2"}):a.jsx(m,{className:"ml-2"})]})]}),P&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 animate-fadeIn",children:[a.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Post Statistics"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Total Reads"}),a.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:y.toLocaleString()})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Likes"}),a.jsx("p",{className:"text-2xl font-bold text-green-900",children:b.toLocaleString()})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Comments"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:j.toLocaleString()})]})]}),a.jsx("div",{className:"mt-4",children:a.jsxs("p",{className:"text-sm text-gray-500",children:["Last updated: ",r(new Date)]})})]})]})]})]})},j=({blog:e})=>{let{des:r,title:d,blog_id:i,index:n}=e;const{userAuth:{access_token:c}}=s.useContext(t);return n++,a.jsxs(a.Fragment,{children:[a.jsx(l,{}),a.jsxs("div",{className:"flex gap-5 lg:gap-10 border-b mb-6 border-black border-opacity-30",children:[a.jsx("h1",{className:"blog-index text-center pl-4 md:pl-6 flex-none",children:n<10?"0"+n:n}),a.jsxs("div",{className:"",children:[a.jsx("h1",{className:"blog-title mb-3 ",children:d}),a.jsx("p",{className:"line-clamp-2 font-gelasio ",children:r.length?r:"No Description Found"}),a.jsxs("div",{className:"flex gap-6 mt-3",children:[a.jsx(o,{to:`/editor/${i}`,className:"text-blue-600 hover:underline",children:"Edit"}),a.jsx("button",{onClick:s=>f(e,c,s.target),className:"text-red-600 hover:underline",children:"Delete"})]})]})]})]})},f=(s,t,a)=>{const{index:l,blog_id:o,setStateFuc:r}=s;a.setAttribute("disabled","true"),a.classList.add("opacity-50","cursor-not-allowed"),e.post("/delete-blog",{blog_id:o}).then(({data:e})=>{a.removeAttribute("disabled"),r(e=>{let{deletedDocCount:s,totalDocs:t,results:a}=e;return a.splice(l,1),d.success("Blog deleted successfully!"),!a.length&&t-1>0?null:(s||(s=0),{...e,results:[...a],totalDocs:t-1,deleteDocCount:s+1})})}).catch(e=>{a.removeAttribute("disabled"),a.classList.remove("opacity-50","cursor-not-allowed"),alert("Failed to delete the blog. Please try again.")})},y=["Published Posts","Drafts","Stories"],N=()=>{const{userAuth:{access_token:o}}=s.useContext(t),[r,d]=s.useState(0),[g,x]=s.useState(""),[u,p]=s.useState({results:[],page:1,totalPages:1,totalDocs:0}),[m,f]=s.useState(!1),[N,v]=s.useState(null),[P,S]=s.useState({results:[],page:1,totalPages:1,totalDocs:0}),[w,C]=s.useState(!1),[_,D]=s.useState(null),[k,F]=s.useState({results:[],page:1,totalPages:1,totalDocs:0}),[E,L]=s.useState(!1),[A,q]=s.useState(null),R=s.useCallback(async(s=1)=>{if(o){f(!0),v(null);try{const{data:t}=await e.post("/get-user-blogs",{page:s,draft:!1,query:g,deletedDocCount:0}),a=await h({state:u,arr_data:t.blogs,page:s,user:o,countRoute:"/get-user-blogs-count",data_to_send:{draft:!1,query:g}});p(a)}catch(t){v("Failed to load published posts. Please try again.")}finally{f(!1)}}},[o,g]),T=s.useCallback(async(s=1)=>{if(o){C(!0),D(null);try{const{data:t}=await e.post("/get-user-blogs",{page:s,draft:!0,query:g,deletedDocCount:0}),a=await h({state:P,arr_data:t.blogs,page:s,user:o,countRoute:"/get-user-blogs-count",data_to_send:{draft:!0,query:g}});S(a)}catch(t){D("Failed to load draft posts. Please try again.")}finally{C(!1)}}},[o,g]),I=s.useCallback(async(s=1)=>{if(o){L(!0),q(null);try{const{data:t}=await e.post("/get-user-stories",{page:s,query:g}),a={results:t.stories||[],page:s,totalPages:t.totalPages||1,totalDocs:t.totalDocs||t.stories.length||0};F(a)}catch(t){q("Failed to load stories. Please try again.")}finally{L(!1)}}},[o,g]);s.useEffect(()=>{o&&(p(e=>({...e,page:1})),S(e=>({...e,page:1})),F(e=>({...e,page:1})),R(1),T(1))},[o,g,R,T,I]),s.useEffect(()=>{o&&u.page>1&&u.page<=u.totalPages&&R(u.page)},[o,u.page,u.totalPages,R]),s.useEffect(()=>{o&&P.page>1&&P.page<=P.totalPages&&T(P.page)},[o,P.page,P.totalPages,T]),s.useEffect(()=>{o&&k.page>1&&k.page<=k.totalPages&&I(k.page)},[o,k.page,k.totalPages,I]);const $=e=>{e>=1&&e<=u.totalPages&&p(s=>({...s,page:e}))},z=e=>{e>=1&&e<=P.totalPages&&S(s=>({...s,page:e}))},B=e=>{e>=1&&e<=k.totalPages&&F(s=>({...s,page:e}))};return a.jsxs(a.Fragment,{children:[a.jsx("h1",{className:"hidden md:block text-3xl font-semibold mb-6",children:"Manage Posts"}),a.jsx(l,{}),a.jsxs("div",{className:"relative max-w-md mx-auto mb-8",children:[a.jsx("input",{type:"search",value:g,placeholder:"Search Posts",className:"w-full px-4 py-3 rounded-full border-2 border-black placeholder:text-gray-500 focus:outline-none focus:border-blue-500",onChange:e=>{x(e.target.value.trim())},onKeyDown:e=>{e.key}}),g&&a.jsx("button",{className:"absolute right-4 top-2.5 text-gray-600",onClick:()=>{x("")},"aria-label":"Clear search",children:"âœ•"}),a.jsx("i",{className:"fi fi-rr-search absolute left-4 top-3 text-xl pointer-events-none"})]}),a.jsxs(i,{routes:y,activeIndex:r,onTabChange:d,children:[m?a.jsx(n,{}):N?a.jsx("p",{className:"text-red-600",children:N}):u.results.length?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-4",children:u.results.map((e,s)=>a.jsx(c,{transition:{delay:.04*s},children:a.jsx(b,{blog:{...e,index:s,setStateFuc:p}})},e._id||s))}),a.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(u.page-1),disabled:u.page<=1||m,children:"Previous"}),a.jsxs("span",{children:["Page ",u.page," of ",u.totalPages]}),a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(u.page+1),disabled:u.page>=u.totalPages||m,children:"Next"})]})]}):a.jsx("p",{children:"No published posts found."}),w?a.jsx(n,{}):_?a.jsx("p",{className:"text-red-600",children:_}):P.results.length?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-4",children:P.results.map((e,s)=>a.jsx(c,{transition:{delay:.04*s},children:a.jsx(j,{blog:{...e,index:s,setStateFuc:S}})},e._id||s))}),a.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>z(P.page-1),disabled:P.page<=1||w,children:"Previous"}),a.jsxs("span",{children:["Page ",P.page," of ",P.totalPages]}),a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>z(P.page+1),disabled:P.page>=P.totalPages||w,children:"Next"})]})]}):a.jsx("p",{children:"No Draft posts found."}),E?a.jsx(n,{}):A?a.jsx("p",{className:"text-red-600",children:A}):k.results.length?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-4",children:k.results.map((e,s)=>a.jsx(c,{transition:{delay:.04*s},children:a.jsx(b,{blog:{...e,index:s,setStateFuc:F}})},e._id||s))}),a.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>B(k.page-1),disabled:k.page<=1||E,children:"Previous"}),a.jsxs("span",{children:["Page ",k.page," of ",k.totalPages]}),a.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>B(k.page+1),disabled:k.page>=k.totalPages||E,children:"Next"})]})]}):a.jsx("p",{children:"No stories found (coming soon!)."})]})]})};export{N as default};
