import{r as i,u as V,f as $,j as a,V as k,a as y}from"./index-MvaMJuCp.js";const C=({item:g,isComment:p=!1})=>{const{userAuth:e}=i.useContext(V);$();const{_id:l="",upvotedBy:b=[],downvotedBy:v=[],votes:d=0}=g||{},[c,m]=i.useState(!1),[u,f]=i.useState(d),[o,s]=i.useState("none");i.useEffect(()=>{e!=null&&e.id?b.includes(e.id)?s("up"):v.includes(e.id)?s("down"):s("none"):s("none"),f(d)},[b,v,d,e]);const h=async t=>{if(!(e!=null&&e.access_token))return k.error("Please sign in to vote");if(!l||c)return;m(!0);const j=u,n=o;let w=t,r=u;n===t?(w="none",t==="up"&&(r-=1),t==="down"&&(r+=1)):(n==="up"&&(r-=1),n==="down"&&(r+=1),t==="up"&&(r+=1),t==="down"&&(r-=1)),f(r),s(w);try{const x=n===t?"none":t,N=p?`/readit/comments/${l}/vote`:`/readit/posts/${l}/vote`;await y.put(N,{voteType:x})}catch(x){console.error("Vote failed:",x),k.error("Vote failed"),f(j),s(n)}finally{m(!1)}};return g?a.jsxs("div",{className:`flex flex-col items-center ${p?"gap-0":"gap-1"}`,children:[a.jsx("button",{onClick:()=>h("up"),disabled:c,className:`p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${o==="up"?"text-orange-500 bg-orange-50 dark:bg-orange-900/20":"text-gray-400 hover:text-orange-500"}`,children:a.jsx("i",{className:`fi ${o==="up"?"fi-sr-arrow-square-up":"fi-rr-arrow-square-up"} text-xl`})}),a.jsx("span",{className:`text-xs font-bold ${o==="up"?"text-orange-500":o==="down"?"text-blue-500":"text-black dark:text-white"}`,children:Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(u)}),a.jsx("button",{onClick:()=>h("down"),disabled:c,className:`p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${o==="down"?"text-blue-500 bg-blue-50 dark:bg-blue-900/20":"text-gray-400 hover:text-blue-500"}`,children:a.jsx("i",{className:`fi ${o==="down"?"fi-sr-arrow-square-down":"fi-rr-arrow-square-down"} text-xl`})})]}):null};export{C as V};
