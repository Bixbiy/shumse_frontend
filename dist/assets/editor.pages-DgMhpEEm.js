import{g as e,r as t,u as s,j as a,L as r,F as l,n as o,b as n}from"./vendor-react-CvqM9zc9.js";import{U as i,A as c,a as d,L as u}from"./index-kVKNAyzJ.js";import{U as g}from"./aws-BlzNu9QY.js";import{T as h,S as p}from"./StoryEditor-DEkBXjBU.js";import{L as m}from"./vendor-misc-BFmcx_8c.js";import{A as b,s as x,h as f,f as v,n as y,F as j,I as w,a as N,b as k,d as C,c as S,i as T,m as P,e as E,P as L,g as B,v as D}from"./vendor-editor-DxzJNwHO.js";import"./vendor-socket-DIFBDcho.js";import"./vendor-utils-DnwaQ9mb.js";import"./vendor-animation-BFb6eZlp.js";const U="/assets/blog%20banner-CeC6Biu5.png",_=async e=>{try{const{url:t}=await g(e);if(t)return{success:1,file:{url:t}};throw new Error("Upload failed, no URL returned.")}catch(t){return o.error("Image upload failed. Try again!"),{success:0}}},z=async e=>new Promise(t=>{t({success:1,file:{url:e}})}),A=e=>{const t=(e=>{const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&11===t[2].length?t[2]:null})(e);return t?`<div class="embed-responsive aspect-video">\n    <iframe \n      width="100%" \n      height="100%" \n      src="https://www.youtube.com/embed/${t}"\n      frameborder="0" \n      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" \n      allowfullscreen>\n    </iframe>\n  </div>`:null},F=()=>{const{blog_id:n}=e(),{blog:u,blog:{title:h,banner:p,des:m,content:F,isPublished:W},setBlog:H,textState:M,setTextState:q,editorState:I,setEditorState:K}=t.useContext(R);t.useRef(null);const[V,Y]=t.useState(u.banner||U),Q=t.useRef(null),{userAuth:{access_token:Z}}=t.useContext(i),$=s();t.useEffect(()=>{n&&H(e=>({...e,blog_id:n}))},[n,H]);const G=()=>{const e=new b({holder:"text-editor",placeholder:"Write your post here...",autofocus:!0,tools:{header:{class:D,inlineToolbar:!0,config:{placeholder:"Enter a post header",levels:[2,3,4],defaultLevel:3}},list:{class:B,inlineToolbar:!0},image:{class:L,config:{uploader:{uploadByFile:_,uploadByUrl:z}}},embed:{class:E,inlineToolbar:!0,config:{services:{youtube:!0,coub:!0}}},quote:{class:P,inlineToolbar:!0,config:{quotePlaceholder:"Enter a quote",captionPlaceholder:"Quote's author"}},warning:T,marker:S,code:C,delimiter:k,inlineCode:N,linkTool:w,table:{class:j,inlineToolbar:!0},paragraph:{class:y,inlineToolbar:!0},checklist:{class:v,inlineToolbar:!0},simpleImage:f,raw:x,youtubeEmbed:{class:class{static get toolbox(){return{title:"YouTube",icon:'<svg width="20" height="20" viewBox="0 0 24 24"><path d="M21.582,6.186c-0.23-0.86-0.908-1.538-1.768-1.768C18.254,4,12,4,12,4S5.746,4,4.186,4.418 c-0.86,0.23-1.538,0.908-1.768,1.768C2,7.746,2,12,2,12s0,4.254,0.418,5.814c0.23,0.86,0.908,1.538,1.768,1.768 C5.746,20,12,20,12,20s6.254,0,7.814-0.418c0.861-0.23,1.538-0.908,1.768-1.768C22,16.254,22,12,22,12S22,7.746,21.582,6.186z M10,15.464V8.536L16,12L10,15.464z" fill="#FF0000"/></svg>'}}constructor({data:e,api:t}){this.api=t,this.data={url:e.url||""}}render(){const e=document.createElement("div"),t=document.createElement("input");if(t.placeholder="Paste YouTube URL here...",t.value=this.data.url,t.classList.add("ce-paragraph","cdx-block"),t.addEventListener("paste",t=>{const s=t.clipboardData.getData("text"),a=A(s);a&&(e.innerHTML=a,this.data.url=s)}),t.addEventListener("change",t=>{const s=t.target.value,a=A(s);a&&(e.innerHTML=a,this.data.url=s)}),this.data.url){const t=A(this.data.url);t&&(e.innerHTML=t)}else e.appendChild(t);return e}save(e){return{url:this.data.url}}}}},data:Array.isArray(F)?F[0]:F,onChange:async()=>{let t=await e.save();H(e=>({...e,content:t})),q(t)}});Q.current=e};t.useEffect(()=>(Q.current||G(),()=>{}),[]);return a.jsxs(a.Fragment,{children:[a.jsxs("nav",{className:"navbar",children:[a.jsx(r,{to:"/",className:"flex-none w-10",children:a.jsx("img",{src:"/assets/logo-BDStWcZC.png",alt:"logo"})}),a.jsx("p",{className:"max-md:hidden text-black line-clamp-1 w-full",children:h.length?h:"New Blog"}),a.jsxs("div",{className:"flex gap-4 ml-auto",children:[a.jsx("button",{className:"btn-dark py-2",onClick:()=>p.length?h.length?0!==M.blocks.length||m.length?void K("publish"):o.error("Write something in your blog to publish it"):o.error("Write blog title to publish it"):o.error("Upload a blog banner to publish it"),children:"Publish"}),a.jsx("button",{className:"btn-light py-2",onClick:e=>{if(e.target.className.includes("disable"))return;if(!h.length)return o.error("Write blog title before saving it as a draft");const t=o.loading("Saving Draft...");if(e.target.classList.add("disable"),M.blocks.length){const s={title:h,banner:p,des:m,content:M,tags:tags,draft:!0};d.post("/create-blog",{...s,id:n}).then(()=>{e.target.classList.remove("disable"),o.dismiss(t),o.success("Saved ðŸ‘"),setTimeout(()=>{$("/dashboard/blogs?tab=draft")},500)}).catch(({response:s})=>(e.target.classList.remove("disable"),o.dismiss(t),o.error(s.data.error)))}},children:"Save Draft"})]})]}),a.jsx(l,{}),a.jsx(c,{children:a.jsx("section",{children:a.jsxs("div",{className:"mx-auto max-w-[900px] w-full",children:[a.jsx("div",{className:"relative aspect-video hover:opacity-80 bg-white border-4 border-grey",children:a.jsxs("label",{htmlFor:"uploadBanner",children:[a.jsx("img",{src:V,alt:"Banner",className:"z-20",onError:e=>{e.target.src=U}}),a.jsx("input",{id:"uploadBanner",type:"file",accept:".png, .jpg, .jpeg",hidden:!0,onChange:e=>{const t=e.target.files[0];if(t){const e=o.loading("Uploading...");g(t).then(({url:t})=>{t&&(o.dismiss(e),o.success("Uploaded ðŸ‘"),Y(t),H(e=>({...e,banner:t})))}).catch(t=>(o.dismiss(e),o.error(t)))}}})]})}),a.jsx("textarea",{defaultValue:h,placeholder:"Blog Title",className:"text-4xl font-medium w-full h-20 outline-none resize-none mt-10 leading-tight placeholder:opacity-40 bg-white",onKeyDown:e=>{13===e.keyCode&&e.preventDefault()},onChange:e=>{const t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px",H(e=>({...e,title:t.value}))}}),a.jsx("hr",{className:"w-full opacity-10 my-5"}),a.jsx("div",{id:"text-editor",className:"font-gelasio"})]})})})]})},W=()=>{const{blog:e,setEditorState:r}=t.useContext(R),{banner:n,title:u,tags:g,des:p,content:b,blog_id:x}=e,[f,v]=t.useState(m.sanitize(p||"")),[y,j]=t.useState([]),{userAuth:{access_token:w}}=t.useContext(i),N=s(),[k,C]=t.useState(!1);t.useEffect(()=>{v(m.sanitize(p||""))},[p]),t.useEffect(()=>{const e=(null==g?void 0:g.map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()))||[];j(e)},[g]);return a.jsx(c,{children:a.jsxs("section",{className:"w-screen min-h-screen grid items-start lg:grid-cols-2 py-16 lg:gap-8 bg-gray-100",children:[a.jsx(l,{}),a.jsx("button",{className:"w-12 h-12 absolute right-[5vw] z-10 top-[5%] lg:top-[10%] bg-white rounded-full shadow-md flex items-center justify-center",onClick:()=>{r("editor")},children:a.jsx("i",{className:"fi fi-rs-x text-gray-700"})}),a.jsxs("div",{className:"max-w-[550px] center lg:col-span-1 bg-white shadow-lg rounded-lg p-6",children:[a.jsx("span",{className:"text-dark-grey mb-1",children:"Post Preview"}),a.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-gray-200 mt-4",children:n?a.jsx("img",{src:n,alt:"Banner",className:"object-cover w-full h-full"}):a.jsx("p",{className:"text-center py-10",children:"No Banner"})}),a.jsx("hr",{className:"w-full opacity-100 border-1 mt-3"}),a.jsx("span",{className:"text-dark-grey mb-1",children:"Post Title"}),a.jsx("h1",{className:"text-2xl font-gelasio font-medium leading-tight line-clamp-2",children:u||"Untitled Post"}),a.jsx("hr",{className:"w-full opacity-100 border-1 mt-2 mb-1"}),a.jsx("span",{className:"text-dark-grey mb-2",children:"Write Post Description"}),a.jsx("textarea",{maxLength:180,value:f,className:"h-20 input-box border border-dark-grey rounded-lg pl-4 mt-2 w-full shadow-sm resize-none",placeholder:"Write your post short description here...",onChange:e=>{const t=m.sanitize(e.target.value);v(t),r(e=>({...e,blog:{...e.blog,des:t}}))},onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()}}),a.jsxs("p",{className:"text-dark-grey text-sm text-right",children:[180-f.length," characters left"]})]}),a.jsxs("div",{className:"lg:col-span-1 pl-4 lg:mt-0 lg:pt-10 lg:pl-4 bg-white shadow-lg rounded-lg p-6",children:[a.jsx("span",{className:"text-dark-grey mb-1",children:"Post Description Preview"}),a.jsx("p",{className:"font-gelasio leading-7 h-20",children:f}),a.jsx("p",{className:"text-dark-grey",children:"Post Topics - (Helps your post in searching and ranking)"}),a.jsx("div",{className:"relative input-box pl-4",children:a.jsx(h,{tags:y,setTags:j})}),a.jsx("button",{className:"btn-dark px-8 mt-4 "+(k?"opacity-50 cursor-not-allowed":""),onClick:async()=>{var e,t;if(k)return;if(f.length<10)return o.error("Description should be at least 10 characters long");if(y.length<1)return o.error("Please add at least one tag");C(!0);const s=o.loading("Publishing your post..."),a={title:u,des:f,banner:n,content:b,tags:y,draft:!1};x&&(a.id=x);try{await d.post("/create-post",a),o.dismiss(s),o.success("Post published successfully"),setTimeout(()=>{N("/")},800)}catch(r){o.dismiss(s),o.error("Something went wrong, please try again"),(null==(t=null==(e=r.response)?void 0:e.data)?void 0:t.error)&&o.error(r.response.data.error)}finally{C(!1)}},disabled:k,children:k?"Publishing...":"Publish"})]})]})})},H={title:"",content:[],banner:"",tags:[],category:"",readTime:"",des:"",author:{personal_info:{}}},M={title:"",images:[],banner:"",tags:[],category:"",readTime:"",author:{personal_info:{}}},R=t.createContext({}),q=t.createContext({}),I=()=>{const{blog_id:r}=e(),l=s(),[c,g]=t.useState(H),[h,m]=t.useState(M),[b,x]=t.useState("editor"),[f,v]=t.useState({isReady:!1}),[y,j]=t.useState(null),[w,N]=t.useState(!0),[k,C]=t.useState(null),{userAuth:{access_token:S}}=t.useContext(i);return t.useEffect(()=>{if(!r)return void N(!1);S&&(async()=>{var e,t,s,a,n;try{const{data:e}=await d.post("/get-post",{blog_id:r,draft:!0,mode:"edit"});g(e.blog),e.blog.content?j("blog"):e.blog.images&&j("story")}catch(i){C((null==(t=null==(e=i.response)?void 0:e.data)?void 0:t.error)||"Failed to load post"),o.error((null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.error)||"Failed to load post"),404===(null==(n=i.response)?void 0:n.status)&&l("/not-found")}finally{N(!1)}})()},[r,S,l]),S?w?a.jsx(u,{}):k?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),a.jsx("p",{className:"text-gray-700 mb-6",children:k}),a.jsx("button",{onClick:()=>window.location.reload(),className:"bg-black text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-all",children:"Try Again"})]})}):y?a.jsx(R.Provider,{value:{blog:c,setBlog:g,editorState:b,setEditorState:x,textState:f,setTextState:v,contentType:y},children:a.jsx(q.Provider,{value:{story:h,setStory:m},children:"editor"===b?"blog"===y?a.jsx(F,{}):a.jsx(p,{}):a.jsx(W,{})})}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"What do you want to create?"}),a.jsxs("div",{className:"flex gap-4 justify-center",children:[a.jsx("button",{onClick:()=>j("blog"),className:"bg-black text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-all",children:"Create Blog"}),a.jsx("button",{onClick:()=>j("story"),className:"bg-black text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-all",children:"Create Story"})]})]})}):a.jsx(n,{to:"/signup"})};export{R as EditorContext,q as StoryContext,I as default};
