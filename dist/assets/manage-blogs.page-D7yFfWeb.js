import{r as e,j as s,e as t,L as a,E as l,G as o,J as r,K as d,M as i,V as n}from"./vendor-react-FSHz6IhY.js";import{a as c,U as g,f as x,I as u,L as p,A as m}from"./index-DdTfkRPQ.js";import"./vendor-misc-DyOKPbcj.js";import"./vendor-socket-BtemFTwA.js";import"./vendor-utils-CuK_ifhU.js";import"./vendor-animation-CVt0Hee3.js";const h=async({state:e,arr_data:s,page:t,countRoute:a,data_to_send:l={},user:o})=>{let r;if(null!=e&&t>1){const a=new Set(e.results.map(e=>e._id)),l=s.filter(e=>!a.has(e._id));r={...e,results:[...e.results,...l],page:t}}else try{const{data:{totalDocs:e}}=await c.post(a,l);r={results:s,page:1,totalDocs:e}}catch(d){r={results:s,page:1,totalDocs:s.length}}return r},b=({blog:n,onEdit:c,onDelete:u})=>{const{banner:p,des:m,title:h,activity:{total_likes:b,total_comments:j,total_reads:y},blog_id:N,publishedAt:v}=n,[P,S]=e.useState(!1),{userAuth:{access_token:w}}=e.useContext(g);return s.jsxs(s.Fragment,{children:[s.jsx(t,{}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 mb-6 hover:shadow-lg",children:[s.jsx("div",{className:"h-48 overflow-hidden",children:s.jsx("img",{src:p,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-105",loading:"lazy",alt:h})}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsx(a,{to:`/post/${N}`,className:"",children:s.jsx("h3",{className:"text-xl hover:text-blue font-bold text-gray-900 line-clamp-2-600 transition-colors",children:h})}),s.jsx("span",{className:"text-sm text-gray-500 whitespace-nowrap ml-4",children:x(v)})]}),s.jsx("p",{className:"text-gray-600 mb-6 line-clamp-3",children:m}),s.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(a,{to:`/editor/${N}`,className:"flex items-center px-4 py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors","aria-label":"Edit post",children:[s.jsx(l,{className:"mr-2"}),"Edit"]}),s.jsxs("button",{onClick:e=>f(n,w,e.target),className:"flex items-center px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors","aria-label":"Delete post",children:[s.jsx(o,{className:"mr-2"}),"Delete"]})]}),s.jsxs("button",{onClick:()=>{S(!P)},className:"flex items-center px-4 py-2 bg-gray-50 text-gray-600 rounded-md hover:bg-gray-100 transition-colors","aria-label":P?"Hide statistics":"Show statistics",children:[s.jsx(r,{className:"mr-2"}),P?"Hide Stats":"Show Stats",P?s.jsx(d,{className:"ml-2"}):s.jsx(i,{className:"ml-2"})]})]}),P&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 animate-fadeIn",children:[s.jsx("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Post Statistics"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Total Reads"}),s.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:y.toLocaleString()})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Total Likes"}),s.jsx("p",{className:"text-2xl font-bold text-green-900",children:b.toLocaleString()})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Comments"}),s.jsx("p",{className:"text-2xl font-bold text-blue-900",children:j.toLocaleString()})]})]}),s.jsx("div",{className:"mt-4",children:s.jsxs("p",{className:"text-sm text-gray-500",children:["Last updated: ",x(new Date)]})})]})]})]})]})},j=({blog:l})=>{let{des:o,title:r,blog_id:d,index:i}=l;const{userAuth:{access_token:n}}=e.useContext(g);return i++,s.jsxs(s.Fragment,{children:[s.jsx(t,{}),s.jsxs("div",{className:"flex gap-5 lg:gap-10 border-b mb-6 border-black border-opacity-30",children:[s.jsx("h1",{className:"blog-index text-center pl-4 md:pl-6 flex-none",children:i<10?"0"+i:i}),s.jsxs("div",{className:"",children:[s.jsx("h1",{className:"blog-title mb-3 ",children:r}),s.jsx("p",{className:"line-clamp-2 font-gelasio ",children:o.length?o:"No Description Found"}),s.jsxs("div",{className:"flex gap-6 mt-3",children:[s.jsx(a,{to:`/editor/${d}`,className:"text-blue-600 hover:underline",children:"Edit"}),s.jsx("button",{onClick:e=>f(l,n,e.target),className:"text-red-600 hover:underline",children:"Delete"})]})]})]})]})},f=(e,s,t)=>{const{index:a,blog_id:l,setStateFuc:o}=e;t.setAttribute("disabled","true"),t.classList.add("opacity-50","cursor-not-allowed"),c.post("/delete-blog",{blog_id:l}).then(({data:e})=>{t.removeAttribute("disabled"),o(e=>{let{deletedDocCount:s,totalDocs:t,results:l}=e;return l.splice(a,1),n.success("Blog deleted successfully!"),!l.length&&t-1>0?null:(s||(s=0),{...e,results:[...l],totalDocs:t-1,deleteDocCount:s+1})})}).catch(e=>{t.removeAttribute("disabled"),t.classList.remove("opacity-50","cursor-not-allowed"),alert("Failed to delete the blog. Please try again.")})},y=["Published Posts","Drafts","Stories"],N=()=>{const{userAuth:{access_token:a}}=e.useContext(g),[l,o]=e.useState(0),[r,d]=e.useState(""),[i,n]=e.useState({results:[],page:1,totalPages:1,totalDocs:0}),[x,f]=e.useState(!1),[N,v]=e.useState(null),[P,S]=e.useState({results:[],page:1,totalPages:1,totalDocs:0}),[w,C]=e.useState(!1),[_,k]=e.useState(null),[D,F]=e.useState({results:[],page:1,totalPages:1,totalDocs:0}),[E,L]=e.useState(!1),[A,q]=e.useState(null),R=e.useCallback(async(e=1)=>{if(a){f(!0),v(null);try{const{data:s}=await c.post("/get-user-blogs",{page:e,draft:!1,query:r,deletedDocCount:0}),t=await h({state:i,arr_data:s.blogs,page:e,user:a,countRoute:"/get-user-blogs-count",data_to_send:{draft:!1,query:r}});n(t)}catch(s){v("Failed to load published posts. Please try again.")}finally{f(!1)}}},[a,r]),T=e.useCallback(async(e=1)=>{if(a){C(!0),k(null);try{const{data:s}=await c.post("/get-user-blogs",{page:e,draft:!0,query:r,deletedDocCount:0}),t=await h({state:P,arr_data:s.blogs,page:e,user:a,countRoute:"/get-user-blogs-count",data_to_send:{draft:!0,query:r}});S(t)}catch(s){k("Failed to load draft posts. Please try again.")}finally{C(!1)}}},[a,r]),I=e.useCallback(async(e=1)=>{if(a){L(!0),q(null);try{const{data:s}=await c.post("/get-user-stories",{page:e,query:r}),t={results:s.stories||[],page:e,totalPages:s.totalPages||1,totalDocs:s.totalDocs||s.stories.length||0};F(t)}catch(s){q("Failed to load stories. Please try again.")}finally{L(!1)}}},[a,r]);e.useEffect(()=>{a&&(n(e=>({...e,page:1})),S(e=>({...e,page:1})),F(e=>({...e,page:1})),R(1),T(1))},[a,r,R,T,I]),e.useEffect(()=>{a&&i.page>1&&i.page<=i.totalPages&&R(i.page)},[a,i.page,i.totalPages,R]),e.useEffect(()=>{a&&P.page>1&&P.page<=P.totalPages&&T(P.page)},[a,P.page,P.totalPages,T]),e.useEffect(()=>{a&&D.page>1&&D.page<=D.totalPages&&I(D.page)},[a,D.page,D.totalPages,I]);const $=e=>{e>=1&&e<=i.totalPages&&n(s=>({...s,page:e}))},H=e=>{e>=1&&e<=P.totalPages&&S(s=>({...s,page:e}))},K=e=>{e>=1&&e<=D.totalPages&&F(s=>({...s,page:e}))};return s.jsxs(s.Fragment,{children:[s.jsx("h1",{className:"hidden md:block text-3xl font-semibold mb-6",children:"Manage Posts"}),s.jsx(t,{}),s.jsxs("div",{className:"relative max-w-md mx-auto mb-8",children:[s.jsx("input",{type:"search",value:r,placeholder:"Search Posts",className:"w-full px-4 py-3 rounded-full border-2 border-black placeholder:text-gray-500 focus:outline-none focus:border-blue-500",onChange:e=>{d(e.target.value.trim())},onKeyDown:e=>{e.key}}),r&&s.jsx("button",{className:"absolute right-4 top-2.5 text-gray-600",onClick:()=>{d("")},"aria-label":"Clear search",children:"âœ•"}),s.jsx("i",{className:"fi fi-rr-search absolute left-4 top-3 text-xl pointer-events-none"})]}),s.jsxs(u,{routes:y,activeIndex:l,onTabChange:o,children:[x?s.jsx(p,{}):N?s.jsx("p",{className:"text-red-600",children:N}):i.results.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-4",children:i.results.map((e,t)=>s.jsx(m,{transition:{delay:.04*t},children:s.jsx(b,{blog:{...e,index:t,setStateFuc:n}})},e._id||t))}),s.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(i.page-1),disabled:i.page<=1||x,children:"Previous"}),s.jsxs("span",{children:["Page ",i.page," of ",i.totalPages]}),s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>$(i.page+1),disabled:i.page>=i.totalPages||x,children:"Next"})]})]}):s.jsx("p",{children:"No published posts found."}),w?s.jsx(p,{}):_?s.jsx("p",{className:"text-red-600",children:_}):P.results.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-4",children:P.results.map((e,t)=>s.jsx(m,{transition:{delay:.04*t},children:s.jsx(j,{blog:{...e,index:t,setStateFuc:S}})},e._id||t))}),s.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>H(P.page-1),disabled:P.page<=1||w,children:"Previous"}),s.jsxs("span",{children:["Page ",P.page," of ",P.totalPages]}),s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>H(P.page+1),disabled:P.page>=P.totalPages||w,children:"Next"})]})]}):s.jsx("p",{children:"No Draft posts found."}),E?s.jsx(p,{}):A?s.jsx("p",{className:"text-red-600",children:A}):D.results.length?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-4",children:D.results.map((e,t)=>s.jsx(m,{transition:{delay:.04*t},children:s.jsx(b,{blog:{...e,index:t,setStateFuc:F}})},e._id||t))}),s.jsxs("div",{className:"mt-6 flex justify-center items-center space-x-4",children:[s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>K(D.page-1),disabled:D.page<=1||E,children:"Previous"}),s.jsxs("span",{children:["Page ",D.page," of ",D.totalPages]}),s.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded disabled:opacity-50",onClick:()=>K(D.page+1),disabled:D.page>=D.totalPages||E,children:"Next"})]})]}):s.jsx("p",{children:"No stories found (coming soon!)."})]})]})};export{N as default};
