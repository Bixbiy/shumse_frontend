import{r as e,j as s,u as l,P as a,e as r,Q as t,S as i,T as n,U as o,W as d,X as c,Y as m,V as u}from"./vendor-react-FSHz6IhY.js";import{U as x,a as p}from"./index-DdTfkRPQ.js";import{U as g}from"./aws-DFWnXOg2.js";const h=["Gaming","News","Tech","Lifestyle","Sports","Entertainment","Films"],f=({tags:l=[],setTags:a})=>{const[r,t]=e.useState("");return s.jsxs("div",{className:"tags-input p-4 bg-white shadow-lg rounded-lg",children:[s.jsxs("div",{className:"flex flex-wrap items-center mb-4",children:[l.map((e,r)=>s.jsxs("div",{className:"tag bg-gray-200 rounded-full px-3 py-1 m-1 flex items-center shadow-sm",children:[s.jsxs("span",{className:"mr-2 text-gray-700",children:["#",e]}),s.jsx("button",{type:"button",className:"text-red-500 ml-2 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 rounded-full w-5 h-5 flex items-center justify-center transition-colors",onClick:()=>(e=>{a(l.filter((s,l)=>l!==e))})(r),"aria-label":`Remove tag ${e}`,children:s.jsx("i",{className:"fi fi-br-cross text-[10px]"})})]},r)),l.length<5&&s.jsx("input",{type:"text",value:r,onChange:e=>t(e.target.value),onKeyDown:e=>{("Enter"===e.key||","===e.key||" "===e.key)&&l.length<5&&(e.preventDefault(),""!==r.trim()&&(a([...l,r.trim()]),t("")))},placeholder:"Add Topics",className:"input-box border border-dark-grey rounded-full pl-4 py-2 m-1 flex-grow shadow-sm","aria-label":"Add a topic"})]}),s.jsxs("div",{className:"flex flex-wrap items-center",children:[s.jsx("p",{className:"text-gray-600 mb-2 w-full",children:"Suggested Topics"}),h.map((e,r)=>s.jsxs("button",{type:"button",className:"bg-dark-grey bg-opacity-30 hover:bg-opacity-40 text-gray-700 rounded-full px-3 py-1 m-1 shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400",onClick:()=>(e=>{l.length<5&&!l.includes(e)&&a([...l,e])})(e),"aria-label":`Add tag ${e}`,children:["#",e]},r))]})]})},b=5242880;function j(){const[h,j]=e.useState({title:"",banner:null,slides:[],tags:[]}),[y,v]=e.useState({publishing:!1}),N=l(),{userAuth:{access_token:w}}=e.useContext(x),{getRootProps:S,getInputProps:k}=a({accept:{"image/jpeg":[],"image/png":[],"image/webp":[],"image/jpg":[]},multiple:!1,maxSize:b,onDrop:async e=>{const s=e[0];if(s)if(s.type.startsWith("image/"))if(s.size>b)u.error("File too large. Maximum file size is 5MB.");else try{const{url:e}=await g(s);j(s=>({...s,banner:e})),u.success("Banner uploaded successfully!")}catch(l){u.error("Banner upload failed")}else u.error("Invalid file type. Please upload an image.")}});return s.jsxs("div",{className:"max-w-4xl mx-auto p-8 bg-gray-50 rounded-2xl shadow-xl",children:[s.jsx(r,{position:"top-right"}),s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsx("h1",{className:"text-4xl font-bold text-gray-800",children:h.title?h.title:"New Story"}),s.jsx("button",{type:"button",onClick:async()=>{var e,s;v({publishing:!0});try{if(!h.title||!h.banner||0===h.slides.length)throw new Error("Please fill all required fields before publishing");const e={title:h.title,banner:h.banner,tags:h.tags,draft:!1,images:h.slides.map(e=>({url:e.url,description:e.description}))};await p.post("/create-story",e),u.success("Story published successfully!"),N("/")}catch(l){u.error((null==(s=null==(e=l.response)?void 0:e.data)?void 0:s.error)||l.message||"Failed to publish story")}finally{v({publishing:!1})}},disabled:y.publishing,className:"flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-2xl hover:bg-green-700 disabled:opacity-50 transition",children:y.publishing?s.jsx(t,{className:"animate-spin"}):"Publish"})]}),s.jsxs("form",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Title *"}),s.jsx("input",{type:"text",value:h.title,onChange:e=>j(s=>({...s,title:e.target.value})),className:"w-full p-4 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition",placeholder:"Enter story title",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Banner *"}),s.jsxs("div",{...S(),className:"border-2 border-dashed rounded-2xl p-8 text-center cursor-pointer hover:border-blue-500 transition-colors min-h-[300px] flex items-center justify-center bg-white",children:[s.jsx("input",{...k()}),h.banner?s.jsx("img",{src:h.banner,alt:"Banner preview",className:"max-h-80 mx-auto rounded-2xl object-cover"}):s.jsxs("div",{className:"text-gray-500",children:[s.jsx(i,{className:"text-5xl mx-auto mb-4"}),s.jsx("p",{children:"Drag & drop banner image or click to select"}),s.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"High resolution images work best"})]})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["Slides ",h.slides.length>0&&`(${h.slides.length})`]}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("label",{className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-2xl cursor-pointer hover:bg-blue-700 transition",children:[s.jsx(n,{})," Upload Multiple Slides",s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const s=e.target.files;if(!s||0===s.length)return;const l=Array.from(s).filter(e=>e.type.startsWith("image/")?!(e.size>b)||(u.error(`${e.name} is too large. Maximum file size is 5MB.`),!1):(u.error(`${e.name} is not a valid image file.`),!1));0!==l.length&&(j(e=>({...e,slides:[...e.slides,...l.map(e=>({url:"",description:"",file:e,loading:!0,error:null}))]})),await Promise.all(l.map(async e=>{try{const{url:s}=await g(e);j(l=>{const a=[...l.slides],r=a.findIndex(s=>s.file===e);return-1!==r&&(a[r]={...a[r],url:s,loading:!1,file:null}),{...l,slides:a}}),u.success("Image uploaded!")}catch(s){j(s=>{const l=[...s.slides],a=l.findIndex(s=>s.file===e);return-1!==a&&(l[a]={...l[a],loading:!1,error:"Upload failed. Click to retry."}),{...s,slides:l}}),u.error("An image upload failed")}})),e.target.value=null)},className:"hidden"})]})})]}),s.jsx(o,{onDragEnd:e=>{if(!e.destination)return;const s=Array.from(h.slides),[l]=s.splice(e.source.index,1);s.splice(e.destination.index,0,l),j(e=>({...e,slides:s}))},children:s.jsx(d,{droppableId:"slides",children:e=>s.jsxs("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-4",children:[h.slides.map((e,l)=>s.jsx(c,{draggableId:`slide-${l}`,index:l,children:a=>s.jsxs("div",{ref:a.innerRef,...a.draggableProps,className:"border rounded-2xl p-4 bg-white shadow-sm hover:shadow-lg transition",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("div",{...a.dragHandleProps,className:"flex items-center gap-2 cursor-move text-gray-600",children:s.jsxs("span",{className:"font-medium",children:["Slide ",l+1]})}),s.jsx("button",{type:"button",onClick:()=>(e=>{j(s=>({...s,slides:s.slides.filter((s,l)=>l!==e)}))})(l),className:"text-red-500 hover:text-red-600",children:s.jsx(m,{size:20})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"border-2 border-dashed rounded-2xl p-4 relative",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>(async(e,s)=>{if(!e.type.startsWith("image/"))return void u.error("Invalid file type. Please upload an image.");if(e.size>b)return void u.error("File too large. Maximum file size is 5MB.");const l=[...h.slides];l[s]={...l[s],loading:!0,error:null},j(e=>({...e,slides:l}));try{const{url:l}=await g(e);j(e=>{const a=[...e.slides];return a[s]={...a[s],url:l,loading:!1,file:null},{...e,slides:a}}),u.success(`Slide ${s+1} uploaded!`)}catch(a){j(e=>{const l=[...e.slides];return l[s]={...l[s],loading:!1,error:"Upload failed. Click to retry."},{...e,slides:l}}),u.error(`Slide ${s+1} upload failed`)}})(e.target.files[0],l),className:"hidden",id:`slide-upload-${l}`}),s.jsx("label",{htmlFor:`slide-upload-${l}`,className:"cursor-pointer block text-center h-full",children:e.url?s.jsx("img",{src:e.url,alt:`Slide ${l+1}`,className:"max-h-60 mx-auto rounded-2xl object-cover w-full h-full"}):s.jsx("div",{className:"text-gray-500 py-8",children:e.loading?s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(t,{className:"animate-spin text-4xl mb-2"}),s.jsx("p",{children:"Uploading..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{className:"text-4xl mx-auto mb-2"}),s.jsx("p",{children:e.error||"Click to upload image"})]})})})]}),s.jsx("div",{className:"h-full",children:s.jsx("textarea",{value:e.description,onChange:e=>{const s=[...h.slides];s[l].description=e.target.value,j(e=>({...e,slides:s}))},placeholder:"Slide description...",className:"w-full h-full p-2 border rounded-2xl"})})]})]})},l)),e.placeholder]})})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (max 5)"}),s.jsx(f,{tags:h.tags,setTags:e=>j(s=>({...s,tags:e}))})]})]})]})}const y=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"}));export{j as S,f as T,y as a};
