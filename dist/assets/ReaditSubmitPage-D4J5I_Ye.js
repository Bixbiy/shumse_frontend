import{j as e}from"./vendor-markdown-DVKDwQVh.js";import{h as t,u as a,r as s}from"./vendor-react-B32pNUrn.js";import{U as r,I as i,L as l}from"./index-D1ni5E-J.js";import{H as o,V as n}from"./vendor-ui-BqXYh4xT.js";import{U as d}from"./aws-4et089fW.js";import{c}from"./useReaditApi-CKGJs4Kf.js";import"./vendor-socket-CUkmNz_4.js";const m=()=>{const{communityName:m}=t(),x=a(),{userAuth:u}=s.useContext(r),p=s.useRef(),[g,h]=s.useState("text"),[b,f]=s.useState(""),[j,v]=s.useState(""),[y,k]=s.useState(""),[N,w]=s.useState(""),[C,S]=s.useState(!1),[I,A]=s.useState(!1);return(null==u?void 0:u.access_token)?e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsx(o,{children:e.jsxs("title",{children:["Submit to c/",m," | Readit"]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Create a Post"}),e.jsxs("p",{className:"text-dark-grey",children:["Posting to ",e.jsxs("span",{className:"font-semibold text-black dark:text-white",children:["c/",m]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-grey-dark rounded-lg shadow-md border border-grey dark:border-grey-dark overflow-hidden",children:[e.jsx(i,{ref:p,routes:["Text","Image","Link"],defaultActiveIndex:0,defaultHidden:[],onRouteChange:(e,t)=>{h(e.innerText.toLowerCase())}}),e.jsxs("div",{className:"p-6",children:[e.jsx("input",{type:"text",placeholder:"Title",value:b,onChange:e=>f(e.target.value),className:"input-box mb-4 text-xl font-semibold placeholder:font-normal",maxLength:300}),"text"===g&&e.jsx("textarea",{placeholder:"What's on your mind? (Markdown supported)",value:j,onChange:e=>v(e.target.value),className:"input-box h-64 resize-y font-mono text-sm leading-relaxed"}),"image"===g&&e.jsxs("div",{className:"border-2 border-dashed border-grey dark:border-grey/30 bg-grey/5 p-8 rounded-lg text-center",children:[e.jsx("input",{type:"file",id:"upload-image-input",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;A(!0);const a=n.loading("Uploading image...");try{const e=await d(t),a="object"==typeof e?e.url:e;w(a),n.success("Image uploaded!")}catch(s){n.error("Image upload failed.")}finally{n.dismiss(a),A(!1)}},className:"hidden",disabled:I}),e.jsxs("label",{htmlFor:"upload-image-input",className:"cursor-pointer inline-flex flex-col items-center gap-2",children:[e.jsx("i",{className:"fi fi-rr-picture text-4xl text-dark-grey"}),e.jsx("span",{className:"text-blue font-medium hover:underline",children:N?"Change Image":"Upload Image"})]}),N&&e.jsx("div",{className:"mt-4 relative inline-block",children:e.jsx("img",{src:N,alt:"Post preview",className:"max-h-64 rounded-md shadow-sm"})})]}),"link"===g&&e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fi fi-rr-link-alt absolute left-4 top-1/2 -translate-y-1/2 text-dark-grey"}),e.jsx("input",{type:"url",placeholder:"https://example.com",value:y,onChange:e=>k(e.target.value),className:"input-box pl-10 text-blue"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-grey dark:border-grey/20",children:[e.jsx("button",{onClick:()=>x(-1),className:"btn-light px-6",disabled:C,children:"Cancel"}),e.jsx("button",{onClick:async()=>{var e,t;if(!b.trim())return n.error("A title is required.");if("link"===g&&!y)return n.error("A URL is required.");if("image"===g&&!N)return n.error("An image is required.");S(!0);const a={communityName:m,title:b,postType:g,content:"text"===g?j:void 0,url:"link"===g?y:void 0,image:"image"===g?N:void 0};try{const e=await c(a);n.success("Post created!"),x(`/readit/post/${e.data._id}`)}catch(s){n.error((null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.error)||"Failed to create post.")}finally{S(!1)}},disabled:C||I,className:"btn-dark px-8 flex items-center gap-2",children:C?e.jsx(l,{}):"Post"})]})]})]})]}):e.jsxs("div",{className:"max-w-3xl mx-auto p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-grey",children:"You must be logged in to post."}),e.jsx("button",{onClick:()=>x("/signin"),className:"btn-dark mt-4",children:"Sign In"})]})};export{m as default};
